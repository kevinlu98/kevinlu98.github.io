<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>冷文聊编辑</title>
  
  
  <link href="https://study.kevinlu98.cn/atom.xml" rel="self"/>
  
  <link href="https://study.kevinlu98.cn/"/>
  <updated>2023-01-28T10:11:50.778Z</updated>
  <id>https://study.kevinlu98.cn/</id>
  
  <author>
    <name>Mr丶冷文</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>(四)vim文本编辑器</title>
    <link href="https://study.kevinlu98.cn/2023/01/16/wen-ben-bian-ji-qi.html"/>
    <id>https://study.kevinlu98.cn/2023/01/16/wen-ben-bian-ji-qi.html</id>
    <published>2023-01-16T03:03:00.000Z</published>
    <updated>2023-01-28T10:11:50.778Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在上节课讲文件描述符的时候应该是有提到过在Linux中一切皆文件，包括鼠标、键盘、网卡等这些硬件在内，所以我们在使用Linux操作系统中需要频繁的修改文件 ，这节课就带大家学习一下Linux中非常重要的文本编辑器<code>vim</code></p><h2 id="Vim与Vi"><a href="#Vim与Vi" class="headerlink" title="Vim与Vi"></a>Vim与Vi</h2><h3 id="Vi"><a href="#Vi" class="headerlink" title="Vi"></a>Vi</h3><p>vi是所有Linux系统都会内建的文本编辑器，他不像我们在windows的记事本那样打开一个图形窗口来进行编辑，而是在shell窗口中对文本进行编辑，不过现在很少有人会使用vi编辑器了，都是用它的替代器vim</p><h3 id="Vim"><a href="#Vim" class="headerlink" title="Vim"></a>Vim</h3><p>vim 是从 vi 发展出来的一个文本编辑器，兼容 vi 的所有指令，不仅能编辑文本，而且还有代码补全、编译及错误跳转等方便编程的功能特别丰富，现在基本一些 主流的Linux操作系统上都内置了vim，我们可以看看<a href="https://www.vim.org/">vim官网</a>对其的描述</p><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/20230116/0700f475b36a44cca49c04a712ea32d2.png" alt="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/20230116/0700f475b36a44cca49c04a712ea32d2.png"></p><h2 id="Vim的工作模式"><a href="#Vim的工作模式" class="headerlink" title="Vim的工作模式"></a>Vim的工作模式</h2><p>在使用vim编辑器时，共有3种工作模式，分别是底线命令模式、命令模式和编辑模式，这3种工作模式可以随意切换</p><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/20230116/af38f52c3f6249a08254987389e2e28f.png" alt="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/20230116/af38f52c3f6249a08254987389e2e28f.png"></p><h3 id="Vim的命令模式"><a href="#Vim的命令模式" class="headerlink" title="Vim的命令模式"></a>Vim的命令模式</h3><p>在使用vim编辑文件时，默认所处的模式就是命令模式，可使用方向键(上、下、左、右)移动光标位置，也可以对其进行复制、粘贴、删除、替换、撤销等操作，接下来我们具体看看怎么使用命令模式</p><h4 id="光标移动"><a href="#光标移动" class="headerlink" title="光标移动"></a>光标移动</h4><p><strong>这个表格中的字母是区分大小写的</strong></p><table><thead><tr><th>输入</th><th>含义</th></tr></thead><tbody><tr><td><strong>[n] + h 或 向左箭头键(←)</strong></td><td><strong>光标向左移动n个字符，这里n为任意数字，可以省略，省略时默认为1</strong></td></tr><tr><td><strong>[n] + j 或 向下箭头键(↓)</strong></td><td><strong>光标向下移动n个字符，这里n为任意数字，可以省略，省略时默认为1</strong></td></tr><tr><td><strong>[n] + k 或 向上箭头键(↑)</strong></td><td><strong>光标向上移动n个字符，这里n为任意数字，可以省略，省略时默认为1</strong></td></tr><tr><td><strong>[n] + l(小写L) 或 向右箭头键(→)</strong></td><td><strong>光标向右移动n个字符，这里n为任意数字，可以省略，省略时默认为1</strong></td></tr><tr><td>Ctrl+f</td><td>屏幕向下移动一页</td></tr><tr><td>Ctrl+b</td><td>屏幕向上移动一页</td></tr><tr><td>Ctrl+d</td><td>屏幕向下移动半页</td></tr><tr><td>Ctrl+u</td><td>屏幕向上移动半页</td></tr><tr><td>+</td><td>光标移动到下一行的非空格字符</td></tr><tr><td>-</td><td>光标移动到上一行的非空格字符</td></tr><tr><td>[n] + 空格键</td><td>光标会向后移动 n 个字符，这里n为任意数字，可以省略，省略时默认为1，这里与右键是有区别的，当移动到这行最后时会自动换行</td></tr><tr><td>0</td><td>数字0，移动到行首</td></tr><tr><td>$</td><td>移动到行尾</td></tr><tr><td>H</td><td>光标移动到这个屏幕的最上方那一行的第一个字符(非文件第1行)</td></tr><tr><td>M</td><td>光标移动到这个屏幕的中央那一行的第一个字符</td></tr><tr><td>L</td><td>光标移动到这个屏幕的最下方那一行的第一个字符</td></tr><tr><td><strong>G</strong></td><td><strong>移动到这个文件的最后一行</strong></td></tr><tr><td><strong>[n] + G</strong></td><td><strong>移动到这个文件的第 n 行，这里n为任意数字</strong></td></tr><tr><td><strong>gg</strong></td><td><strong>移动到这个文件的第一行，相当于 1G</strong></td></tr><tr><td><strong>[n] + 回车键</strong></td><td><strong>光标向下移动 n 行，这里n为任意数字，可以省略，省略时默认为1，这里与下键是有区别的，下键不会回到行首</strong></td></tr><tr><td><strong>[n] + w&#x2F;W</strong></td><td><strong>光标移动至下n个单词的单词首，这里n为任意数字，可以省略，省略时默认为1</strong></td></tr><tr><td>[n] + b&#x2F;B</td><td>光标移动至前n个单词的单词首，这里n为任意数字，可以省略，省略时默认为1</td></tr><tr><td>[n] + e&#x2F;E</td><td>光标移动至后n个单词的单词尾，这里n为任意数字，可以省略，省略时默认为1</td></tr></tbody></table><h4 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h4><table><thead><tr><th>输入</th><th>含义</th></tr></thead><tbody><tr><td><strong>&#x2F; + [word]</strong></td><td><strong>向光标之下寻找一个为 word 的字符串，这里的word为任意字符串，通常配合n和N使用</strong></td></tr><tr><td>? + [word]</td><td>向光标之下寻找一上为 word 的字符串，这里的word为任意字符串</td></tr><tr><td><strong>n</strong></td><td><strong>重复前一个搜寻的动作</strong></td></tr><tr><td><strong>N</strong></td><td><strong>反向重复前一个搜寻的动作</strong></td></tr></tbody></table><h4 id="复制-x2F-粘贴-x2F-撤销-x2F-删除-x2F-其它"><a href="#复制-x2F-粘贴-x2F-撤销-x2F-删除-x2F-其它" class="headerlink" title="复制&#x2F;粘贴&#x2F;撤销&#x2F;删除&#x2F;其它"></a>复制&#x2F;粘贴&#x2F;撤销&#x2F;删除&#x2F;其它</h4><table><thead><tr><th>输入</th><th>含义</th></tr></thead><tbody><tr><td>[n] + x</td><td>在一行字当中向后删除n个字符，包含光标</td></tr><tr><td>[n] + X</td><td>在一行字当中向前删除n个字符</td></tr><tr><td><strong>[n] + dd</strong></td><td><strong>剪切光标所在的向下 n 行，包含光标</strong></td></tr><tr><td>d1G</td><td>剪切光标所在到第一行的所有数据，包含光标</td></tr><tr><td>dG</td><td>剪切光标所在到最后一行的所有数据，包含光标</td></tr><tr><td>d$</td><td>剪切游标所在处到行尾的所有字符，包含光标</td></tr><tr><td>d0</td><td>剪切游标所在处到行首的所有字符</td></tr><tr><td>d + [n] +w</td><td>在一行中向后删除n个单词，包含光标，这里n为任意数字，省略默认为1</td></tr><tr><td><strong>[n] + yy</strong></td><td><strong>向后复制n行，包含光标所在行，这里n为任意数字，省略默认这1</strong></td></tr><tr><td>y1G</td><td>复制光标所在到第一行的所有数据，包含光标</td></tr><tr><td>yG</td><td>复制光标所在到最后一行的所有数据，包含光标</td></tr><tr><td>y$</td><td>复制游标所在处到行尾的所有字符，包含光标</td></tr><tr><td>Y0</td><td>复制游标所在处到行首的所有字符</td></tr><tr><td>Y + [n] +w</td><td>在一行中向后复制n个单词，包含光标，这里n为任意数字，省略默认为1</td></tr><tr><td><strong>p</strong></td><td><strong>将已复制的数据在光标下一行贴上</strong></td></tr><tr><td>P</td><td>将已复制的数据在光标上一行贴上</td></tr><tr><td><strong>J</strong></td><td><strong>将光标所在行与下一行的数据结合成同一行</strong></td></tr><tr><td><strong>u</strong></td><td><strong>复原前一个动作(撤销)</strong></td></tr><tr><td>&gt;&gt;</td><td>选中行向右缩进</td></tr><tr><td>&lt;&lt;</td><td>选中行向左缩进</td></tr></tbody></table><h4 id="可视块"><a href="#可视块" class="headerlink" title="可视块"></a>可视块</h4><p>上面只是在移动光标的位置，当我们想要选择一块内容时可以用可视块功能进行选择，方便我们对选中区域做批量操作</p><table><thead><tr><th>输入</th><th>含义</th></tr></thead><tbody><tr><td>v(小写)</td><td>字符可视化，以字符为单位进行选择</td></tr><tr><td>V(大写)</td><td>行可视化，以行为单位进行选择</td></tr><tr><td><strong>Ctrl+v</strong></td><td><strong>块可视化，以块为单位进行选择，类似于在vscode中用鼠标中键进行选择</strong></td></tr></tbody></table><p>在使用可视块选中后可以使用如下输入进行批量编辑</p><table><thead><tr><th>输入</th><th>含义</th></tr></thead><tbody><tr><td>d</td><td>删除选中部分文本</td></tr><tr><td>D</td><td>删除选中行，与d不同的是即使某行没有完全被选中，删除时也会被删除</td></tr><tr><td>y</td><td>将选中部分复制到剪贴板</td></tr><tr><td>p(小写)</td><td>将剪贴板中的内容粘贴到光标之后</td></tr><tr><td>P(大写)</td><td>将剪贴板中的内容粘贴到光标之前。</td></tr><tr><td>u(小写)</td><td>将选中部分中的大写字符全部改为小写字符。</td></tr><tr><td>U(大写)</td><td>将选中部分中的小写字符全部改为大写字符。</td></tr><tr><td>&gt;</td><td>将选中部分右移（缩进）一个 tab 键</td></tr><tr><td>&lt;</td><td>将选中部分左移一个 tab 键</td></tr></tbody></table><h3 id="Vim的编辑模式"><a href="#Vim的编辑模式" class="headerlink" title="Vim的编辑模式"></a>Vim的编辑模式</h3><p>在命令模式下输入如下可以进入编辑模式，进入输入模式后大家正常输入就可以了，大家在输入时可以按<code>Ctrl+n/p</code>  根据历史输入和系统库文件进行输入提示，也可以按<code>ESC</code>退回到命令模式</p><table><thead><tr><th>输入</th><th>含义</th></tr></thead><tbody><tr><td><strong>i</strong></td><td><strong>从光标处进入输入模式</strong></td></tr><tr><td><strong>I(这是一个大写i)</strong></td><td><strong>目前所在行的第一个非空格符进入输入模式</strong></td></tr><tr><td><strong>a</strong></td><td><strong>从光标下一个字符进入 输入模式</strong></td></tr><tr><td><strong>A</strong></td><td><strong>目前所在行的行尾进入输入模式</strong></td></tr><tr><td><strong>o</strong></td><td><strong>从光标所在行的下一行进入输入模式</strong></td></tr><tr><td><strong>O</strong></td><td><strong>从光标所在行的上一行进入输入模式</strong></td></tr><tr><td><strong>r</strong></td><td><strong>进入替换模式，替换光标所在字符，只会进行一次替换</strong></td></tr><tr><td><strong>R</strong></td><td><strong>进入替换模式，会一直替换光标所在 字符，替换后光标后移，直到按ESC键退出替换模式</strong></td></tr></tbody></table><h3 id="Vim底线命令模式"><a href="#Vim底线命令模式" class="headerlink" title="Vim底线命令模式"></a>Vim底线命令模式</h3><p>一般情况下可以通过命令模式下按<code>:</code>进入 指令行模式，如果我们在编辑模式，可以先</p><table><thead><tr><th>输入</th><th>含义</th></tr></thead><tbody><tr><td>:w</td><td>将编辑的数据写保存</td></tr><tr><td>:w!</td><td>若文件为只读时强制保存，但能不能执行成功与用户对文件的权限有关</td></tr><tr><td>:q</td><td>退出vim</td></tr><tr><td>:q!</td><td>如果修改过文件又不想保存，可以使用!强制退出</td></tr><tr><td>:wq</td><td>保存并退出</td></tr><tr><td>:wq!</td><td>强制保存并退出</td></tr><tr><td><strong>:x</strong></td><td><strong>保存并退出</strong></td></tr><tr><td>:[n1],[n2] w filename</td><td>保存n1到n2行的内容到filename中，n1，n2为行号范围，如果n1，n2省略则默认到1行到最后一行，类似于另存为</td></tr><tr><td>:! command</td><td>暂时离开vim去执行command命令</td></tr><tr><td><strong>:%s&#x2F;word1&#x2F;word2&#x2F;g[c]</strong></td><td><strong>从第一行到最后一行寻找 word1 字符串，并将该字符串取代为 word2，加上c为在每次替换时需要用户确认</strong></td></tr><tr><td><strong>:n1,n2s&#x2F;word1&#x2F;word2&#x2F;g[c]</strong></td><td><strong>从第n1行到n2行寻找 word1 字符串，并将该字符串取代为 word2，n1，n2为行号，加上c为在每次替换时需要用户确认</strong></td></tr></tbody></table><h3 id="Vim设置"><a href="#Vim设置" class="headerlink" title="Vim设置"></a>Vim设置</h3><p>这里列几个常用的，可以在命令模式下输入进行该次临时生效</p><table><thead><tr><th>输入</th><th>含义</th></tr></thead><tbody><tr><td>set nu</td><td>显示行号</td></tr><tr><td>set nonu</td><td>取消行号显示</td></tr><tr><td>syntax on&#x2F;off</td><td>开启&#x2F;关闭高亮</td></tr><tr><td>set tabstop&#x3D;4</td><td>设置tab的缩进为4格</td></tr><tr><td>set shiftwidth&#x3D;4</td><td>设置移动命令的缩进为4格</td></tr></tbody></table><p>如果想入设置生效则可以编辑<code>/etc.vimrc</code>文件，该文件对系统所有用户生效，如果只想改变当前用户的vim设置，可以在用户家目录下创建<code>.vimrc</code>文件进行设置</p><h3 id="Vim键盘图"><a href="#Vim键盘图" class="headerlink" title="Vim键盘图"></a>Vim键盘图</h3><p>这张图是网上流传比较广的一张图，出自<a href="http://www.viemu.com/">www.viemu.com</a>，当然另一位大佬<a href="http://cenalulu.github.io/">cenalulu</a>的博客上也有进阶版大家感兴趣可以去看看<a href="http://cenalulu.github.io/linux/all-vim-cheatsheat/">史上最全Vim快捷键键位图 – 入门到进阶</a></p><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/20230118/ec45de7352ad4bd09aae45189a8eca99.gif" alt="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/20230118/ec45de7352ad4bd09aae45189a8eca99.gif"></p><h2 id="Vim批量注释"><a href="#Vim批量注释" class="headerlink" title="Vim批量注释"></a>Vim批量注释</h2><p>我们将<code>/etc/profile</code>考到桌面进行练习</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/profile ~/</span><br></pre></td></tr></table></figure><h3 id="指令行模式注释"><a href="#指令行模式注释" class="headerlink" title="指令行模式注释"></a>指令行模式注释</h3><p>我们使用vim打开刚刚考过来的profile文件，使用指令行进行替换</p><ul><li>在每行行首加上<code>#</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/^/#/g</span><br></pre></td></tr></table></figure><ul><li>取消每行行首的<code>#</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/^#//g</span><br></pre></td></tr></table></figure><ul><li>在每行行首加上<code>//</code>进行注释</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/^/\/\//g</span><br></pre></td></tr></table></figure><ul><li>取消每行行首的<code>//</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/^\/\//g</span><br></pre></td></tr></table></figure><ul><li>在1到10行行首加上<code>#</code>注释</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:1,10s/^/#/g</span><br></pre></td></tr></table></figure><ul><li>替换文中<code>pathmunge</code>为<code>linux</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/pathmunge/linux/g</span><br></pre></td></tr></table></figure><ul><li>撤销所有操作</li></ul><h3 id="可视块批量注释"><a href="#可视块批量注释" class="headerlink" title="可视块批量注释"></a>可视块批量注释</h3><ul><li>使用可视块以块为区域进行选择<code>Ctrl+v</code>第5到第10行行首</li><li>按<code>I(大写i)</code>进行行首插入</li><li>插入一个<code>#</code>加一个<code>空格</code></li><li>按<code>ESC</code>退出编辑即可生效</li></ul><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>这节课没有讲什么命令，主要就是<code>vim</code>编辑器的使用，以后我们编辑文件就不用再依赖图形窗口进行编辑了</p><p>但这个vim的指令和快捷键太多了，这个只能大家自己在使用时慢慢用，慢慢的就熟悉了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;在上节课讲文件描述符的时候应该是有提到过在Linux中一切皆文件，包括鼠标、键盘、网卡等这些硬件在内，所以我们在使用Linux操作系统中需要</summary>
      
    
    
    
    <category term="Linux菜鸟入门" scheme="https://study.kevinlu98.cn/categories/Linux%E8%8F%9C%E9%B8%9F%E5%85%A5%E9%97%A8/"/>
    
    
    <category term="linux" scheme="https://study.kevinlu98.cn/tags/linux/"/>
    
    <category term="vim" scheme="https://study.kevinlu98.cn/tags/vim/"/>
    
  </entry>
  
  <entry>
    <title>(三)重定向与管道</title>
    <link href="https://study.kevinlu98.cn/2023/01/15/zhong-ding-xiang-yu-guan-dao.html"/>
    <id>https://study.kevinlu98.cn/2023/01/15/zhong-ding-xiang-yu-guan-dao.html</id>
    <published>2023-01-15T02:39:00.000Z</published>
    <updated>2023-01-22T04:31:56.774Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>不知道大家上节课那些命令掌握的怎么样，这些命令一定要自己亲自去敲一遍才能加深印象，不用死记硬背，用的次数多了自然就记住了</p><h2 id="本节用到的命令"><a href="#本节用到的命令" class="headerlink" title="本节用到的命令"></a>本节用到的命令</h2><h3 id="wc命令"><a href="#wc命令" class="headerlink" title="wc命令"></a>wc命令</h3><p>wc命令，全称是<code>word count</code>，并不是你们想的那样，主要用于计算文件的字节数、单词数、或是列数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wc [options] [name...]</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>-c</td><td>字节数</td></tr><tr><td>-l</td><td>行数</td></tr><tr><td>-w</td><td>单词数(这里的单词是英文意义上的，以空白隔开)</td></tr></tbody></table><h3 id="sort命令"><a href="#sort命令" class="headerlink" title="sort命令"></a>sort命令</h3><p>sort命令，顾名思义就是用于排序的命令，主要可针对文本文件的内容，以行为单位来排序</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort [options] name</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>-b</td><td>忽略每行前面开始出的空格字符</td></tr><tr><td>-f</td><td>忽略大小写</td></tr><tr><td>-t split</td><td>指定排序时所用的栏位分隔字符，split为分隔字符</td></tr><tr><td>-n</td><td>依照数值的大小排序</td></tr><tr><td>-r</td><td>以相反的顺序来排序</td></tr><tr><td>-k field1 [fieldN…]</td><td>按指定的列进行排序，field为列</td></tr><tr><td>-o output</td><td>将排序后的结果存入指定的文件，output为文件名</td></tr></tbody></table><p><strong>举例说明：</strong></p><p>创建一个<code>score.txt</code>文件内容如下，假设是学生的成绩</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xiaomi 60</span><br><span class="line">laowang 78</span><br><span class="line">zhangsan 90</span><br><span class="line">Lisi 56</span><br><span class="line">wangwu 89</span><br><span class="line">Zhaoliu 100</span><br><span class="line">tianqi 30</span><br></pre></td></tr></table></figure><p>按学生名字顺序输出</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort -f score.txt</span><br></pre></td></tr></table></figure><p>按学生成绩倒序输出</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort -nrk2 score.txt</span><br></pre></td></tr></table></figure><h3 id="grep命令"><a href="#grep命令" class="headerlink" title="grep命令"></a>grep命令</h3><p>为了方便我们后面的演示，这里学一个比较重要的命令<code>grep</code>，它与<code>sed</code>及<code>awk</code>被称为Linux文本处理三剑客，后面会详细介绍另外两个</p><p>grep命令能够在一个或多个文件中，搜索某一特定的字符模式（也就是正则表达式），此模式可以是单一的字符、字符串、单词或句子</p><p>正则表达式：描述一组字符串的一个模式，正则表达式的构成模仿了数学表达式，通过使用操作符将较小的表达式组合成一个新的表达式，这个学过一些编程语言的朋友们应该或多或少都有了解，这里就只做简单说明，如果感兴趣可以看看菜鸟教程里的相关介绍：<a href="https://www.runoob.com/regexp/regexp-tutorial.html">正则表达式 - 教程</a></p><table><thead><tr><th>通配符</th><th>含义</th></tr></thead><tbody><tr><td>*</td><td>将匹配 0 个（即空白）或多个字符前面出现的字符</td></tr><tr><td>.</td><td>将匹配任何一个字符，且只能是一个字符</td></tr><tr><td>[abc]</td><td>匹配方括号中的任意一个字符，括号内为做任意数量的任意字符</td></tr><tr><td>[^abc]</td><td>匹配除方括号中字符外的所有字符，括号内为做任意数量的任意字符</td></tr><tr><td>^</td><td>以后面的字符开头</td></tr><tr><td>$</td><td>以前面的字符结尾</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep [options] keyword name... #keyword为正则表达式，name为文件名</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>-c</td><td>仅列出文件中包含keyword的行数</td></tr><tr><td>-i</td><td>忽略模式中的字母大小写</td></tr><tr><td>-l</td><td>列出带有匹配行的文件名</td></tr><tr><td>-n</td><td>在每一行的最前面列出行号</td></tr><tr><td>-v</td><td>列出没有匹配模式的行</td></tr><tr><td>-r</td><td>递归查找</td></tr></tbody></table><p>我们以<code>/etc/passwd</code>文件为例对该命令做一个简单的认识</p><p><strong>例1：查找文件中包含me的行</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &#x27;me&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><p><strong>例2：在上述的的基础上输出行号</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -n &#x27;me&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><p><strong>例3：列出共有多少行以s开头n结尾的行数</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -c &#x27;^s.*n$&#x27; /etc/passwd</span><br></pre></td></tr></table></figure><p><strong>例4：列出&#x2F;etc目录下以s开头n结尾的文件及行号，并忽略错误输出</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -nr &#x27;^s.*n$&#x27; /etc/* 2&gt;/dev/null</span><br></pre></td></tr></table></figure><h2 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h2><h3 id="基本概念介绍"><a href="#基本概念介绍" class="headerlink" title="基本概念介绍"></a>基本概念介绍</h3><p>在<code>Liunx shell</code>中，重定向为意思为改变标准输入输出的方向，重定向分为两种，输入重定向和输出重定向，这么说可能有些抽象，先看一些概念</p><ul><li><p>什么是输入输出方向</p><ul><li><strong>输入方向：</strong>数据从哪里流向程序</li><li><strong>输出方向：</strong>数据从程序流向哪里</li></ul></li><li><p>什么是标准的输入入输出方向</p><ul><li><strong>标准输入方向：</strong>数据默认的输入方向为从键盘流向程序</li><li><strong>标准输出方向：</strong>数据默认的输出方向为从程序流向显示器</li></ul></li><li><p>什么是输入输出重定向</p><ul><li><strong>输入重定向：</strong>改变了数据的标准输入方向，即数据从其它地方流入程序</li><li><strong>输出重定向：</strong>改变了数据的标准输出方向，即数据从程序流入其它地方</li></ul></li></ul><p>看完这些概念大家是不是已经蒙了，这个没关系，后面会有例子帮大家理清这些的</p><h3 id="文件描述符"><a href="#文件描述符" class="headerlink" title="文件描述符"></a>文件描述符</h3><p>在Linux中，一切皆文件，包括标准输入设备（键盘）和标准输出设备（显示器）在内的所有计算机硬件都是文件，为了区分这些打开的文件，Linux会为每个文件有一个整数做标识，这个整数就被称为文件描述符（File Descriptor），相当于一个非负的文件索引，我们可以通过文件描述符操作相应的文件</p><p>在LLinux进程中，会默认打开三个文件描述符</p><table><thead><tr><th>文件描述符</th><th>文件名</th><th>类型</th><th>硬件</th></tr></thead><tbody><tr><td>0</td><td>&#x2F;dev&#x2F;stdin</td><td>标准输入文件</td><td>键盘</td></tr><tr><td>1</td><td>&#x2F;dev&#x2F;stdout</td><td>标准输出文件</td><td>显示器</td></tr><tr><td>2</td><td>&#x2F;dev&#x2F;stderr</td><td>标准错误输出文件</td><td>显示器</td></tr></tbody></table><p>一般来说，我们打开文件后占用一个文件描述符，由于0、1、2已被标准文件描述符占用，他就可以往后找一个没有被占用的文件描述符来占用</p><p>大家知道有这么个东西就行了，这个用的不多，就知道我上面例出的三个的意思就行，如果大家想要深入了解这块内容，大家可以看看CSDN上的这篇帖子<a href="https://blog.csdn.net/luseysd/article/details/123222993">彻底弄懂 Linux 下的文件描述符（fd）</a></p><h3 id="输出重定向"><a href="#输出重定向" class="headerlink" title="输出重定向"></a>输出重定向</h3><p>输出重定向是指命令的结果不再输出到显示器上，而是输出到如文件中。这样做的最大好处就是把程序的输出结果保存起来，当我们需要的时候可以随时查询</p><p>在Linux中有如下的输出重定向符号</p><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>command &gt;file</td><td>以覆盖的方式，把 command 的正确输出结果输出到 file 文件中</td></tr><tr><td>command &gt;&gt;file</td><td>以追加的方式，把 command 的正确输出结果输出到 file 文件中</td></tr><tr><td>command n&gt;file</td><td>以覆盖的方式，把文件描述符为 n 的文件重定向到 file文件中</td></tr><tr><td>command n&gt;&gt;file</td><td>以追加的方式，把文件描述符为 n 的文件重定向到 file文件中</td></tr><tr><td>command &gt;file n&gt;&amp;m</td><td>以覆盖的方式，把文件描述符为n与文件描述符为m的输出合并到file文件中</td></tr></tbody></table><p>当描述符为1时可以不写，默认就是1</p><h4 id="例1：标准输出"><a href="#例1：标准输出" class="headerlink" title="例1：标准输出"></a>例1：标准输出</h4><p><strong>把&#x2F;etc下的文件详情输出到桌面的demo1.txt中</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -l /etc 1&gt; ~/Desktop/demo1.txt</span><br><span class="line">ls -l /etc &gt; ~/Desktop/demo1.txt</span><br></pre></td></tr></table></figure><h4 id="例2：错误输出"><a href="#例2：错误输出" class="headerlink" title="例2：错误输出"></a>例2：错误输出</h4><p><strong>把错误输出重定向到桌面的err.txt中</strong></p><p>命令正确执行是没有错误信息的，我们必须刻意地让命令执行出错</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls abcd.aaa 2&gt;err.txt</span><br></pre></td></tr></table></figure><h4 id="例3：综合练习"><a href="#例3：综合练习" class="headerlink" title="例3：综合练习"></a>例3：综合练习</h4><p><strong>执行下面的程序完成相关操作</strong></p><p>在桌面创建名为<code>output.sh</code>的文件，内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">while :</span><br><span class="line">do</span><br><span class="line">username=`cat /proc/sys/kernel/random/uuid | md5sum |cut -c 1-9`</span><br><span class="line">path=`cat /proc/sys/kernel/random/uuid | md5sum |cut -c 1-9`</span><br><span class="line">echo `date` &quot;user [$username] view file: $path&quot;</span><br><span class="line">ls $path</span><br><span class="line">sleep 1</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>在桌面执行如下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x output.sh</span><br></pre></td></tr></table></figure><p>运行文件可以查看效果</p><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/1673760198500.png"></p><p>将正常输出保留在屏幕，错误输出到桌面的<code>err.log</code>的文件中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./output.sh 2&gt;err.log</span><br></pre></td></tr></table></figure><p>将错误输出保留在屏幕，正常输出到<code>out.log</code>的文件中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./output.sh 1&gt;out.log</span><br></pre></td></tr></table></figure><p>将错误输出到<code>err.log</code>文件中，正常输出到<code>out.log</code>的文件中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./output.sh 1&gt;out.log 2&gt;err.log</span><br></pre></td></tr></table></figure><p>将错误输出与正常输出合并输出到<code>application.log</code>文件中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./output.sh &gt;application.log 2&gt;&amp;1 # 把标准输出重定向到application.log的文件中，然后把错误输出合并到标准输出中</span><br></pre></td></tr></table></figure><h4 id="x2F-dev-x2F-null-文件"><a href="#x2F-dev-x2F-null-文件" class="headerlink" title="&#x2F;dev&#x2F;null 文件"></a>&#x2F;dev&#x2F;null 文件</h4><p>上节课我们讲过，<code>/dev</code>目录是存在设备的特殊目录，这个目录下有个<code>null</code>设备，即为一个空白设备，有时我们不想把信息输出到屏幕，也不想输出到文件，就可以重定向到此，断续以上面的程序举例</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./output.sh &gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure><h3 id="输入重定向"><a href="#输入重定向" class="headerlink" title="输入重定向"></a>输入重定向</h3><p>与输出重定向类似，输入重定向是改变输入的方向，不再使用键盘作为命令输入的来源，而是使用文件</p><p>在Linux中有如下的输入重定向符号</p><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>command &lt;file</td><td>将 file 文件中的内容作为 command 的输入</td></tr><tr><td>command &lt;&lt;END</td><td>从标准输入（键盘）中读取数据，直到遇见分界符 END 才停止（分界符可以是任意的字符串，用户自己定义，常见的有EOF：end of file）</td></tr></tbody></table><h4 id="例1：统计标准输入的信息"><a href="#例1：统计标准输入的信息" class="headerlink" title="例1：统计标准输入的信息"></a>例1：统计标准输入的信息</h4><p>我们可以把标准输入作为wc命令的输入来计统计我们从键盘字符的信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wc &lt;&lt;EOF</span><br><span class="line">123456</span><br><span class="line">hello world</span><br><span class="line">i amd lengwen</span><br><span class="line">kevinlu98.cn</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="例2：将用户的输入输出到文件"><a href="#例2：将用户的输入输出到文件" class="headerlink" title="例2：将用户的输入输出到文件"></a>例2：将用户的输入输出到文件</h4><p>我们希望将我们的输入直接输出到文件中，这样可以方便快捷的创建文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF&gt;file.txt</span><br><span class="line">hello</span><br><span class="line">i amd lengwen</span><br><span class="line">my site is kevinlu98.cn</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h2 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h2><p>Linux除了有上面的输入输出重定向，还有一种功能，就是可以将两个或者多个命令（程序或者进程）连接到一起，把一个命令的输出作为下一个命令的输入，以这种方式连接的两个或者多个命令就形成了<strong>管道（pipeline）</strong></p><p>Linux 管道使用竖线<code>|</code>连接多个命令，这被称为<strong>管道符</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">command1 | command2</span><br><span class="line">command1 | command2 [|commandN...]</span><br></pre></td></tr></table></figure><p>当在两个命令之间设置管道时，管道符<code>|</code>左边命令的输出就变成了右边命令的输入。只要第一个命令向标准输出写入，而第二个命令是从标准输入读取，那么这两个命令就可以形成一个管道，这里需要注意，command2 必须可以处理 command1 的输出结果</p><p>管道也是一种文件，管道中的读数据是一次性操作，数据一旦被读，它就从管道中被抛弃</p><h3 id="例1：查找文件是否在目录内"><a href="#例1：查找文件是否在目录内" class="headerlink" title="例1：查找文件是否在目录内"></a>例1：查找文件是否在目录内</h3><p><strong>查找passwd是否在&#x2F;etc目录下</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /etc/ | grep &#x27;passwd&#x27;</span><br></pre></td></tr></table></figure><p><strong>列出当前目录下.bashrc的详细信息</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -a | grep &#x27;passwd&#x27;</span><br></pre></td></tr></table></figure><h3 id="例2：按文件大小顺序输出"><a href="#例2：按文件大小顺序输出" class="headerlink" title="例2：按文件大小顺序输出"></a>例2：按文件大小顺序输出</h3><p>我们先列出文件的详细信息，文件的大小在第5列，然后用数值方式对其逆向输出</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l | sort -nrk5</span><br></pre></td></tr></table></figure><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>这节课我们主要讲了重定向及管道，这两个都是改变文件的输出，不同的是重定向是连接命令的输出与文件，而管道是连接命令与命令的，这两个知识点在日常工作中用到的频率还是非常高的，希望大家可以好好理解一下，自己多动手写一写，想一些需求自己做一做</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;不知道大家上节课那些命令掌握的怎么样，这些命令一定要自己亲自去敲一遍才能加深印象，不用死记硬背，用的次数多了自然就记住了&lt;/p&gt;
&lt;h2 i</summary>
      
    
    
    
    <category term="Linux菜鸟入门" scheme="https://study.kevinlu98.cn/categories/Linux%E8%8F%9C%E9%B8%9F%E5%85%A5%E9%97%A8/"/>
    
    
    <category term="linux" scheme="https://study.kevinlu98.cn/tags/linux/"/>
    
    <category term="centos" scheme="https://study.kevinlu98.cn/tags/centos/"/>
    
    <category term="重定向" scheme="https://study.kevinlu98.cn/tags/%E9%87%8D%E5%AE%9A%E5%90%91/"/>
    
    <category term="管道" scheme="https://study.kevinlu98.cn/tags/%E7%AE%A1%E9%81%93/"/>
    
    <category term="grep" scheme="https://study.kevinlu98.cn/tags/grep/"/>
    
  </entry>
  
  <entry>
    <title>(二)认识Linux文件系统及相关命令</title>
    <link href="https://study.kevinlu98.cn/2023/01/15/ren-shi-wen-jian-xi-tong-ji-xiang-guan-ming-ling.html"/>
    <id>https://study.kevinlu98.cn/2023/01/15/ren-shi-wen-jian-xi-tong-ji-xiang-guan-ming-ling.html</id>
    <published>2023-01-14T18:51:00.000Z</published>
    <updated>2023-01-17T11:52:39.410Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>上节课到现在已经过了好久了，因为上个月才入职新单位，转了下技术栈，一直在学golang及k8s那些东西，所以就没有更新视频，所幸到现在基本已经能参与到项目团队的项目开发中了，就继续给大家录教程</p><p>我发现之前录的教程太乱了，第一课的安装倒无所谓，但第二节的命令讲的太乱了，我希望这个文档可以在大家学完之后查看什么资料直接翻文档就能很快的找到，所以第二节就录新录制下</p><h2 id="文档位置"><a href="#文档位置" class="headerlink" title="文档位置"></a>文档位置</h2><p>之前文档一直在我博客放着，本来我的博客只是写写文章，偶尔发一些技术帖，加上这些教程的文档后难免显的有些乱了，我专门用<a href="https://hexo.io/zh-cn/">hexo</a>搭建了一个静态站点用于放课件，大家如果感兴趣了也可以网上搜搜，比较简单，站点地址：<a href="https://study.kevinlu98.cn/">study.kevinlu98.cn</a></p><h2 id="Linux文件结构"><a href="#Linux文件结构" class="headerlink" title="Linux文件结构"></a>Linux文件结构</h2><p>在Linux中，文件系统是一棵树，<code>/</code>为其根结点，形状大致如下：</p><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/20221126/b8ipofh4gn1669448309044.png" alt="img"></p><h3 id="常见的二级目录"><a href="#常见的二级目录" class="headerlink" title="常见的二级目录"></a>常见的二级目录</h3><ul><li>&#x2F;bin：存放二进制可执行命令目录</li><li><strong>&#x2F;home：用户主目录的基点目录，默认情况每个用户主目录都设在该目录下，如默认：用户user01的主目录是&#x2F;home&#x2F;user01，可用~&#x2F;user01表示</strong></li><li>&#x2F;lib：存放标准程序设计库目录，又叫动态链接共享库目录，目录中文件类似windows里的后缀名为dll的文件</li><li><strong>&#x2F;etc：存放系统管理和配置文件目录</strong></li><li>&#x2F;dev：存放设备特殊文件目录，如声卡文件，磁盘文件等</li><li><strong>&#x2F;usr：最庞大的目录，存放应用程序和文件目录</strong></li><li>&#x2F;proc：虚拟目录，是系统内存的映射，可直接访问这个目录来获取系统信息</li><li>&#x2F;root：系统管理员的主目录（特权阶级）</li><li>&#x2F;var：存放系统产生的经常变化文件的目录，例如打印机、邮件等假脱机目录、日志文件、格式化后的手册页以及一些应用程序的数据文件等</li><li>&#x2F;tmp：存放公用临时文件目录</li><li>&#x2F;sbin 系统管理命令，这里存放的是系统管理员使用的管理程序</li><li>&#x2F;mnt 系统提供这个目录是让用户临时挂载其他的文件系统</li><li>&#x2F;lost+found 这个目录平时是空的，用于存放系统非正常关机而留下未保存的文件</li></ul><h3 id="Linux文件路径-重要"><a href="#Linux文件路径-重要" class="headerlink" title="Linux文件路径(重要)"></a>Linux文件路径(重要)</h3><ul><li><p>路径相关的概念：</p><ul><li><p><code>.</code>：代表当前目录</p></li><li><p><code>..</code>：代表父级目录</p></li><li><p><code>/</code>：linux中文件分隔或根目录</p></li><li><p><code>~</code>：当前用户的家目录</p></li></ul></li><li><p>绝对路径：从根(&#x2F;)一直到目标文件的路径</p></li><li><p>相对路径：相对于当前文件的父目录的路径</p></li></ul><p>大家可以做个类比，以我们现在生活中的地址为例</p><p>这个大家第一次听可能有些陌生，这点不用担心，根据我的教程来，大家会在使用Linux过程中不知不觉的把这个知识撑握</p><h2 id="Linux行提示符"><a href="#Linux行提示符" class="headerlink" title="Linux行提示符"></a>Linux行提示符</h2><p>我们右键打开终端，可以看到如下的行提示符</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[lengwen@localhost ~]$</span><br></pre></td></tr></table></figure><table><thead><tr><th>名称</th><th>含义</th></tr></thead><tbody><tr><td>lengwen</td><td>表示当前打开shell的用户</td></tr><tr><td>@</td><td>分隔符</td></tr><tr><td>localhost</td><td>主机名</td></tr><tr><td>~</td><td>当前据目录(<strong>在Linux中<code>~</code>可以快捷的代替当前用户的家目录</strong>)</td></tr><tr><td>$</td><td>身份提示符(<strong># 表示超级用户；$ 表示普通用户</strong>)</td></tr></tbody></table><h2 id="认识命令"><a href="#认识命令" class="headerlink" title="认识命令"></a>认识命令</h2><h3 id="命令的执行"><a href="#命令的执行" class="headerlink" title="命令的执行"></a>命令的执行</h3><ul><li>命令必须在行提示符之后输入</li><li>命令格式：命令 参数名 参数值</li><li>Ctrl + C：撤销命名的执行</li><li>命令参数<ul><li>-参数：单词缩写</li><li>–参数：单词的全拼</li></ul></li></ul><h3 id="命令的帮助"><a href="#命令的帮助" class="headerlink" title="命令的帮助"></a>命令的帮助</h3><h4 id="–help"><a href="#–help" class="headerlink" title="–help"></a>–help</h4><p>通常情况下，我们在linux中可以使用<code>命令名称 --help</code>来查看一个命令的帮助信息，当然也有些开发着没有为命令写对应的帮助信息，但我们用到的系统命令都是有很标准的命令，都是有帮助信息的</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name --help</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">例</span></span><br><span class="line">vim --help</span><br></pre></td></tr></table></figure><p>帮助文档中的一些符号解释</p><table><thead><tr><th>符号</th><th>含义</th></tr></thead><tbody><tr><td>[ ]</td><td>选择加入的内容，可加可不加</td></tr><tr><td>…</td><td>加入的内容个数任意</td></tr></tbody></table><h4 id="man命令"><a href="#man命令" class="headerlink" title="man命令"></a>man命令</h4><p>linux下的man命令是一个帮助命令，掌握这个命令可以让我们更好的学习linux，通过man指令可以查看Linux中的指令帮助、配置文件帮助和编程帮助等信息。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">man [name]</span><br><span class="line">man vim</span><br></pre></td></tr></table></figure><h2 id="文件目录相关命令"><a href="#文件目录相关命令" class="headerlink" title="文件目录相关命令"></a>文件目录相关命令</h2><p>这节课在给大家讲一些常用的命令，主要是让大家对linux命令有个大概的认识，我整理的这些命令的参数并不是所有的，只是些最常用的参数，但日常使用是绝对够了；大家也可以输出<code>命令名 --help</code>或<code>man 命令</code>可来查看其它参数，但这些大部分情况下都用不到</p><h3 id="pwd命令"><a href="#pwd命令" class="headerlink" title="pwd命令"></a>pwd命令</h3><p>pwd命令：全称Print Working Directory，也就是打印目前所在目录，这里是以全绝对路径打印</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwd</span><br></pre></td></tr></table></figure><h3 id="cd命令"><a href="#cd命令" class="headerlink" title="cd命令"></a>cd命令</h3><p>cd命令：全称是Change Directory，用于改变当前所在目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd [path]</span><br></pre></td></tr></table></figure><h3 id="ls命令"><a href="#ls命令" class="headerlink" title="ls命令"></a>ls命令</h3><p>ls命令：全称list directory contents，显示文件的文件名与相关属性。（目前工作目录所含之文件及子目录）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls [-options] [name...]</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>-a</td><td>all， 显示所有文件及目录 (. 开头的隐藏文件也会列出)</td></tr><tr><td>-A</td><td>同-a ，但不列出 . (目前目录) 及 .. (父目录)</td></tr><tr><td>-l</td><td>以长格式显示目录下的内容列表，包括文件的<strong>权限、链接数、所有者名称和组所有者、文件大小、最后修改日期时间和文件&#x2F;目录名称</strong></td></tr><tr><td>-d</td><td>仅列出目录本身，而不是列出目录内的文件数据</td></tr><tr><td>-R</td><td>若目录下有文件，则以下之文件亦皆依序列出</td></tr></tbody></table><p><strong>有时候我们可以看到别人用ll命令，这个的输出等同于ls -l</strong></p><h3 id="touch命令"><a href="#touch命令" class="headerlink" title="touch命令"></a>touch命令</h3><p>touch命令用于修改文件或者目录的时间属性，包括访问时间和修改时间，若文件不存在，系统会建立一个新的文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch [options] name...</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>-a</td><td>若文件存在时只修改访问时间为当前时间</td></tr><tr><td>-d</td><td>使用指定字符串表示时间而非当前时间</td></tr><tr><td>-m</td><td>若文件存在时只修改更新时间为当前时间</td></tr></tbody></table><p>不过我们用这个命令基本都不会操作文件的这些时间，都是用它创建一个空文件</p><h3 id="mkdir命令"><a href="#mkdir命令" class="headerlink" title="mkdir命令"></a>mkdir命令</h3><p>mkdir：全称make directory，用于创建一个新的目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir [options] name...</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>-p</td><td>帮助你直接将所需要的目录(包含上一级目录)递归创建起来！</td></tr></tbody></table><h3 id="cp命令"><a href="#cp命令" class="headerlink" title="cp命令"></a>cp命令</h3><p>cp命令：全称copy，命令主要用于复制文件或目录。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">source</span> 可以使用通配符*，如*.txt，aa*等</span></span><br><span class="line">cp [options] source dest #source与dest要么都文件，要么都目录</span><br><span class="line"></span><br><span class="line">cp [options] source... directory # source... 一个或多个文件</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>-f</td><td>force 强制的意思，如果目标文件已经存在，不会询问而直接覆盖；</td></tr><tr><td>-i</td><td>与 <strong>-f</strong> 选项相反，在覆盖目标文件之前给出提示，要求用户确认是否覆盖，回答 <strong>y</strong> 时目标文件将被覆盖</td></tr><tr><td>-r</td><td>若给出的源文件是一个目录文件，此时将复制该目录下所有的子目录和文件。</td></tr></tbody></table><h3 id="rm命令"><a href="#rm命令" class="headerlink" title="rm命令"></a>rm命令</h3><p>rm命令：全称remove，用于移除文件或目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm [options] name... #这里的name可以是文件，也可以是目录</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>-f</td><td>就是 force 的意思，也不会出现警告信息</td></tr><tr><td>-i</td><td>互动模式，在删除前会询问使用者是否动作</td></tr><tr><td>-r</td><td>递归删除，会删除目标目录及目录下的文件及子目录及子目录下的文件…</td></tr></tbody></table><h3 id="mv命令"><a href="#mv命令" class="headerlink" title="mv命令"></a>mv命令</h3><p>mv命令：全称move，主要用于移动文件与目录，或修改名称，对这里的移动解释一下，如果源文件(目录)与目标(目录)在同一块磁盘，则命令只是做了一个重命名的操作，反之则先复制再删除</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv [options] source dest #source与dest要么都文件，要么都目录</span><br><span class="line">mv [options] source... directory # 将所有source移动到directory目录下</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>-f</td><td>force 强制的意思，如果目标文件已经存在，不会询问而直接覆盖；</td></tr><tr><td>-i</td><td>与 <strong>-f</strong> 选项相反，在覆盖目标文件之前给出提示，要求用户确认是否覆盖，回答 <strong>y</strong> 时目标文件将被覆盖</td></tr></tbody></table><h3 id="cat命令"><a href="#cat命令" class="headerlink" title="cat命令"></a>cat命令</h3><p>cat命令：由第一行开始显示文件内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat [options] name...</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>-b</td><td>列出行号，仅针对非空白行做行号显示，空白行不标行号</td></tr><tr><td>-E</td><td>将结尾的断行字节 $ 显示出来</td></tr><tr><td>-n</td><td>列印出行号，连同空白行也会有行号，与 -b 的选项不同</td></tr></tbody></table><h3 id="less命令"><a href="#less命令" class="headerlink" title="less命令"></a>less命令</h3><p>less命令：一页一页的查看文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">less name</span><br></pre></td></tr></table></figure><p>less这里没有常用参数，但在less运行时有一些按键大家在知道</p><table><thead><tr><th>按键</th><th>作用</th></tr></thead><tbody><tr><td>空格</td><td>向下翻动一页</td></tr><tr><td>b</td><td>向上翻动一页</td></tr><tr><td>pagedown</td><td>向下翻动一页</td></tr><tr><td>pageup</td><td>向上翻动一页</td></tr><tr><td>&#x2F;字串</td><td>向下搜寻『字串』的功能</td></tr><tr><td>?字串</td><td>向上搜寻『字串』的功能</td></tr><tr><td>n</td><td>重复前一个搜寻</td></tr><tr><td>N</td><td>反向的重复前一个搜寻</td></tr><tr><td>q</td><td>关闭 less</td></tr></tbody></table><h3 id="head命令"><a href="#head命令" class="headerlink" title="head命令"></a>head命令</h3><p>head命令：取出文件前面几行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head [options] name...</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>-n</td><td>后面接数字，代表显示几行的意思</td></tr></tbody></table><h3 id="tail命令"><a href="#tail命令" class="headerlink" title="tail命令"></a>tail命令</h3><p>tail命令：取出文件后面几行，该命令有一个重要的功能就是可以观察打到文件中的日志</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail [options] name... </span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>-n</td><td>后面接数字，代表显示几行的意思</td></tr><tr><td>-f</td><td>表示持续侦测后面所接的档名，要等到按下[ctrl]-c才会结束tail的侦测</td></tr></tbody></table><h2 id="shell中的一些快捷键"><a href="#shell中的一些快捷键" class="headerlink" title="shell中的一些快捷键"></a>shell中的一些快捷键</h2><table><thead><tr><th>快捷键</th><th>作用</th></tr></thead><tbody><tr><td><strong>Tab</strong></td><td><strong>在系统中table键可以自动补齐存在的命令，文件名称和某些命令的参数</strong></td></tr><tr><td><strong>上下</strong></td><td><strong>历史的上一条命令，下一条命令</strong></td></tr><tr><td>左右</td><td>一个字符一个字符移动</td></tr><tr><td><strong>Ctrl + a</strong></td><td><strong>光标移动到行首</strong></td></tr><tr><td><strong>Ctrl + e</strong></td><td><strong>光标移动到行尾</strong></td></tr><tr><td>Ctrl + u</td><td>光标所在位置删除到行首</td></tr><tr><td>Ctrl + k</td><td>光标所在位置删除到行尾</td></tr><tr><td><strong>Ctrl + c</strong></td><td><strong>撤销以输入的命令</strong></td></tr><tr><td><strong>Ctrl + d</strong></td><td><strong>退出当前用户环境</strong></td></tr><tr><td><strong>Ctrl + L</strong></td><td><strong>清空屏幕</strong></td></tr><tr><td>Ctrl + Shift + c</td><td>复制</td></tr><tr><td>Ctrl + Shift + v</td><td>粘贴</td></tr><tr><td>Ctrl + shift + t</td><td>在现有shell中重新打开一个table</td></tr><tr><td>Ctrl + shift + n</td><td>在shell中打</td></tr><tr><td><strong>Ctrl + r + 关键字</strong></td><td><strong>调出最近一条含有关键字的命令</strong></td></tr></tbody></table><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>这节我们学习了一些Linux上常用的文件目录操作的命令，最后又给大家说了些快捷键，这些都是很基础的东西，在后续教程中会频繁的使用，大家学完一定多多练习，自己动手多写几遍感受一下比看我教程好几遍更有用</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;上节课到现在已经过了好久了，因为上个月才入职新单位，转了下技术栈，一直在学golang及k8s那些东西，所以就没有更新视频，所幸到现在基本已</summary>
      
    
    
    
    <category term="Linux菜鸟入门" scheme="https://study.kevinlu98.cn/categories/Linux%E8%8F%9C%E9%B8%9F%E5%85%A5%E9%97%A8/"/>
    
    
    <category term="linux" scheme="https://study.kevinlu98.cn/tags/linux/"/>
    
    <category term="基础命令" scheme="https://study.kevinlu98.cn/tags/%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>(一)Linux 系列教程介绍</title>
    <link href="https://study.kevinlu98.cn/2023/01/13/xi-lie-jiao-cheng-jie-shao.html"/>
    <id>https://study.kevinlu98.cn/2023/01/13/xi-lie-jiao-cheng-jie-shao.html</id>
    <published>2023-01-13T14:23:00.000Z</published>
    <updated>2023-01-17T11:51:09.210Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>录这套教程主要帮助那些对<code>Linux</code>了解很少但又想做一个初步学习的小伙伴，因为我们一般在找开发相关的工作面试时偶尔也会被问到，而且做为一名开发人员如果不会操作<code>Linux</code>操作系统确实也有些说不过去，因为一般我们在企业中用到的中间件、服务的部署等都是在<code>Linux</code>上，本期教程就带着大家来入门下<code>Linux</code>，学习了<code>Linux</code>操作后大家如果以后用Mac系统也会用起来得心应手</p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul><li><p>CentOS下载：</p><ul><li><a href="https://mirrors.tuna.tsinghua.edu.cn/">清华大学镜像站</a></li><li><a href="https://developer.aliyun.com/mirror/">阿里巴巴镜像站</a></li></ul></li><li><p>VMware下载：<a href="https://customerconnect.vmware.com/cn/downloads/#all_products">https://customerconnect.vmware.com/cn/downloads/#all_products</a></p><ul><li>Mac下载<strong>VMware Fusion</strong></li><li>Windows下载 <strong>VMware Workstation Pro</strong></li></ul></li></ul><h2 id="创建一个CentOS虚拟机"><a href="#创建一个CentOS虚拟机" class="headerlink" title="创建一个CentOS虚拟机"></a>创建一个CentOS虚拟机</h2><h3 id="Mac上的操作"><a href="#Mac上的操作" class="headerlink" title="Mac上的操作"></a>Mac上的操作</h3><ul><li>点击新建选择从光盘或映像中安装</li><li>选择我们的<code>iso</code>文件</li><li>一直点击继续直到结束</li><li>根据自己需要选择磁盘大小和内存大小及CPU</li><li>启动虚拟机</li></ul><h3 id="Windows上的操作"><a href="#Windows上的操作" class="headerlink" title="Windows上的操作"></a>Windows上的操作</h3><ul><li><p>创建虚拟机</p><ul><li>点击文件 -&gt; 新建虚拟机</li><li>选择典型，点击下一步</li></ul><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/f65f58840e434f8fa5bd5a493a8f0329.png" alt="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/f65f58840e434f8fa5bd5a493a8f0329.png"></p><ul><li>选择镜像文件点击下一步</li></ul><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/4fe69a3073a74b39bf4ceda34b8b2f30.png" alt="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/4fe69a3073a74b39bf4ceda34b8b2f30.png"></p><ul><li>选择安装位置点击下一步</li></ul><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/d1beb68be801425aad01a5c446a8f79e.png" alt="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/d1beb68be801425aad01a5c446a8f79e.png"></p><ul><li>根据需要调整磁盘大小</li></ul><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/c497762c1f454c8e8e9cc4d808794633.png" alt="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/c497762c1f454c8e8e9cc4d808794633.png"></p><ul><li>根据需要调整其它硬件</li></ul><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/908e7def33ff4e478df0b9ef7898c254.png" alt="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/908e7def33ff4e478df0b9ef7898c254.png"></p></li></ul><h2 id="安装虚拟机"><a href="#安装虚拟机" class="headerlink" title="安装虚拟机"></a>安装虚拟机</h2><ul><li>选择安装CentOS</li></ul><p>  <img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/20221126/a9mltm5ad91669436712809.png"></p><ul><li>选择语言并点击继续</li></ul><p>  <img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/20221126/tfl37tm9wd1669436832522.png"></p><ul><li>选择安装盘</li></ul><p>  <img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/20221126/f8qxpnno2n1669436904214.png"></p><ul><li>选择目标磁盘并点击done</li></ul><p>  <img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/20221126/07sei4si491669436952180.png"></p><ul><li>选择安装项</li></ul><p>  <img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/20221126/kxbj25huid1669436994485.png"></p><ul><li>由于我们是亲手，所以可以装一个图形桌面来方便我们学习和操作，选择GNOME 桌面，然后点击Done</li></ul><p>  <img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/20221126/z2eqvcqqwb1669437099534.png"></p><ul><li>设置完成之后就可以点击继续安装了</li></ul><p>  <img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/20221126/mj1ay3kmul1669437153942.png"></p><ul><li>在安装过程中设置root密码及我们个人的账户，等待安装完成</li></ul><p>  <img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/20221126/ny62q29krh1669437248487.png"></p><h2 id="初次启动"><a href="#初次启动" class="headerlink" title="初次启动"></a>初次启动</h2><ul><li>点击协议</li></ul><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/08e342efe2ea47c993718be242c837b8.png" alt="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/08e342efe2ea47c993718be242c837b8.png"></p><ul><li>点击同意然后点击Done</li></ul><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/877808368be14cc2b165397c3db0bf5f.png" alt="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/877808368be14cc2b165397c3db0bf5f.png"></p><ul><li>点击完成</li></ul><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/79953ca3283749489a369b8418ed69ac.png" alt="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/79953ca3283749489a369b8418ed69ac.png"></p><ul><li>输入密码进入系统后会有弹窗，不用管，一直点击Next</li></ul><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/d59e29e7cb3a4fa4a4626cd81e85ee34.png" alt="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/d59e29e7cb3a4fa4a4626cd81e85ee34.png"></p><h2 id="语言设置"><a href="#语言设置" class="headerlink" title="语言设置"></a>语言设置</h2><ul><li>点击关机按钮-&gt;设置图标</li></ul><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/71c8db9ac3924167bbb681ef0042e955.png" alt="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/71c8db9ac3924167bbb681ef0042e955.png"></p><ul><li>点击区域和语言</li></ul><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/8072dc2ada0b46deba409f283b2b70a0.png" alt="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/8072dc2ada0b46deba409f283b2b70a0.png"></p><ul><li>全部选择汉语</li></ul><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/ca94089e65444e5dbdc6620eca7dd303.png" alt="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/ca94089e65444e5dbdc6620eca7dd303.png"></p><ul><li>点击重启</li></ul><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/2d70035953eb4d789c254d291f351064.png" alt="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/2d70035953eb4d789c254d291f351064.png"></p><ul><li>重启后这里非常重要，一定选保留旧名称</li></ul><p><img src="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/4b24ccbd02694993824ec5e2f9207d50.png" alt="https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2059/4b24ccbd02694993824ec5e2f9207d50.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;录这套教程主要帮助那些对&lt;code&gt;Linux&lt;/code&gt;了解很少但又想做一个初步学习的小伙伴，因为我们一般在找开发相关的工作面试时偶尔也</summary>
      
    
    
    
    <category term="Linux菜鸟入门" scheme="https://study.kevinlu98.cn/categories/Linux%E8%8F%9C%E9%B8%9F%E5%85%A5%E9%97%A8/"/>
    
    
    <category term="linux" scheme="https://study.kevinlu98.cn/tags/linux/"/>
    
    <category term="vmware" scheme="https://study.kevinlu98.cn/tags/vmware/"/>
    
    <category term="centos" scheme="https://study.kevinlu98.cn/tags/centos/"/>
    
  </entry>
  
  <entry>
    <title>(二十三)登录功能及打包</title>
    <link href="https://study.kevinlu98.cn/2022/10/10/deng-lu-gong-neng-ji-da-bao.html"/>
    <id>https://study.kevinlu98.cn/2022/10/10/deng-lu-gong-neng-ji-da-bao.html</id>
    <published>2022-10-09T18:21:00.000Z</published>
    <updated>2023-01-17T11:51:09.221Z</updated>
    
    <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>上节课原计划是把登录也说了的，由于时间不够了，就把登录拿到这节课说，然后把之前遗留的小问题处理一下，最后再说说打包的功能</p><h2 id="异步修改"><a href="#异步修改" class="headerlink" title="异步修改"></a>异步修改</h2><p>我们之前做的异步实际是没有生效的，因为我们需要<code>spring</code>帮我们把这个类代理出来才行，我们在同一个类中就没有任作用，因为没有经过<code>spring</code>的代理</p><p>我们将两个发邮件的方法复制到<code>MailHelper</code>中或将<code>@Async</code>的注解加到<code>sendMail</code>方法就可以啦</p><p>在<code>Application</code>上加上<code>@EnableAsync</code>注解</p><h2 id="登录功能"><a href="#登录功能" class="headerlink" title="登录功能"></a>登录功能</h2><p>我们的后台是不希望被除了我们之外的其他人访问到的，所以我们需要对后台所有的请求进行登录拦截，对于在没有登录的前提下所有操作都跳转到登录页</p><ul><li>我们先定义登录页面的路由并修改页面表单</li><li>我们再写登录接口，如果用户名与密码都与我们配置的用户名密码相等我们就认为登录成功将登录成功的状态存在<code>Session</code>中，反之则返回登录页面且给其报<code>用户名或密码错误</code>的信息，密码加密我们可以直接用<code>Spring</code>的<code> DigestUtils.md5DigestAsHex</code>方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(String username, String password, Model model, HttpSession session)</span> &#123;</span><br><span class="line">  <span class="type">String</span> <span class="variable">pass</span> <span class="operator">=</span> DigestUtils.md5DigestAsHex(password.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">  <span class="keyword">if</span> (StringUtils.equals(username, webSite.getUsername()) &amp;&amp; StringUtils.equals(pass, webSite.getPassword())) &#123;</span><br><span class="line">    session.setAttribute(WebSite.LOGIN_SIGN, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/admin/&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    model.addAttribute(<span class="string">&quot;errorMsg&quot;</span>, <span class="string">&quot;用户名密码错误&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;admin/login&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/logout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">logout</span><span class="params">(HttpSession session)</span> &#123;</span><br><span class="line">  session.removeAttribute(WebSite.LOGIN_SIGN);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;admin/login&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/login.html&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">login</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;admin/login&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>在页面回显错误信息</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/plugin/font-awesome/css/font-awesome.min.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 自定义css文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/admin/css/login.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.lw-error-msg</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: coral;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-login-page&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-login-box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-left&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎登录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>冷文学习者-管理后台<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-right&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-error-msg&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;errorMsg&#125;&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;errorMsg != null&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/admin/login&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-input&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;用户名&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-input&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">readonly</span> <span class="attr">onfocus</span>=<span class="string">&quot;this.removeAttribute(&#x27;readonly&#x27;)&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-input&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>登录后台<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>Copyright © www.kevinlu98.cn All Rights Reserved.</span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            冷文学习者版权所有<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>定义一个拦截器实现<code>HandlerInterceptor</code>接口并覆写<code>preHandle</code>的方法，当<code>Session</code>中没有登录信息时我们直接转发到登录页面并给出<code>请登录后再进行操作的提示</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kevinlu98.intercepto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.kevinlu98.common.WebSite;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author: Mr丶冷文</span></span><br><span class="line"><span class="comment"> * Date: 2022/10/16 11:07</span></span><br><span class="line"><span class="comment"> * Email: kevinlu98@qq.com</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">sign</span> <span class="operator">=</span> (Boolean) session.getAttribute(WebSite.LOGIN_SIGN);</span><br><span class="line">    <span class="keyword">if</span> (Objects.nonNull(sign) &amp;&amp; sign) &#123;</span><br><span class="line">      <span class="comment">// 已登录</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      request.setAttribute(<span class="string">&quot;errorMsg&quot;</span>, <span class="string">&quot;请登录后进行操作&quot;</span>);</span><br><span class="line">      request.getRequestDispatcher(<span class="string">&quot;/admin/login.html&quot;</span>).forward(request, response);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>定义一个退出登录的路由，操作为清空<code>Session</code>中的登录信息</li><li>在<code>WebConfig</code>中的<code>addInterceptors</code>方法中启用拦截器，用<code>addPathPatterns</code>配置拦截的路由，用<code>excludePathPatterns</code>配置排除被拦截路由中的那些路由</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">  registry.addInterceptor(loginInterceptor)</span><br><span class="line">    .addPathPatterns(<span class="string">&quot;/admin/**&quot;</span>)</span><br><span class="line">    .excludePathPatterns(<span class="string">&quot;/admin/login&quot;</span>)</span><br><span class="line">    .excludePathPatterns(<span class="string">&quot;/admin/login.html&quot;</span>)</span><br><span class="line">    .excludePathPatterns(<span class="string">&quot;/admin/logout&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="打包和运行"><a href="#打包和运行" class="headerlink" title="打包和运行"></a>打包和运行</h2><p>因为我们站点很多信息都存在于<code>application.yml</code>的配置文件中，我们打完包之后<code>application.yml</code>都会打进<code>jar</code>包中，如果我们想更改一下站点信息，我们还需要去改<code>application.yml</code>并重新打包，这样的话就难免有些不太友好，我们这里可以在启动时手动指定加载外部的<code>yml</code>文件</p><ul><li>我们可以打完包手动将项目的<code>application.yml</code>复制到外部</li><li>我们可以利用打包插件自动将<code>application.yml</code>文件复制到外部</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">include</span>&gt;</span>*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">include</span>&gt;</span>*.yml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">include</span>&gt;</span>*/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">include</span>&gt;</span>*/*.yml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>启动时使用<code>--spring.config.local=xxx.yml</code>来启动我们的项目</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h2&gt;&lt;p&gt;上节课原计划是把登录也说了的，由于时间不够了，就把登录拿到这节课说，然后把之前遗留的小问题处理一下，最后再说说打包的功能&lt;/p&gt;
&lt;h2 i</summary>
      
    
    
    
    <category term="个人博客项目" scheme="https://study.kevinlu98.cn/categories/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="java" scheme="https://study.kevinlu98.cn/tags/java/"/>
    
    <category term="springboot" scheme="https://study.kevinlu98.cn/tags/springboot/"/>
    
    <category term="个人博客" scheme="https://study.kevinlu98.cn/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="异常处理" scheme="https://study.kevinlu98.cn/tags/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>(二十二)后台其它功能的实现</title>
    <link href="https://study.kevinlu98.cn/2022/10/09/hou-tai-qi-ta-gong-neng-de-shi-xian.html"/>
    <id>https://study.kevinlu98.cn/2022/10/09/hou-tai-qi-ta-gong-neng-de-shi-xian.html</id>
    <published>2022-10-08T18:21:00.000Z</published>
    <updated>2023-01-17T11:51:09.221Z</updated>
    
    <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>前台功能我们已经完全完成了，我们现在来看看后台剩下的内容：控制台、评论管理及登录功能，这节课完了的博客项目就完了，下节课给大家说说我们的项目怎么部署到线上服务器</p><h2 id="评论管理"><a href="#评论管理" class="headerlink" title="评论管理"></a>评论管理</h2><ul><li>我们先来改造下页面，给左边加上一键已读的按钮，给右边加上评论过滤条件：全部、已读、未读的按钮</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn-group&quot;</span> <span class="attr">role</span>=<span class="string">&quot;group&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-bottom: 20px;&quot;</span> <span class="attr">aria-label</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;lw-add-btn&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-plus&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 新增<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;lw-read-all&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-circle-o&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 一键已读<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn-group&quot;</span> <span class="attr">role</span>=<span class="string">&quot;group&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-bottom: 20px;float: right&quot;</span> <span class="attr">aria-label</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span>  <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span>&gt;</span>已读<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span>  <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span>&gt;</span>未读<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>一键已读功能开发</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Mapper</span></span><br><span class="line"><span class="meta">@Modifying</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Query(&quot;update  Comment  set view = true where view = false &quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">readAll</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">//Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readAll</span><span class="params">()</span> &#123;</span><br><span class="line">  mapper.readAll();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Controller</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/read&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">read</span><span class="params">()</span> &#123;</span><br><span class="line">  service.readAll();</span><br><span class="line">  <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#lw-read-all&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">111</span>);</span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/admin/comment/read&#x27;</span>,</span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (res.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">        layer.<span class="title function_">msg</span>(<span class="string">&quot;保存成功&quot;</span>, &#123;<span class="attr">icon</span>: <span class="number">1</span>, <span class="attr">time</span>: <span class="number">500</span>&#125;, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          $(<span class="string">&#x27;#data-table&#x27;</span>).<span class="title function_">bootstrapTable</span>(<span class="string">&#x27;refresh&#x27;</span>, &#123;<span class="attr">silent</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        layer.<span class="title function_">msg</span>(res.<span class="property">message</span>, &#123;<span class="attr">icon</span>: <span class="number">2</span>&#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>给<code>BSTable</code>表格一个双击事件，参考<a href="https://bootstrap-table.com/docs/api/events/#ondblclickcell">传送门</a>，点击表格时将表格变为一个<code>textarea</code>，内容为评论内容，然后在这个<code>textarea</code>失去焦点时调用更新接口来进行更新操作</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">onDblClickCell</span>: <span class="keyword">function</span> (<span class="params">field, value, row, $element</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> comment = $(<span class="string">`#data-table .lw-comment-content`</span>);</span><br><span class="line">  comment.<span class="title function_">parent</span>().<span class="title function_">html</span>(comment.<span class="title function_">val</span>())</span><br><span class="line">  <span class="keyword">if</span> (field === <span class="string">&#x27;content&#x27;</span>) &#123;</span><br><span class="line">    $element.<span class="title function_">html</span>(<span class="string">`&lt;textarea class=&quot;form-control lw-comment-content&quot;&gt;<span class="subst">$&#123;value&#125;</span>&lt;/textarea&gt;`</span>)</span><br><span class="line">    $(<span class="string">&#x27;.lw-comment-content&#x27;</span>).<span class="title function_">blur</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> data = &#123;<span class="attr">id</span>: row.<span class="property">id</span>, <span class="attr">content</span>: $(<span class="variable language_">this</span>).<span class="title function_">val</span>()&#125;</span><br><span class="line">      $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/admin/comment/&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: data,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (res.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">            layer.<span class="title function_">msg</span>(<span class="string">&quot;保存成功&quot;</span>, &#123;<span class="attr">icon</span>: <span class="number">1</span>, <span class="attr">time</span>: <span class="number">500</span>&#125;, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">              $(<span class="string">&#x27;#data-table&#x27;</span>).<span class="title function_">bootstrapTable</span>(<span class="string">&#x27;refresh&#x27;</span>, &#123;<span class="attr">silent</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            layer.<span class="title function_">msg</span>(res.<span class="property">message</span>, &#123;<span class="attr">icon</span>: <span class="number">2</span>&#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><ul><li>完成后端更新接口的开发，更新时直接利用非空拷贝</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Comment comment)</span> &#123;</span><br><span class="line">  <span class="comment">//新评论</span></span><br><span class="line">  <span class="keyword">if</span> (Objects.isNull(comment.getId())) &#123;</span><br><span class="line">    sendMailToWebsite(comment.getArticle().getId());</span><br><span class="line">    comment.setCreated(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    comment.setView(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (comment.getPid() != <span class="number">0</span>) &#123;</span><br><span class="line">      sendMailToComment(comment.getArticle().getId(), comment.getPid(), comment.getContent());</span><br><span class="line">      <span class="type">Comment</span> <span class="variable">parent</span> <span class="operator">=</span> detail(comment.getPid());</span><br><span class="line">      comment.setContent(<span class="string">&quot;@&quot;</span> + parent.getNickname() + <span class="string">&quot;: &quot;</span> + comment.getContent());</span><br><span class="line">      comment.setPid(findParent(comment.getPid()));</span><br><span class="line">    &#125;</span><br><span class="line">    mapper.save(comment);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="type">Comment</span> <span class="variable">one</span> <span class="operator">=</span> detail(comment.getId());</span><br><span class="line">    UpdateUtil.copyNullProperties(comment, one);</span><br><span class="line">    mapper.save(one);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>将表格的修改按钮改为回复按钮，点击后给其一个弹出回复框输入我们的回复内容调用回复接口，这里可以直接用<a href="https://layui.gitee.io/v2/layer/">Layer</a></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#data-table&quot;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;.lw-update-btn&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//   获取目标资源id</span></span><br><span class="line">  <span class="keyword">let</span> id = $(<span class="variable language_">this</span>).<span class="title function_">data</span>(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">  <span class="keyword">let</span> aid = $(<span class="variable language_">this</span>).<span class="title function_">data</span>(<span class="string">&#x27;aid&#x27;</span>)</span><br><span class="line">  layer.<span class="title function_">prompt</span>(&#123;<span class="attr">title</span>: <span class="string">&#x27;回复&#x27;</span>, <span class="attr">formType</span>: <span class="number">2</span>&#125;, <span class="keyword">function</span> (<span class="params">text, index</span>) &#123;</span><br><span class="line">    layer.<span class="title function_">close</span>(index);</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/admin/comment/&#x27;</span> + id,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">aid</span>: aid,</span><br><span class="line">        <span class="attr">message</span>: text</span><br><span class="line">      &#125;, <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">      <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          layer.<span class="title function_">msg</span>(<span class="string">&quot;回复成功&quot;</span>, &#123;<span class="attr">icon</span>: <span class="number">1</span>&#125;)</span><br><span class="line">          $(<span class="string">&#x27;#data-table&#x27;</span>).<span class="title function_">bootstrapTable</span>(<span class="string">&#x27;refresh&#x27;</span>, &#123;<span class="attr">silent</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          layer.<span class="title function_">msg</span>(res.<span class="property">message</span>, &#123;<span class="attr">icon</span>: <span class="number">2</span>&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>完成后端回复接口的开发</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/&#123;pid&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">replay</span><span class="params">(<span class="meta">@PathVariable</span> Integer pid, Integer aid, String message)</span> &#123;</span><br><span class="line">  <span class="type">Comment</span> <span class="variable">comment</span> <span class="operator">=</span> Comment.builder().article(Article.builder().id(aid).build()).email(webSite.getMail()).nickname(webSite.getNickname()).content(message).pid(pid).url(webSite.getUrl()).build();</span><br><span class="line">  service.save(comment);</span><br><span class="line">  <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>将页面改为分页</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Mapper</span></span><br><span class="line">Page&lt;Comment&gt; <span class="title function_">findAllByView</span><span class="params">(Boolean view, Pageable pageable)</span>;</span><br><span class="line"><span class="comment">//Service</span></span><br><span class="line"><span class="keyword">public</span> PageHelper&lt;Comment&gt; <span class="title function_">list</span><span class="params">(Boolean view, <span class="type">int</span> pn, <span class="type">int</span> ps)</span> &#123;</span><br><span class="line">  <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(pn - <span class="number">1</span>, ps, Sort.by(Sort.Direction.DESC, <span class="string">&quot;created&quot;</span>));</span><br><span class="line">  Page&lt;Comment&gt; page = Objects.isNull(view) ? mapper.findAll(pageable) : mapper.findAllByView(view, pageable);</span><br><span class="line">  <span class="keyword">return</span> PageHelper.&lt;Comment&gt;builder()</span><br><span class="line">    .rows(page.getContent())</span><br><span class="line">    .total(page.getTotalElements())</span><br><span class="line">    .build();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Controller</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;PageHelper&lt;Comment&gt;&gt; <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam(required = false)</span> Boolean view, <span class="meta">@RequestParam(required = false, defaultValue = &quot;1&quot;)</span> Integer pn, <span class="meta">@RequestParam(required = false, defaultValue = &quot;1&quot;)</span> Integer ps)</span> &#123;</span><br><span class="line">  pn = Math.max(<span class="number">1</span>, pn);</span><br><span class="line">  ps = Math.max(<span class="number">1</span>, ps);</span><br><span class="line">  <span class="keyword">return</span> Result.success(service.list(view, pn, ps));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#lw-comment-search button&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  $(<span class="string">&#x27;#lw-comment-search .btn-primary&#x27;</span>).<span class="title function_">removeClass</span>(<span class="string">&#x27;btn-primary&#x27;</span>).<span class="title function_">addClass</span>(<span class="string">&#x27;btn-default&#x27;</span>)</span><br><span class="line">  $(<span class="variable language_">this</span>).<span class="title function_">removeClass</span>(<span class="string">&#x27;btn-default&#x27;</span>).<span class="title function_">addClass</span>(<span class="string">&#x27;btn-primary&#x27;</span>)</span><br><span class="line">  $(<span class="string">&#x27;#data-table&#x27;</span>).<span class="title function_">bootstrapTable</span>(<span class="string">&#x27;refresh&#x27;</span>, &#123;<span class="attr">silent</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">$(<span class="string">&#x27;#data-table&#x27;</span>).<span class="title function_">bootstrapTable</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/admin/comment/&#x27;</span>,</span><br><span class="line">  <span class="attr">pagination</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">pageNumber</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">sidePagination</span>: <span class="string">&#x27;server&#x27;</span>,</span><br><span class="line">  <span class="attr">pageSize</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">pageList</span>: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">40</span>],</span><br><span class="line">  <span class="attr">responseHandler</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="property">data</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">queryParams</span>: <span class="keyword">function</span> (<span class="params">params</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">pn</span>: (params.<span class="property">offset</span> / params.<span class="property">limit</span>) + <span class="number">1</span>,</span><br><span class="line">      <span class="attr">ps</span>: params.<span class="property">limit</span>,</span><br><span class="line">      <span class="attr">view</span>: $(<span class="string">&#x27;#lw-comment-search .btn-primary&#x27;</span>).<span class="title function_">data</span>(<span class="string">&#x27;view&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="控制台"><a href="#控制台" class="headerlink" title="控制台"></a>控制台</h2><p>这里没什么好说的，页面上需要什么内容我们查什么内容就可以了，然后在未读评论这里我们给一个参数标识一下我们要查未读评论，然后在评论管理的路由里解析一下这个参数就行了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">  model.addAttribute(<span class="string">&quot;category&quot;</span>, categoryService.count());</span><br><span class="line">  model.addAttribute(<span class="string">&quot;comment&quot;</span>, commentService.count(<span class="literal">null</span>));</span><br><span class="line">  model.addAttribute(<span class="string">&quot;commentFalse&quot;</span>, commentService.count(<span class="literal">false</span>));</span><br><span class="line">  model.addAttribute(<span class="string">&quot;article&quot;</span>, articleService.count());</span><br><span class="line">  model.addAttribute(<span class="string">&quot;newArticleList&quot;</span>, articleService.search(ArticleSearch.builder().type(Article.TYPE_ARTICLE).pageNum(<span class="number">1</span>).pageSize(<span class="number">5</span>).build()).getRows());</span><br><span class="line">  model.addAttribute(<span class="string">&quot;newCommentList&quot;</span>, commentService.list(<span class="literal">null</span>, <span class="number">1</span>, <span class="number">5</span>).getRows());</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;admin/index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;jumbotron&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>网站概要<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>目前有 <span class="tag">&lt;<span class="name">i</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;article&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 篇文章, 并有 <span class="tag">&lt;<span class="name">i</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;comment&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 条关于你的评论在 <span class="tag">&lt;<span class="name">i</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">th:text</span>=<span class="string">&quot;$&#123;category&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 个分类中.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>其中有 <span class="tag">&lt;<span class="name">i</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;commentFalse&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>条 评论未查看:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary btn-lg&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/admin/comment.html(view=false)&#125;&quot;</span> <span class="attr">role</span>=<span class="string">&quot;button&quot;</span>&gt;</span>点此查看<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-6&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;list-group&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;list-group-item disabled&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">b</span>&gt;</span>最新文章<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;list-group-item&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;post:$&#123;newArticleList&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;badge&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#dates.format(post.created,&#x27;MM-dd&#x27;)&#125;&quot;</span>&gt;</span>09-28<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/&#123;id&#125;.html(id=$&#123;post.id&#125;)&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;post.title&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-6&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;list-group&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;list-group-item disabled&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">b</span>&gt;</span>最新评论<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;list-group-item&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;comm:$&#123;newCommentList&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;badge&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#dates.format(comm.created,&#x27;MM-dd&#x27;)&#125;&quot;</span>&gt;</span>09-29<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;comm.content&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h2&gt;&lt;p&gt;前台功能我们已经完全完成了，我们现在来看看后台剩下的内容：控制台、评论管理及登录功能，这节课完了的博客项目就完了，下节课给大家说说我们的项目</summary>
      
    
    
    
    <category term="个人博客项目" scheme="https://study.kevinlu98.cn/categories/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="java" scheme="https://study.kevinlu98.cn/tags/java/"/>
    
    <category term="springboot" scheme="https://study.kevinlu98.cn/tags/springboot/"/>
    
    <category term="个人博客" scheme="https://study.kevinlu98.cn/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="异常处理" scheme="https://study.kevinlu98.cn/tags/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>(二十一)统一异常拦截及自定义错误跳转</title>
    <link href="https://study.kevinlu98.cn/2022/10/09/tong-yi-yi-chang-lan-jie-ji-zi-ding-yi-cuo-wu-tiao-zhuan.html"/>
    <id>https://study.kevinlu98.cn/2022/10/09/tong-yi-yi-chang-lan-jie-ji-zi-ding-yi-cuo-wu-tiao-zhuan.html</id>
    <published>2022-10-08T17:22:00.000Z</published>
    <updated>2023-01-17T11:51:09.220Z</updated>
    
    <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>我们博客前台的功能现在已经算是做完了，我们这个时候来把异常这里说下，我们之前在写后端时捕获过一次异常，但我们直接返回了一个<code>json</code>，这样明显是不合理的，因我们我们的路由有些是页面，有些是<code>json</code>，我们只需要在接口返回值是<code>json</code>的时候才返回<code>json</code>，其它情况我们希望返回页面</p><h2 id="定义异常页面"><a href="#定义异常页面" class="headerlink" title="定义异常页面"></a>定义异常页面</h2><p>我们在定义异常页面时可以先将<code>error.html</code>重命名为<code>fail.html</code>，因为<code>Thymeleaf</code>在解析模板出错时会自动跳转到<code>error.html</code></p><ul><li>我们定义一个枚举为<code>ErrorCode</code>，来存放我们的<code>HTTP</code>状态码和对应的信息</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kevinlu98.enums;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author: Mr丶冷文</span></span><br><span class="line"><span class="comment"> * Date: 2022/10/15 19:40</span></span><br><span class="line"><span class="comment"> * Email: kevinlu98@qq.com</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ErrorCodeEnum</span> &#123;</span><br><span class="line">  ERROR_404(<span class="number">404</span>,<span class="string">&quot;对不起，你请求的页面暂时未找到.&lt;br&gt;它或许已经被迁移至其它页面啦.&quot;</span>),</span><br><span class="line">  ERROR_500(<span class="number">500</span>,<span class="string">&quot;您好，服务器暂时出发问题，请稍候访问.&lt;br&gt;或您也可以尝试联系站长.&quot;</span>),</span><br><span class="line">  ;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> code;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String msg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>然后定义<code>404</code>和<code>500</code>的路由</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/error/404&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">error404</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">  model.addAttribute(<span class="string">&quot;error&quot;</span>, ErrorCodeEnum.ERROR_404);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;fail&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/error/500&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">error500</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">  model.addAttribute(<span class="string">&quot;error&quot;</span>, ErrorCodeEnum.ERROR_500);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;fail&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="错误页面配置"><a href="#错误页面配置" class="headerlink" title="错误页面配置"></a>错误页面配置</h2><p><strong>重要：</strong>大家先要明白一件事件，就是我们的错误页面配置是根据HTTP请求返回的状态码决定的，这个与统一异常处理不一样</p><ul><li>我们在<code>config</code>里面给<code>Spring</code>容器一个类型为<code>WebServerFactoryCustomizer</code>泛型为<code>ConfigurableWebServerFactory</code>的<code>bean</code></li><li>在这个<code>bean</code>里我们去调用<code>addErrorPages</code>的方法指定HTTP状态对应的路由</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> WebServerFactoryCustomizer&lt;ConfigurableWebServerFactory&gt; <span class="title function_">webServerFactoryCustomizer</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> factory -&gt; factory.addErrorPages(<span class="keyword">new</span> <span class="title class_">ErrorPage</span>(HttpStatus.NOT_FOUND, <span class="string">&quot;/error/404&quot;</span>), <span class="keyword">new</span> <span class="title class_">ErrorPage</span>(HttpStatus.INTERNAL_SERVER_ERROR, <span class="string">&quot;/error/500&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="统一异常改造"><a href="#统一异常改造" class="headerlink" title="统一异常改造"></a>统一异常改造</h2><p>我们之前已经做过了统一异常处理，但这个处理是非常不科学的，它不论什么样的情况都会返回一个<code>json</code>，这让用户在访问我们的网站时的交互就显得不是那么友好，因为用户访问的只会是前台页面</p><p>我们可以在发生异常时判断一个请求的后缀，因为当时我们在开发项目定义路由时我们所有页面的返回都是以<code>.html</code>结尾的，那我们就可以认为只要是以<code>.html</code>结尾的请求都是页面，这个时候我们就可以返回到错误页面，反之我们返回一个<code>json</code></p><p>这个时候我们又有问题了，我们返回页面和返回<code>json</code>的返回值不同，我们应该怎么处理呢？那我们可以直接让返回值为<code>void</code>，不让<code>springboot</code>帮我们返回，我们自己利用<code>Servlet</code>的接口进行返回就可以了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">defaultException</span><span class="params">(Exception e, HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">  log.error(e.getMessage(), e);</span><br><span class="line">  <span class="keyword">if</span> (request.getRequestURI().endsWith(<span class="string">&quot;.html&quot;</span>)) &#123;</span><br><span class="line">    request.getRequestDispatcher(<span class="string">&quot;/error/500.html&quot;</span>).forward(request, response);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    response.getWriter().print(<span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writeValueAsString(Result.error()));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="自定义异常"><a href="#自定义异常" class="headerlink" title="自定义异常"></a>自定义异常</h2><p>我们可以看到当我们访问一个不存在的文章时由于错误码是500，此时会被我们配置的错误页面拦截，但按照逻辑来讲这个时候应该是一个文章不存在，在业务上属于404，我们可以自定义一个异常，然后在统一异常里面捕获这个异常，给其重定向到404页面</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(LWNotFindException.class)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">notFindException</span><span class="params">(LWNotFindException e)</span> &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">  log.error(e.getMessage(), e);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;forward:/error/404.html&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h2&gt;&lt;p&gt;我们博客前台的功能现在已经算是做完了，我们这个时候来把异常这里说下，我们之前在写后端时捕获过一次异常，但我们直接返回了一个&lt;code&gt;jso</summary>
      
    
    
    
    <category term="个人博客项目" scheme="https://study.kevinlu98.cn/categories/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="java" scheme="https://study.kevinlu98.cn/tags/java/"/>
    
    <category term="springboot" scheme="https://study.kevinlu98.cn/tags/springboot/"/>
    
    <category term="个人博客" scheme="https://study.kevinlu98.cn/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="异常处理" scheme="https://study.kevinlu98.cn/tags/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>(二十)评论回复功能及邮件提醒</title>
    <link href="https://study.kevinlu98.cn/2022/10/09/ping-lun-hui-fu-gong-neng-ji-you-jian-ti-xing.html"/>
    <id>https://study.kevinlu98.cn/2022/10/09/ping-lun-hui-fu-gong-neng-ji-you-jian-ti-xing.html</id>
    <published>2022-10-08T17:21:00.000Z</published>
    <updated>2023-01-17T11:51:09.220Z</updated>
    
    <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>上节课我们完成了最基本的评论功能及展示，这节课我们来说下评论回复功能、收到评论后的给站长及被评论者的邮件通知功能</p><h2 id="回复功能"><a href="#回复功能" class="headerlink" title="回复功能"></a>回复功能</h2><ul><li>给每个评论加上<code>data-id</code>的属性存储评论的<code>id</code></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lw-posr&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;comment:$&#123;commentPage.rows&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-avatar lw-posa&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;@defaultImage.avatar(comment.email)&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">b</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;comment.nickname&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#dates.format(comment.created,&#x27;yyyy-MM-dd HH:mm&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:data-id</span>=<span class="string">&quot;$&#123;comment.id&#125;&quot;</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">class</span>=<span class="string">&quot;lw-comment-replay&quot;</span>&gt;</span>回复<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-cancel&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span>取消回复<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-info&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;comment.content&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lw-posr&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-avatar lw-posa&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://q1.qlogo.cn/g?b=qq&amp;nk=1518228633&amp;s=100&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>VOODOO<span class="tag">&lt;/<span class="name">b</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span>&gt;</span>2022-09-28 19:53<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>回复<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-info&quot;</span>&gt;</span></span><br><span class="line">          @xpboy</span><br><span class="line">          <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">          谢谢<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>当我们点击回复按钮时将评论框移到目标评论的下方，然后清空评论框的内容并将评论框的<code>pid</code>改为目标评论的<code>id</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#lw-comment-list&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;.lw-comment-replay&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  $(<span class="string">&#x27;#lw-comment-list .lw-comment-cancel&#x27;</span>).<span class="title function_">hide</span>()</span><br><span class="line">  $(<span class="string">&#x27;#lw-comment-list .lw-comment-replay&#x27;</span>).<span class="title function_">show</span>()</span><br><span class="line">  <span class="keyword">let</span> id = $(<span class="variable language_">this</span>).<span class="title function_">data</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">  <span class="keyword">let</span> source = $(<span class="string">&#x27;#lw-comment-box&#x27;</span>)</span><br><span class="line">  <span class="comment">// 复制一个评论框</span></span><br><span class="line">  <span class="keyword">let</span> cloneBox = source.<span class="title function_">clone</span>();</span><br><span class="line">  <span class="comment">//删除源评论框</span></span><br><span class="line">  source.<span class="title function_">remove</span>()</span><br><span class="line">  <span class="comment">//将复制的评论框加到目标评论的下方</span></span><br><span class="line">  $(<span class="variable language_">this</span>).<span class="title function_">parent</span>().<span class="title function_">parent</span>().<span class="title function_">append</span>(source)</span><br><span class="line">  <span class="comment">//更改pid</span></span><br><span class="line">  $(<span class="string">&#x27;#lw-comment-form input[name=pid]&#x27;</span>).<span class="title function_">val</span>(id)</span><br><span class="line">  $(<span class="variable language_">this</span>).<span class="title function_">hide</span>()</span><br><span class="line">  $(<span class="variable language_">this</span>).<span class="title function_">parent</span>().<span class="title function_">find</span>(<span class="string">&#x27;.lw-comment-cancel&#x27;</span>).<span class="title function_">show</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>评论完成后将评论框移加原来的位置并将评论框的<code>pid</code>变为<code>0</code>且评论内容清空</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">commBoxReset</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">let</span> source = $(<span class="string">&#x27;#lw-comment-box&#x27;</span>)</span><br><span class="line">  <span class="keyword">let</span> cloneBox = source.<span class="title function_">clone</span>();</span><br><span class="line">  source.<span class="title function_">remove</span>()</span><br><span class="line">  $(<span class="string">&#x27;#lw-article-box&#x27;</span>).<span class="title function_">after</span>(source)</span><br><span class="line">  $(<span class="string">&#x27;#lw-comment-form input[name=pid]&#x27;</span>).<span class="title function_">val</span>(<span class="number">0</span>)</span><br><span class="line">  $(<span class="string">&#x27;#lw-comment-form textarea&#x27;</span>).<span class="title function_">val</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  $(<span class="string">&#x27;#lw-comment-list .lw-comment-cancel&#x27;</span>).<span class="title function_">hide</span>()</span><br><span class="line">  $(<span class="string">&#x27;#lw-comment-list .lw-comment-replay&#x27;</span>).<span class="title function_">show</span>()</span><br><span class="line">&#125;</span><br><span class="line">$(<span class="string">&#x27;#lw-comment-list&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;.lw-comment-cancel&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"><span class="title function_">commBoxReset</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>后端处理评论层级关系</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Mapper</span></span><br><span class="line">Page&lt;Comment&gt; <span class="title function_">findAllByArticleAndPidOrderByCreatedDesc</span><span class="params">(Article article, Integer pid, Pageable pageable)</span>;</span><br><span class="line"></span><br><span class="line">List&lt;Comment&gt; <span class="title function_">findAllByPidOrderByCreatedDesc</span><span class="params">(Integer pid)</span>;</span><br><span class="line"><span class="comment">//Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Comment comment)</span> &#123;</span><br><span class="line">  <span class="comment">//新评论</span></span><br><span class="line">  <span class="keyword">if</span> (Objects.isNull(comment.getId())) &#123;</span><br><span class="line">    comment.setCreated(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    comment.setView(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (comment.getPid() != <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="type">Comment</span> <span class="variable">parent</span> <span class="operator">=</span> detail(comment.getPid());</span><br><span class="line">      comment.setContent(<span class="string">&quot;@&quot;</span>+parent.getNickname()+<span class="string">&quot;: &quot;</span>+comment.getContent());</span><br><span class="line">      comment.setPid(findParent(comment.getPid()));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  mapper.save(comment);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> Integer <span class="title function_">findParent</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">  <span class="type">Comment</span> <span class="variable">comment</span> <span class="operator">=</span> detail(id);</span><br><span class="line">  <span class="keyword">if</span> (comment.getPid() == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> comment.getId();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> findParent(comment.getPid());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>修改分页查询评论<code>Service</code>层的代码为其加上子评论列表</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PageHelper.&lt;Comment&gt;builder()</span><br><span class="line">  .rows(page.getContent().stream().peek(x -&gt; x.setChildren(mapper.findAllByPidOrderByCreatedDesc(x.getId()))).collect(Collectors.toList()))</span><br><span class="line">  .current(pageNum)</span><br><span class="line">  .total(page.getTotalElements())</span><br><span class="line">  .totalPage(page.getTotalPages())</span><br><span class="line">  .build();</span><br></pre></td></tr></table></figure><ul><li>页面子评论处理</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lw-posr&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;comment:$&#123;commentPage.rows&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-avatar lw-posa&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;@defaultImage.avatar(comment.email)&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-content&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">b</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;comment.nickname&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#dates.format(comment.created,&#x27;yyyy-MM-dd HH:mm&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:data-id</span>=<span class="string">&quot;$&#123;comment.id&#125;&quot;</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">class</span>=<span class="string">&quot;lw-comment-replay&quot;</span>&gt;</span>回复<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-cancel&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span>取消回复<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-info&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;comment.content&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;comment.children.size() &gt; 0&#125;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lw-posr&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;child:$&#123;comment.children&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-avatar lw-posa&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;@defaultImage.avatar(child.email)&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-content&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">b</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;child.nickname&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#dates.format(child.created,&#x27;yyyy-MM-dd HH:mm&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:data-id</span>=<span class="string">&quot;$&#123;child.id&#125;&quot;</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">class</span>=<span class="string">&quot;lw-comment-replay&quot;</span>&gt;</span>回复<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-cancel&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span>取消回复<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-info&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;child.content&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="邮件提醒"><a href="#邮件提醒" class="headerlink" title="邮件提醒"></a>邮件提醒</h2><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>我这里以QQ邮箱为例，其它邮箱同理</p><ul><li>我们先准备一个QQ邮箱且<strong>开通时长大于15天</strong></li><li>开启<code>POP3/IMAP/SMTP/</code>服务并生成授权码</li></ul><p><strong>常见SMTP服务器地址</strong></p><table><thead><tr><th>邮箱类型</th><th>SMTP服务器地址</th><th>端口号</th></tr></thead><tbody><tr><td>QQ邮箱</td><td>smtp.qq.com</td><td>465或587</td></tr><tr><td>sina邮箱</td><td>smtp.sina.cn</td><td>465或587</td></tr><tr><td>126邮箱</td><td>smtp.126.com</td><td>465或994</td></tr><tr><td>aliyun邮箱</td><td>smtp.aliyun.com</td><td>465或994</td></tr><tr><td>163邮箱</td><td>smtp.163.com</td><td>465或994</td></tr><tr><td>yeah邮箱</td><td>smtp.yeah.net</td><td>465或994</td></tr></tbody></table><h3 id="SpringBootMail邮件测试"><a href="#SpringBootMail邮件测试" class="headerlink" title="SpringBootMail邮件测试"></a>SpringBootMail邮件测试</h3><ul><li>导入依赖</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- springboot 邮件mail --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>配置发件人</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mail:</span></span><br><span class="line">    <span class="comment">#  默认的邮件编码为UTF-8</span></span><br><span class="line">    <span class="attr">default-encoding:</span> <span class="string">UTF-8</span></span><br><span class="line">    <span class="comment"># 邮箱服务器</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">smtp.qq.com</span></span><br><span class="line">    <span class="comment"># 邮箱</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">xxx@qq.com</span></span><br><span class="line">    <span class="comment"># 密码</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">xxxxx</span></span><br><span class="line">    <span class="comment"># 端口</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">587</span></span><br><span class="line">    <span class="comment"># 其它属性，这里只开启debug输出错误信息</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">debug:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><ul><li>创建一个邮件工具类</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kevinlu98.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.JavaMailSender;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.MimeMessageHelper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.mail.MessagingException;</span><br><span class="line"><span class="keyword">import</span> javax.mail.internet.MimeMessage;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author: Mr丶冷文</span></span><br><span class="line"><span class="comment"> * Date: 2022/10/14 19:44</span></span><br><span class="line"><span class="comment"> * Email: kevinlu98@qq.com</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailHelper</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Value(&quot;$&#123;spring.mail.username&#125;&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String from;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> JavaMailSender javaMailSender;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">MailHelper</span><span class="params">(JavaMailSender javaMailSender)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.javaMailSender = javaMailSender;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送邮件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> send    收件人</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> subject 主题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text    内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMail</span><span class="params">(String send, String subject, String text)</span> &#123;</span><br><span class="line">    <span class="type">MimeMessage</span> <span class="variable">message</span> <span class="operator">=</span> javaMailSender.createMimeMessage();</span><br><span class="line">    <span class="type">MimeMessageHelper</span> <span class="variable">helper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(message);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      helper.setSentDate(<span class="keyword">new</span> <span class="title class_">Date</span>()); <span class="comment">//设置发件时间</span></span><br><span class="line">      helper.setFrom(from); <span class="comment">//发件人</span></span><br><span class="line">      helper.setTo(send); <span class="comment">//设置收件人</span></span><br><span class="line">      helper.setSubject(subject); <span class="comment">//设置标签</span></span><br><span class="line">      helper.setText(text, <span class="literal">true</span>); <span class="comment">//设置内容</span></span><br><span class="line">      javaMailSender.send(message); <span class="comment">//发邮件</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (MessagingException e) &#123;</span><br><span class="line">      log.error(e.getMessage(), e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>测试是否发送成功</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kevinlu98.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.kevinlu98.Application;</span><br><span class="line"><span class="keyword">import</span> cn.kevinlu98.common.MailHelper;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author: Mr丶冷文</span></span><br><span class="line"><span class="comment"> * Date: 2022/10/14 19:49</span></span><br><span class="line"><span class="comment"> * Email: kevinlu98@qq.com</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = &#123;Application.class&#125;, webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailTest</span> &#123;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> MailHelper helper;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSend</span><span class="params">()</span>&#123;</span><br><span class="line">    helper.sendMail(<span class="string">&quot;xxx@qq.com&quot;</span>,<span class="string">&quot;测试邮件&quot;</span>,<span class="string">&quot;&lt;h1&gt;冷文学习者&lt;/h1&gt;&lt;p&gt;我是一个测试邮件&lt;/p&gt;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="评论邮件提醒"><a href="#评论邮件提醒" class="headerlink" title="评论邮件提醒"></a>评论邮件提醒</h3><ul><li>在保存新评论时先给站长收一封邮件通知</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Async</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMailToWebsite</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">  <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> articleMapper.findById(id).orElse(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">if</span> (Objects.isNull(article)) <span class="keyword">return</span>;</span><br><span class="line">  <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="string">&quot;&lt;p&gt;\n&quot;</span> + <span class="string">&quot;    你的文章 &lt;a href=\&quot;&quot;</span> + webSite.getUrl() + <span class="string">&quot;/&quot;</span> + id + <span class="string">&quot;.html\&quot;&gt;&quot;</span> + article.getTitle() + <span class="string">&quot;&lt;/a&gt;收到了新评论，点些查看\n&quot;</span> + <span class="string">&quot;&lt;/p&gt;\n&quot;</span> + <span class="string">&quot;&lt;p style=\&quot;text-align:right ;\&quot;&gt;\n&quot;</span> + <span class="string">&quot;时间：\n&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>() + <span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line">  helper.sendMail(webSite.getMail(), webSite.getTitle() + <span class="string">&quot;收到新评论&quot;</span>, content);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>如果父评论不为空，则给被回复者也发一封邮件</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Async</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMailToComment</span><span class="params">(Integer id, Integer cid, String replay)</span> &#123;</span><br><span class="line">  <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> articleMapper.findById(id).orElse(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">if</span> (Objects.isNull(article)) <span class="keyword">return</span>;</span><br><span class="line">  <span class="type">Comment</span> <span class="variable">comment</span> <span class="operator">=</span> mapper.findById(cid).orElse(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">if</span> (Objects.isNull(comment)) <span class="keyword">return</span>;</span><br><span class="line">  <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="string">&quot;&lt;p&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;    你在&lt;a href=\&quot;&quot;</span> + webSite.getUrl() + <span class="string">&quot;\&quot;&gt;&quot;</span> + webSite.getTitle() +</span><br><span class="line">    <span class="string">&quot;&lt;/a&gt;对 &lt;a href=\&quot;&quot;</span> + webSite.getUrl() + <span class="string">&quot;/&quot;</span> + article.getId() + <span class="string">&quot;.html\&quot;&gt;&quot;</span> + article.getTitle() +</span><br><span class="line">    <span class="string">&quot;&lt;/a&gt;文章的评论收到了新回复，回复内容如下：\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;&lt;/p&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;&lt;p&gt;\n&quot;</span> +</span><br><span class="line">    replay +</span><br><span class="line">    <span class="string">&quot;&lt;/p&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;&lt;p style=\&quot;text-align:right ;\&quot;&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;   一一发件人：&quot;</span> + webSite.getTitle() +</span><br><span class="line">    <span class="string">&quot;&lt;/p&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;&lt;p style=\&quot;text-align:right ;\&quot;&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;时间：&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>() +</span><br><span class="line">    <span class="string">&quot;&lt;/p&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;&lt;p style=\&quot;text-align:right ;\&quot;&gt;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;    此邮件是由&quot;</span> + webSite.getTitle() + <span class="string">&quot;自动发送，请勿回复 \n&quot;</span> +</span><br><span class="line">    <span class="string">&quot; &lt;/p&gt;&quot;</span>;</span><br><span class="line">  helper.sendMail(comment.getEmail(), webSite.getTitle() + <span class="string">&quot;收到新回复&quot;</span>, content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Service save</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Comment comment)</span> &#123;</span><br><span class="line">  <span class="comment">//新评论</span></span><br><span class="line">  <span class="keyword">if</span> (Objects.isNull(comment.getId())) &#123;</span><br><span class="line">    sendMailToWebsite(comment.getArticle().getId());</span><br><span class="line">    comment.setCreated(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    comment.setView(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (comment.getPid() != <span class="number">0</span>) &#123;</span><br><span class="line">      sendMailToComment(comment.getArticle().getId(), comment.getPid(), comment.getContent());</span><br><span class="line">      <span class="type">Comment</span> <span class="variable">parent</span> <span class="operator">=</span> detail(comment.getPid());</span><br><span class="line">      comment.setContent(<span class="string">&quot;@&quot;</span> + parent.getNickname() + <span class="string">&quot;: &quot;</span> + comment.getContent());</span><br><span class="line">      comment.setPid(findParent(comment.getPid()));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  mapper.save(comment);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h2&gt;&lt;p&gt;上节课我们完成了最基本的评论功能及展示，这节课我们来说下评论回复功能、收到评论后的给站长及被评论者的邮件通知功能&lt;/p&gt;
&lt;h2 id=&quot;回</summary>
      
    
    
    
    <category term="个人博客项目" scheme="https://study.kevinlu98.cn/categories/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="java" scheme="https://study.kevinlu98.cn/tags/java/"/>
    
    <category term="springboot" scheme="https://study.kevinlu98.cn/tags/springboot/"/>
    
    <category term="个人博客" scheme="https://study.kevinlu98.cn/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="博客系统" scheme="https://study.kevinlu98.cn/tags/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>(十九)评论功能及评论局部刷展示</title>
    <link href="https://study.kevinlu98.cn/2022/10/09/ping-lun-gong-neng-ji-ping-lun-ju-bu-shua-zhan-shi.html"/>
    <id>https://study.kevinlu98.cn/2022/10/09/ping-lun-gong-neng-ji-ping-lun-ju-bu-shua-zhan-shi.html</id>
    <published>2022-10-08T16:21:00.000Z</published>
    <updated>2023-01-17T11:51:09.219Z</updated>
    
    <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>经过前面的学习，我们博客的功能是越来越完善了，这节课我们来说下评论功能的实现</p><p>我们希望我们的评论完成之后页面不进行刷，只刷新评论部分，然后评论的翻页也是如此</p><h2 id="普通评论实现"><a href="#普通评论实现" class="headerlink" title="普通评论实现"></a>普通评论实现</h2><ul><li>定义评论接口<ul><li>路由：<code>/comment</code></li><li>方式：<code>POST</code></li><li>参数：<code>Comment</code>对象</li><li>返回：公共返回对象</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Service    </span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/comment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Comment comment)</span> &#123;</span><br><span class="line">  <span class="comment">//新评论</span></span><br><span class="line">  <span class="keyword">if</span> (Objects.isNull(comment.getId())) &#123;</span><br><span class="line">    comment.setCreated(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    comment.setView(<span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  mapper.save(comment);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Controller</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/comment&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">comment</span><span class="params">(Comment comment)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (StringUtils.equals(comment.getEmail(), webSite.getMail())) &#123;</span><br><span class="line">    <span class="keyword">return</span> Result.error(ResultEnum.RESULT_MAIL_FAIL);</span><br><span class="line">  &#125;</span><br><span class="line">  commentService.save(comment);</span><br><span class="line">  <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>完善评论表单的<code>name</code>属性</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;lw-comment-form&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;article.id&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;article.id&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pid&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-12 lw-p0&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding-right: 10px;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">required</span> <span class="attr">name</span>=<span class="string">&quot;content&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入你的评论...&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-4 col-xs-12 lw-comment-input lw-posr&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;nickname&quot;</span> <span class="attr">required</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入昵称...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-user  lw-comment-input  lw-posa&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-4 col-xs-12   lw-comment-input lw-posr&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">required</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入电子邮件...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-envelope lw-posa&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-4 col-xs-12  lw-comment-input  lw-posr&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">type</span>=<span class="string">&quot;url&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入主页地址...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-link fa-link lw-posa&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-12 col-xs-12  lw-comment-input  lw-posr&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-align: right&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-submit&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>提交按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>拦截表单提交改为<code>Ajax</code>提交表单</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#lw-comment-form&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;submit&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> data = $(<span class="variable language_">this</span>).<span class="title function_">serialize</span>();</span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/comment&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: data,</span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (res.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">        layer.<span class="title function_">msg</span>(<span class="string">&#x27;评论成功&#x27;</span>, &#123;<span class="attr">icon</span>: <span class="number">1</span>&#125;)</span><br><span class="line">        <span class="comment">// todo 局部刷新评论列表</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        layer.<span class="title function_">msg</span>(res.<span class="property">message</span>, &#123;<span class="attr">icon</span>: <span class="number">2</span>&#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="局部刷新展示"><a href="#局部刷新展示" class="headerlink" title="局部刷新展示"></a>局部刷新展示</h2><p>我们其实可以写个获取评论列表的接口返回一个<code>JSON</code>数据，然后前端把这个<code>JSON</code>拼接到一段<code>HTML</code>代码再展示出来，这过这样太麻烦了，我们可以直接利用<code>Thymeleaf</code>返回一个<code>fragment</code>，然后得用<code>Jquery</code>的<code>load</code>方法将其加载到对应容器中</p><ul><li>在获取文章详情时也获取文章下的第一页评论</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Mapper</span></span><br><span class="line">Page&lt;Comment&gt; <span class="title function_">findAllByArticleOrderByCreatedDesc</span><span class="params">(Article article, Pageable pageable)</span>;</span><br><span class="line"><span class="comment">//Service</span></span><br><span class="line"><span class="keyword">public</span> PageHelper&lt;Comment&gt; <span class="title function_">list</span><span class="params">(Integer id, <span class="type">int</span> pageNum)</span> &#123;</span><br><span class="line">  Page&lt;Comment&gt; page = mapper.findAllByArticleOrderByCreatedDesc(Article.builder().id(id).build(), PageRequest.of(pageNum - <span class="number">1</span>, <span class="number">5</span>));</span><br><span class="line">  <span class="keyword">return</span> PageHelper.&lt;Comment&gt;builder()</span><br><span class="line">    .rows(page.getContent())</span><br><span class="line">    .current(pageNum)</span><br><span class="line">    .total(page.getTotalElements())</span><br><span class="line">    .totalPage(page.getTotalPages())</span><br><span class="line">    .build();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Controller</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;.html&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">detail</span><span class="params">(<span class="meta">@PathVariable</span> Integer id, Model model, HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">  <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> articleService.detail(id);</span><br><span class="line">  <span class="keyword">if</span> (Objects.isNull(CookieUtil.getCookie(request, Article.VIEW_PREFIX + id))) &#123;</span><br><span class="line">    articleService.viewArticle(id);</span><br><span class="line">    CookieUtil.setCookie(response, Article.VIEW_PREFIX + id, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//todo 当文章不存在时的处理</span></span><br><span class="line">  model.addAttribute(<span class="string">&quot;article&quot;</span>, article);</span><br><span class="line">  PageHelper&lt;Comment&gt; commentPage = commentService.list(id, <span class="number">1</span>);</span><br><span class="line">  model.addAttribute(<span class="string">&quot;commentPage&quot;</span>, commentPage);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;detail&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>如果评论是QQ邮箱，我们直接取QQ头像(<a href="https://q1.qlogo.cn/g?b=qq&nk=1628048198&s=100">https://q1.qlogo.cn/g?b=qq&nk=1628048198&s=100</a>)做为评论者的头像，反之随机头像</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">avatar</span><span class="params">(String mail)</span> &#123;</span><br><span class="line">  <span class="type">Pattern</span> <span class="variable">pattern</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;(\\d&#123;5,10&#125;)@qq.com&quot;</span>);</span><br><span class="line">  <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> pattern.matcher(mail);</span><br><span class="line">  <span class="keyword">if</span> (matcher.find()) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">qq</span> <span class="operator">=</span> matcher.group(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> String.format(<span class="string">&quot;https://q1.qlogo.cn/g?b=qq&amp;nk=%s&amp;s=100&quot;</span>, qq);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> avatars.get((<span class="type">int</span>) (Math.random() * avatars.size()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>将页面的评论列表改为<code>fragment</code>并做渲染</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;lw-comment-list&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:fragment</span>=<span class="string">&quot;comments&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-list&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">th:each</span>=<span class="string">&quot;comment:$&#123;commentPage.rows&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lw-posr&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-avatar lw-posa&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;@defaultImage.avatar(comment.email)&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-content&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;comment.nickname&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">                                                           <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#dates.format(comment.created,&#x27;yyyy-MM-dd HH:mm&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag">                                                                                                                                     <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>回复<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-info&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;comment.content&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lw-posr&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-avatar lw-posa&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://q1.qlogo.cn/g?b=qq&amp;nk=1518228633&amp;s=100&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-content&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>VOODOO<span class="tag">&lt;/<span class="name">b</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span>&gt;</span>2022-09-28 19:53<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>回复<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-info&quot;</span>&gt;</span></span><br><span class="line">                  @xpboy</span><br><span class="line">                  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                  谢谢<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;commentPage.totalPage&gt;1&#125;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;lw-page-list&quot;</span> <span class="attr">class</span>=<span class="string">&quot;lw-pagenation&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;commentPage.current != 1&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> <span class="attr">data-page</span>=<span class="string">&quot;1&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;num:$&#123;#numbers.sequence((commentPage.current &lt; 3?1: commentPage.current -2) ,(commentPage.current &lt; commentPage.totalPage -2?commentPage.current+2: commentPage.totalPage))&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;commentPage.current eq num&#125;?&#x27;lw-active&#x27;:&#x27;&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">th:data-page</span>=<span class="string">&quot;$&#123;num&#125;&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">th:text</span>=<span class="string">&quot;$&#123;num&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;commentPage.current != commentPage.totalPage&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> <span class="attr">th:data-page</span>=<span class="string">&quot;$&#123;commentPage.totalPage&#125;&quot;</span>&gt;</span>尾页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;&#x27;共 &#x27;+ commentPage.totalPage +&#x27; 页&#x27;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>在分页及评论成功时调用<code>load</code>方法请求评论区域的数据并加载到容器</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/comment/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">comments</span><span class="params">(<span class="meta">@PathVariable</span> Integer id, <span class="meta">@RequestParam(required = false, defaultValue = &quot;1&quot;)</span> Integer pn, Model model)</span> &#123;</span><br><span class="line">  pn = Math.max(<span class="number">1</span>, pn);</span><br><span class="line">  PageHelper&lt;Comment&gt; commentPage = commentService.list(id, pn);</span><br><span class="line">  model.addAttribute(<span class="string">&quot;commentPage&quot;</span>, commentPage);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;detail::comments&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//评论成功</span></span><br><span class="line">$(<span class="string">&#x27;#lw-comment-list&#x27;</span>).<span class="title function_">load</span>(<span class="string">&#x27;/comment/&#x27;</span> + articleId)</span><br><span class="line"><span class="comment">//分页</span></span><br><span class="line">$(<span class="string">&#x27;#lw-comment-list&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;#lw-page-list a&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> page = $(<span class="variable language_">this</span>).<span class="title function_">data</span>(<span class="string">&#x27;page&#x27;</span>)</span><br><span class="line">  $(<span class="string">&#x27;#lw-comment-list&#x27;</span>).<span class="title function_">load</span>(<span class="string">`/comment/<span class="subst">$&#123;articleId&#125;</span>?pn=<span class="subst">$&#123;page&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h2&gt;&lt;p&gt;经过前面的学习，我们博客的功能是越来越完善了，这节课我们来说下评论功能的实现&lt;/p&gt;
&lt;p&gt;我们希望我们的评论完成之后页面不进行刷，只刷新评</summary>
      
    
    
    
    <category term="个人博客项目" scheme="https://study.kevinlu98.cn/categories/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="java" scheme="https://study.kevinlu98.cn/tags/java/"/>
    
    <category term="springboot" scheme="https://study.kevinlu98.cn/tags/springboot/"/>
    
    <category term="个人博客" scheme="https://study.kevinlu98.cn/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="博客系统" scheme="https://study.kevinlu98.cn/tags/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>(十八)目录处理与文章浏览量的处理</title>
    <link href="https://study.kevinlu98.cn/2022/10/09/mu-lu-chu-li-yu-wen-zhang-liu-lan-liang-de-chu-li.html"/>
    <id>https://study.kevinlu98.cn/2022/10/09/mu-lu-chu-li-yu-wen-zhang-liu-lan-liang-de-chu-li.html</id>
    <published>2022-10-08T16:00:00.000Z</published>
    <updated>2023-01-17T11:51:09.218Z</updated>
    
    <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>上节课我们把文章的详情信息已经渲染出来了，而且还为文章生成了目录，这节课我们将这个目录浮动起来，然后为我们的站点加上返回顶部的按钮，再把文章浏览功能做一下</p><h2 id="返回顶部"><a href="#返回顶部" class="headerlink" title="返回顶部"></a>返回顶部</h2><p>这里可以直接参考我之前写的文章：<a href="https://www.kevinlu98.cn/archives/52.html">jQuery实现一个优雅的返回顶部</a></p><ul><li>用一个<code>div</code>做父容器并让其的<code>position</code>为<code>fixed</code>这样就可以固定位置了</li><li>将返回顶部的按钮及QQ联系的按钮放入容器并将到顶部的按钮隐藏</li><li>判断滚动条高度大于屏幕高度一半时展示到顶部的按钮</li><li>给顶部按钮一个滚动到滚动条到顶部的功能</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--common.html--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-id">#lw-right-bottom-bar</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: fixed;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">bottom</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">right</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-id">#lw-right-bottom-bar</span> <span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-top</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, .<span class="number">5</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">line-height</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-id">#lw-right-bottom-bar</span> <span class="selector-id">#lw-to-top</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;lw-right-bottom-bar&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;lw-to-top&quot;</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa  fa-arrow-up&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;$&#123;T(java.lang.String).format(&#x27;tencent://message/?uin=%s<span class="symbol">&amp;amp;</span>Site=<span class="symbol">&amp;amp;</span>menu=yes&#x27;,@webSite.qq)&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span></span></span><br><span class="line"><span class="tag">                                                                                                                                <span class="attr">class</span>=<span class="string">&quot;fa  fa-qq&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  $(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    $(<span class="variable language_">window</span>).<span class="title function_">scroll</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> toTop = $(<span class="variable language_">window</span>).<span class="title function_">scrollTop</span>()</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> height = $(<span class="variable language_">window</span>).<span class="title function_">height</span>()</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (toTop &gt; height / <span class="number">2</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;#lw-to-top&#x27;</span>).<span class="title function_">stop</span>().<span class="title function_">animate</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">opacity</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,<span class="number">500</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;#lw-to-top&#x27;</span>).<span class="title function_">stop</span>().<span class="title function_">animate</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">opacity</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,<span class="number">500</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="string">&#x27;#lw-to-top&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      $(<span class="string">&#x27;body,html&#x27;</span>).<span class="title function_">stop</span>().<span class="title function_">animate</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">scrollTop</span>:<span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="文章目录处理"><a href="#文章目录处理" class="headerlink" title="文章目录处理"></a>文章目录处理</h2><h3 id="目录浮动"><a href="#目录浮动" class="headerlink" title="目录浮动"></a>目录浮动</h3><p>和上面思路差不多，只不过这里就稍微有一点逻辑了，我们此时判断的条件是滚动条滚动的高度大于标签云的底部时进行浮动</p><ul><li>先定义一个浮动的样式确定样式</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#lw-toc-parent</span><span class="selector-class">.lw-toc-fixed</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">999</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>判断滚动条高度是否满足条件，如果满足直接给容器加上我们定义的浮动的样式</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="variable language_">window</span>).<span class="title function_">scroll</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> toTop = $(<span class="variable language_">window</span>).<span class="title function_">scrollTop</span>()</span><br><span class="line">  <span class="keyword">let</span> tagCloud = $(<span class="string">&#x27;.lw-right-item.lw-tag-cloud&#x27;</span>);</span><br><span class="line">  <span class="keyword">let</span> tagBottom = tagCloud.<span class="title function_">offset</span>().<span class="property">top</span> + tagCloud.<span class="title function_">height</span>()</span><br><span class="line">  <span class="keyword">if</span> (toTop &gt; tagBottom - <span class="number">10</span>) &#123;</span><br><span class="line">    $(<span class="string">&#x27;#lw-toc-parent&#x27;</span>).<span class="title function_">addClass</span>(<span class="string">&#x27;lw-toc-fixed&#x27;</span>)</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $(<span class="string">&#x27;#lw-toc-parent&#x27;</span>).<span class="title function_">removeClass</span>(<span class="string">&#x27;lw-toc-fixed&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="滚动优化"><a href="#滚动优化" class="headerlink" title="滚动优化"></a>滚动优化</h3><p>我们点一下目录直接跳到对应位置难免有些生硬，所以我们可以为其加上过渡动画</p><ul><li>取消目录<code>a</code>标签的<code>href</code>，将对应目录的<code>id</code>保存到<code>data-id</code>的属性中</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#lw-article-toc&#x27;</span>).<span class="title function_">append</span>(<span class="string">`&lt;li&gt;&lt;a style=&quot;padding-left: <span class="subst">$&#123;left&#125;</span>px;&quot; href=&quot;javascript:void(0)&quot; data-id=&quot;<span class="subst">$&#123;$(element).attr(<span class="string">&#x27;id&#x27;</span>)&#125;</span>&quot;&gt;<span class="subst">$&#123;$(element).text()&#125;</span>&lt;/a&gt;&lt;/li&gt;`</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>注册<code>a</code>标签的点击事件，当点击时滚动到目录距顶部的高度</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#lw-article-toc&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;li a&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> id = $(<span class="variable language_">this</span>).<span class="title function_">data</span>(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">  $(<span class="string">&#x27;body,html&#x27;</span>).<span class="title function_">stop</span>().<span class="title function_">animate</span>(&#123;</span><br><span class="line">    <span class="attr">scrollTop</span>:$(<span class="string">`#<span class="subst">$&#123;id&#125;</span>`</span>).<span class="title function_">offset</span>().<span class="property">top</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="基于Cookie的文章浏览量统计"><a href="#基于Cookie的文章浏览量统计" class="headerlink" title="基于Cookie的文章浏览量统计"></a>基于Cookie的文章浏览量统计</h2><p>文章的浏览量无非就是当用户查看文章详情时我们给浏览量加1，但此时我们需要处理一下，即一个用户在一段时间内浏览多次文章我们都应该认为是1次，我们确定一个用户的标准可以是一个浏览器这一个用户，借助浏览器的Cookie来保存浏览记录</p><ul><li>我们先写更新浏览量的<code>Mapper</code>层代码</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Modifying</span></span><br><span class="line"><span class="meta">@Query(value = &quot;update blog_article set views=views+1 where  id=13&quot;,nativeQuery = true)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">viewsArticle</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><ul><li>在<code>Service</code>调用Mapper层代码</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">viewArticle</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">  mapper.viewsArticle(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>在文章详情页去调用一下更新浏览量</li><li>我们先看看效果，发现会有我们上面说的问题，一个用户重复的去访问一篇文章，它会不停的刷新浏览量</li><li>我们这个时候来将文章的浏览记录放到<code>Cookie</code>中，当<code>Cookie</code>中有这篇文章的浏览记录时我们就不更新</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;.html&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">detail</span><span class="params">(<span class="meta">@PathVariable</span> Integer id, Model model, HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">  <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> articleService.detail(id);</span><br><span class="line">  <span class="keyword">if</span> (Objects.isNull(CookieUtil.getCookie(request, Article.VIEW_PREFIX + id))) &#123;</span><br><span class="line">    articleService.viewArticle(id);</span><br><span class="line">    CookieUtil.setCookie(response, Article.VIEW_PREFIX + id, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//todo 当文章不存在时的处理</span></span><br><span class="line">  model.addAttribute(<span class="string">&quot;article&quot;</span>, article);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;detail&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Cookie工具类"><a href="#Cookie工具类" class="headerlink" title="Cookie工具类"></a>Cookie工具类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kevinlu98.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CookieUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getCookie</span><span class="params">(HttpServletRequest request, String cookieName)</span> &#123;</span><br><span class="line"></span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line">        <span class="keyword">if</span> (cookies != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">                <span class="keyword">if</span> (cookie.getName().equals(cookieName)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> cookie.getValue();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setCookie</span><span class="params">(HttpServletResponse response, String cookieName, String value, <span class="type">int</span> cookieMaxAge)</span> &#123;</span><br><span class="line">        <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(cookieName, value);</span><br><span class="line">        cookie.setPath(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        cookie.setMaxAge(cookieMaxAge);</span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setCookie</span><span class="params">(HttpServletResponse response, String cookieName, String value)</span> &#123;</span><br><span class="line">        setCookie(response, cookieName, value, <span class="number">7</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">deleteCookie</span><span class="params">(HttpServletResponse response, String cookieName)</span> &#123;</span><br><span class="line">        setCookie(response, cookieName, <span class="literal">null</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="独立页面的处理"><a href="#独立页面的处理" class="headerlink" title="独立页面的处理"></a>独立页面的处理</h2><p>独立页面我们就不显示浏览量、分类、标签还有文章目录的信息了</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">th:if=&quot;$&#123;article.type eq T(cn.kevinlu98.pojo.Article).TYPE_ARTICLE&#125;&quot; </span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h2&gt;&lt;p&gt;上节课我们把文章的详情信息已经渲染出来了，而且还为文章生成了目录，这节课我们将这个目录浮动起来，然后为我们的站点加上返回顶部的按钮，再把文章</summary>
      
    
    
    
    <category term="个人博客项目" scheme="https://study.kevinlu98.cn/categories/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="java" scheme="https://study.kevinlu98.cn/tags/java/"/>
    
    <category term="springboot" scheme="https://study.kevinlu98.cn/tags/springboot/"/>
    
    <category term="个人博客" scheme="https://study.kevinlu98.cn/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="博客系统" scheme="https://study.kevinlu98.cn/tags/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>(十七)文章详情页的展示</title>
    <link href="https://study.kevinlu98.cn/2022/10/08/wen-zhang-xiang-qing-ye-de-zhan-shi.html"/>
    <id>https://study.kevinlu98.cn/2022/10/08/wen-zhang-xiang-qing-ye-de-zhan-shi.html</id>
    <published>2022-10-07T17:21:00.000Z</published>
    <updated>2023-01-17T11:51:09.217Z</updated>
    
    <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>我们列表展示区域的内容基本已经做完了，我们的站点前台就只差文章页面的部分功能，我们这节课先把文章的渲染展示做一下 </p><h2 id="第三方"><a href="#第三方" class="headerlink" title="第三方"></a>第三方</h2><ul><li>排版：本来页面的排版是想用<a href="https://typo.sofi.sh/">Typo.css</a>来排版的，后来觉得那个排版与我们博客的主体不搭，就自己写了版的css，文章排版其实就是把那些<code>markdown</code>渲染的<code>html</code>代码出现的标签加个样式就行了</li><li>代码高亮：这里用的是<a href="https://prismjs.com/">prism</a>，其实还有很多，只是这个用起来比较简单，导入一下就行了，不需要手动渲染</li><li>markdown解析：我们用的是<a href="https://github.com/commonmark/commonmark-java">commonmark-java</a>这个包，而其它java的<code>markdown</code>解析也基本都用的是它，但它只能支持一些比较简单的<code>markdown</code>语法，稍微复杂一点就不能支持了，但官我给我们很多扩展选项，对我们来说它的基本功能再加上表格的支持就够了</li></ul><h2 id="详情页的展示"><a href="#详情页的展示" class="headerlink" title="详情页的展示"></a>详情页的展示</h2><ul><li>导入依赖</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.commonmark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commonmark-ext-gfm-tables<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.18.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.commonmark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commonmark-ext-gfm-tables<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.18.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>我们创建一个<code>MarkdownUtil</code>的工具类用于解析<code>markdown</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kevinlu98.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.commonmark.Extension;</span><br><span class="line"><span class="keyword">import</span> org.commonmark.ext.gfm.tables.TablesExtension;</span><br><span class="line"><span class="keyword">import</span> org.commonmark.node.Heading;</span><br><span class="line"><span class="keyword">import</span> org.commonmark.node.Link;</span><br><span class="line"><span class="keyword">import</span> org.commonmark.node.Node;</span><br><span class="line"><span class="keyword">import</span> org.commonmark.parser.Parser;</span><br><span class="line"><span class="keyword">import</span> org.commonmark.renderer.html.AttributeProvider;</span><br><span class="line"><span class="keyword">import</span> org.commonmark.renderer.html.AttributeProviderContext;</span><br><span class="line"><span class="keyword">import</span> org.commonmark.renderer.html.AttributeProviderFactory;</span><br><span class="line"><span class="keyword">import</span> org.commonmark.renderer.html.HtmlRenderer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author: Mr丶冷文</span></span><br><span class="line"><span class="comment"> * Date: 2022/10/13 14:08</span></span><br><span class="line"><span class="comment"> * Email: kevinlu98@qq.com</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MarkdownUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;Extension&gt; EXTENSIONS = Collections.singletonList(TablesExtension.create());</span><br><span class="line">    <span class="type">Parser</span> <span class="variable">parser</span> <span class="operator">=</span> Parser.builder()</span><br><span class="line">            .extensions(EXTENSIONS)</span><br><span class="line">            .build();</span><br><span class="line">    <span class="type">HtmlRenderer</span> <span class="variable">renderer</span> <span class="operator">=</span> HtmlRenderer.builder()</span><br><span class="line">            .extensions(EXTENSIONS)</span><br><span class="line">            .attributeProviderFactory(attributeProviderContext -&gt; (node, tagName, attributes) -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (node <span class="keyword">instanceof</span> Link) &#123;</span><br><span class="line">                    attributes.put(<span class="string">&quot;target&quot;</span>, <span class="string">&quot;_blank&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (node <span class="keyword">instanceof</span> Heading) &#123;</span><br><span class="line">                    attributes.put(<span class="string">&quot;id&quot;</span>, UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line">                    attributes.put(<span class="string">&quot;class&quot;</span>, <span class="string">&quot;lw-title-toc&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将markdown代码解析成html</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> markdown markdown源码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> html代码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> String <span class="title function_">parse</span><span class="params">(String markdown)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">document</span> <span class="operator">=</span> parser.parse(markdown);</span><br><span class="line">        <span class="keyword">return</span> renderer.render(document);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>在<code>Article</code>中定义一个<code>showHtml()</code>的方法用于将<code>content</code>转化为<code>html代码</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">showHtml</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> MarkdownUtil.parse(<span class="built_in">this</span>.content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>定义路由并查询文章详情</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;.html&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">detail</span><span class="params">(<span class="meta">@PathVariable</span> Integer id, Model model)</span> &#123;</span><br><span class="line">  <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> articleService.detail(id);</span><br><span class="line">  <span class="comment">//todo 当文章不存在时的处理</span></span><br><span class="line">  model.addAttribute(<span class="string">&quot;article&quot;</span>, article);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;detail&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>页面展示并引入<code>prism</code></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span> <span class="attr">th:replace</span>=<span class="string">&quot;common::header(~&#123;::title&#125;,~&#123;::link&#125;,~&#123;&#125;)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123; article.title +&#x27; - &#x27;+@webSite.title&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/css/detail.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/plugin/prism/prism.css&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:include</span>=<span class="string">&quot;common::nav&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-container lw-main lw-posr&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-left-list&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-article-list&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">&quot;breadcrumb lw-crumb&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/category/&#123;id&#125;.html(id=$&#123;article.category.id&#125;)&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;article.category.name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span>正文<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-article&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-article-title&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;article.title&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-clock-o lw-mr5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#dates.format(article.created,&#x27;yyyy-MM-dd HH:mm&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-eye lw-mr5 lw-ml10&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;article.views&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-comment lw-ml10 lw-mr5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;article.commentCount&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-folder  lw-ml10 lw-mr5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/category/&#123;id&#125;.html(id=$&#123;article.category.id&#125;)&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;article.category.name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-tags  lw-ml10 lw-mr5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:each</span>=<span class="string">&quot;tag:$&#123;article.tags&#125;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/tag/&#123;id&#125;.html(id=$&#123;tag.id&#125;)&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;tag.name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-article-content&quot;</span> <span class="attr">id</span>=<span class="string">&quot;lw-article-content&quot;</span> <span class="attr">th:utext</span>=<span class="string">&quot;$&#123;article.showHtml()&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;lw-article-right&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">svg</span> <span class="attr">t</span>=<span class="string">&quot;1664366825703&quot;</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 1024 1024&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">p-id</span>=<span class="string">&quot;919&quot;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">height</span>=<span class="string">&quot;200&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">&quot;M512 512m-448 0a448 448 0 1 0 896 0 448 448 0 1 0-896 0Z&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#FB3A83&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">p-id</span>=<span class="string">&quot;920&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">&quot;M676.5 701c-9 0-16.6-6.3-18.1-15-1.1-6-2.5-11.6-4.2-16.7l-0.1-0.2-0.1-0.2c-9.1-31.5-29.1-59-56.6-78-26.2 13.2-55.6 20.1-85.3 20.1-29.8 0-59.2-7-85.5-20.2-27.6 19-47.7 46.5-56.8 78.1-0.2 0.7-2.1 7.9-4.8 18.5-2 8.1-9.3 13.7-17.8 13.7h-10.7c-4.8 0-9.4-2-12.5-5.6-3.1-3.5-4.6-8.2-4-12.8 8.1-60.2 46.2-113.1 101.7-141.5l5.4-2.8 5.1 3.4c23.5 15.9 51.1 24.3 79.8 24.3 28.7 0 56.2-8.4 79.7-24.2l5.1-3.4 5.4 2.8c55.4 28.4 93.4 81.3 101.5 141.4 0.6 4.6-0.8 9.3-4 12.8s-7.7 5.6-12.5 5.6h-10.7zM512.2 526.3c-74.5 0-135-60-135-133.6S437.7 259 512.2 259s135 60 135 133.6c0 73.7-60.5 133.7-135 133.7z m0-222.4c-49.6 0-89.9 39.8-89.9 88.8s40.3 88.8 89.9 88.8c49.6 0 89.9-39.8 89.9-88.8s-40.3-88.8-89.9-88.8z&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">fill</span>=<span class="string">&quot;#FFFFFF&quot;</span> <span class="attr">p-id</span>=<span class="string">&quot;921&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>版权所属: <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://kevinlu98.cn/&quot;</span>&gt;</span>冷文学习者<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">svg</span> <span class="attr">t</span>=<span class="string">&quot;1664366893739&quot;</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 1024 1024&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">p-id</span>=<span class="string">&quot;1067&quot;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">height</span>=<span class="string">&quot;200&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">&quot;M512 512m-448 0a448 448 0 1 0 896 0 448 448 0 1 0-896 0Z&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#FA5151&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">p-id</span>=<span class="string">&quot;1068&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">&quot;M610.2 324c22.6 20.5 33.8 49 33.8 85.2 0 26.6-7.5 50.2-22.4 70.7-5.6 6.9-22.2 22.4-49.6 46.5-12.5 10.5-21.8 21.4-27.8 32.6-7.7 12.9-11.5 27.8-11.5 44.7v13.9h-49v-13.9c0-20.1 3.8-37.7 11.5-52.6 7.3-17.3 27.6-40.7 61-70.1 8.1-8.1 14.9-15.3 20.5-21.8 11.7-15.3 17.5-31.2 17.5-47.7 0-24.2-6.6-42.9-19.9-56.2-14.1-14.1-34.1-21.2-59.8-21.2-29.8 0-52.2 9.9-67.1 29.6-12.9 17.3-19.3 40.5-19.3 69.5h-48.4c0-41.9 11.9-75.7 35.7-101.5 25-26.6 58.8-39.9 101.5-39.9 39.7 0.2 70.7 10.9 93.3 32.2z m-75.5 346.4c6.8 6.9 10.3 15.3 10.3 25.4 0 10.5-3.4 19.1-10.3 26-7.7 6.9-16.3 10.3-26 10.3-10.5 0-19.1-3.4-26-10.3-7.3-7.3-10.9-15.9-10.9-26 0-10.5 3.6-18.9 10.9-25.4 6.4-6.8 15.1-10.3 26-10.3 10.4 0 19.1 3.4 26 10.3z&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">fill</span>=<span class="string">&quot;#FFFFFF&quot;</span> <span class="attr">p-id</span>=<span class="string">&quot;1069&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>本文链接: <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://kevinlu98.cn/archives/101.html&quot;</span>&gt;</span>https://kevinlu98.cn/archives/101.html<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">svg</span> <span class="attr">t</span>=<span class="string">&quot;1664366925081&quot;</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 1024 1024&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">p-id</span>=<span class="string">&quot;1215&quot;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">height</span>=<span class="string">&quot;200&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">&quot;M800.3 205.1L534.8 116c-16-5.4-33.3-5.3-49.2 0.2l-264.5 92.3c-29.3 10-49 37.5-49.1 68.4l1.7 265.4c0.7 81 31.1 158.9 85.6 218.9 25 27.7 56.9 51.5 97.8 72.7l144 74.6c9 4.7 19.7 4.6 28.7-0.2L672.5 832c40.4-21.6 72.2-45.7 96.9-73.8 53.6-60.6 83-138.9 82.6-219.8l-1.7-265.6c-0.5-30.9-20.5-58.1-50-67.7z&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">fill</span>=<span class="string">&quot;#FFC300&quot;</span> <span class="attr">p-id</span>=<span class="string">&quot;1216&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">&quot;M512 597c-13.9 0-25.2-11.3-25.2-25.2V345.2c0-13.9 11.3-25.2 25.2-25.2 13.9 0 25.2 11.3 25.2 25.2v226.6c0 13.9-11.3 25.2-25.2 25.2z&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">fill</span>=<span class="string">&quot;#FFFFFF&quot;</span> <span class="attr">p-id</span>=<span class="string">&quot;1217&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">&quot;M512 674.1m-29.9 0a29.9 29.9 0 1 0 59.8 0 29.9 29.9 0 1 0-59.8 0Z&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;#FFFFFF&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">p-id</span>=<span class="string">&quot;1218&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>协议授权: <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh&quot;</span>&gt;</span>《署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0)》<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-box row lw-m0&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>评论(6)<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-12 lw-p0&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding-right: 10px;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入你的评论...&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-4 col-xs-12 lw-comment-input lw-posr&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入昵称...&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-user  lw-comment-input  lw-posa&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-4 col-xs-12   lw-comment-input lw-posr&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入电子邮件...&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-envelope lw-posa&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-4 col-xs-12  lw-comment-input  lw-posr&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;url&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入主页地址...&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-link fa-link lw-posa&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-list&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lw-posr&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-avatar lw-posa&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://kevinlu98.cn/freecdn-1.4/image/avatar/22.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-content&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>xpboy<span class="tag">&lt;/<span class="name">b</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span>&gt;</span>2022-06-03 18:32<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>回复<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-info&quot;</span>&gt;</span></span><br><span class="line">              已经解决，问题是后台的的永久链接--重写功能，一定要开启成功，我是开启没有成功，但是可以使用，部分功能受限，如点赞、登录、注册等。我是windows</span><br><span class="line">              iis，添加web.config放到网站根目录就可以了，希望踩坑的朋友注意了。具体的web.config伪静态规则代码，可以联系我免费提供哦</span><br><span class="line">              qq24985536，希望帮助到大家<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lw-posr&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-avatar lw-posa&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://q1.qlogo.cn/g?b=qq&amp;nk=1518228633&amp;s=100&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-content&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>VOODOO<span class="tag">&lt;/<span class="name">b</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span>&gt;</span>2022-09-28 19:53<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>回复<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-info&quot;</span>&gt;</span></span><br><span class="line">                  @xpboy</span><br><span class="line">                  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                  谢谢<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lw-posr&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-avatar lw-posa&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://q1.qlogo.cn/g?b=qq&amp;nk=68159424&amp;s=100&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-content&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>anle<span class="tag">&lt;/<span class="name">b</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span>&gt;</span>2022-06-03 18:32<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>回复<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-info&quot;</span>&gt;</span></span><br><span class="line">              您好～我是俺没偷前端的运营，关注了您在分享的技术文章，觉得您的这套模板很棒，我们诚挚邀请您加入俺没偷前端CP主计划。完整福利和详细介绍请见：https://anlenotes.com/cp</span><br><span class="line">              我们会给作者提供包括流量、创作分成等， 我们诚挚的邀请您并期待您的加入~<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lw-posr&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-avatar lw-posa&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://q1.qlogo.cn/g?b=qq&amp;nk=602314742&amp;s=100&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-content&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>王伟忘记使自己快乐<span class="tag">&lt;/<span class="name">b</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span>&gt;</span>2022-06-03 18:32<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>回复<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-info&quot;</span>&gt;</span></span><br><span class="line">              你好，请问一下，搭建的网页，在本地访问一点问题都没有，通过互联网域名访问，打开很慢，而且显示不正常，电脑手机都是一样的，是什么问题呢<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lw-posr&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-avatar lw-posa&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://q1.qlogo.cn/g?b=qq&amp;nk=545431&amp;s=100&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-content&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>小布丁<span class="tag">&lt;/<span class="name">b</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span>&gt;</span>2022-06-03 18:32<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>回复<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-comment-info&quot;</span>&gt;</span></span><br><span class="line">              为什么启用这个主题 后，评论用不了了，报错。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;lw-pagenation&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>4<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>尾页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-right-list lw-md-show lw-posa&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:include</span>=<span class="string">&quot;common::right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:include</span>=<span class="string">&quot;common::footer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/plugin/prism/prism.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>文章目录处理<ul><li>给<code>h</code>标签加上id</li><li>取到所有的<code>h</code>标签</li><li>生成<code>a</code>标签，<code>href</code>是<code>#hid</code></li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> offset = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>, <span class="number">60</span>]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> hTag = $(<span class="string">&#x27;#lw-article-content .lw-title-toc&#x27;</span>)</span><br><span class="line">  <span class="keyword">let</span> hMax = <span class="number">6</span>;</span><br><span class="line">  hTag.<span class="title function_">each</span>(<span class="function">(<span class="params">i, ele</span>) =&gt;</span> &#123;</span><br><span class="line">    hMax = <span class="title class_">Math</span>.<span class="title function_">min</span>(ele.<span class="property">tagName</span>.<span class="title function_">charAt</span>(<span class="number">1</span>), hMax)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; offset.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    offset[i] -= (hMax - <span class="number">1</span>) * <span class="number">10</span></span><br><span class="line">  &#125;</span><br><span class="line">  hTag.<span class="title function_">each</span>(<span class="function">(<span class="params">index, element</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> level = element.<span class="property">tagName</span>.<span class="title function_">charAt</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">let</span> left = offset[level - <span class="number">1</span>]</span><br><span class="line">    $(<span class="string">&#x27;#lw-article-toc&#x27;</span>).<span class="title function_">append</span>(<span class="string">`&lt;li&gt;&lt;a style=&quot;padding-left: <span class="subst">$&#123;left&#125;</span>px;&quot; href=&quot;#<span class="subst">$&#123;$(element).attr(<span class="string">&#x27;id&#x27;</span>)&#125;</span>&quot;&gt;<span class="subst">$&#123;$(element).text()&#125;</span>&lt;/a&gt;&lt;/li&gt;`</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h2&gt;&lt;p&gt;我们列表展示区域的内容基本已经做完了，我们的站点前台就只差文章页面的部分功能，我们这节课先把文章的渲染展示做一下 &lt;/p&gt;
&lt;h2 id=&quot;</summary>
      
    
    
    
    <category term="个人博客项目" scheme="https://study.kevinlu98.cn/categories/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="java" scheme="https://study.kevinlu98.cn/tags/java/"/>
    
    <category term="springboot" scheme="https://study.kevinlu98.cn/tags/springboot/"/>
    
    <category term="个人博客" scheme="https://study.kevinlu98.cn/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="博客系统" scheme="https://study.kevinlu98.cn/tags/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>(十六)入口页的展示</title>
    <link href="https://study.kevinlu98.cn/2022/10/07/ru-kou-ye-de-zhan-shi.html"/>
    <id>https://study.kevinlu98.cn/2022/10/07/ru-kou-ye-de-zhan-shi.html</id>
    <published>2022-10-06T21:21:00.000Z</published>
    <updated>2023-01-17T11:51:09.216Z</updated>
    
    <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>我们上节课处理了列表页，但我们还没有真正的入口页面到列表页面的跳转，比如分类列表、标签列表及搜索的入口，这节课我们就重点处理一下这里</p><h2 id="处理描述信息中的非中英文字符"><a href="#处理描述信息中的非中英文字符" class="headerlink" title="处理描述信息中的非中英文字符"></a>处理描述信息中的非中英文字符</h2><p>我们可以看到我们的列表页描述信息其实展示我是我们<code>markdown</code>的源代码，里面有大量的符号，而这些符号与我们的主要内容基本无关，所以我们可以把这些符号删除之后再展示摘要部分的内容</p><p>匹配中文的正则：<code>\u4E00-\u9FA5</code></p><p>匹配英文的正则：<code>a-zA-Z</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">summary</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">String</span> <span class="variable">summary</span> <span class="operator">=</span> <span class="built_in">this</span>.content.replaceAll(<span class="string">&quot;[^\\u4E00-\\u9FA5a-zA-Z]&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> summary.substring(<span class="number">0</span>, Math.min(<span class="number">300</span>, summary.length()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="分类列表"><a href="#分类列表" class="headerlink" title="分类列表"></a>分类列表</h2><ul><li>模板：<code>categroy.html</code></li><li>路由：<code>/category.html</code></li><li>观察页面可以看到我们的分类列表需要如下信息<ul><li>分类名称（已有）</li><li>分类描述（已有）</li><li>分类下的文章数：可以查下count</li><li>分类下文章的最后一次更新时间：可以查询文章列表后用updated进行排序</li></ul></li><li>代码实现</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//articleMapper</span></span><br><span class="line">Long <span class="title function_">countByCategory</span><span class="params">(Category category)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Query(value = &quot;select updated from blog_article where category_id=?1 order by updated desc limit 1&quot;, nativeQuery = true)</span></span><br><span class="line">Date <span class="title function_">lastUpdated</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// categoryService</span></span><br><span class="line"><span class="meta">@Cacheable</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Category&gt; <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> mapper.findAll().stream().peek(category -&gt; &#123;</span><br><span class="line">    category.setArticleCount(articleMapper.countByCategory(category));</span><br><span class="line">    category.setLastUpdated(articleMapper.lastUpdated(category.getId()));</span><br><span class="line">  &#125;).collect(Collectors.toList());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//IndexController</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/category.html&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">category</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">  model.addAttribute(<span class="string">&quot;categories&quot;</span>,categoryService.show());</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;category&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span> <span class="attr">th:replace</span>=<span class="string">&quot;common::header(~&#123;::title&#125;,~&#123;&#125;,~&#123;&#125;)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;&#x27;分类大全 - &#x27;+@webSite.title&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:include</span>=<span class="string">&quot;common::nav&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-container lw-main lw-posr&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-left-list&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">&quot;breadcrumb lw-crumb&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span>分类大全<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;lw-category-list&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;category:$&#123;categories&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/category/&#123;id&#125;.html(id=$&#123;category.id&#125;)&#125;&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-folder lw-mr5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;category.name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>(Total <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;category.articleCount&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span> Articles)<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;category.summary&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-category-update&quot;</span>&gt;</span>最后更新: <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;category.articleCount eq 0&#125;?&#x27;1970-01-01&#x27;:$&#123;#dates.format(category.lastUpdated,&#x27;yyyy-MM-dd&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-right-list lw-md-show lw-posa&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:include</span>=<span class="string">&quot;common::right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:include</span>=<span class="string">&quot;common::footer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="标签列表"><a href="#标签列表" class="headerlink" title="标签列表"></a>标签列表</h2><ul><li>模板：<code>tags.html</code></li><li>路由：<code>/tag.html</code></li><li>观察页面可以看到我们的分类列表需要如下信息<ul><li>标签名称（已有）</li><li>标签下的文章数：可以查下count</li></ul></li><li>代码实现</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//tagMapper</span></span><br><span class="line"><span class="meta">@Query(value = &quot;select count(1) from blog_article_tags where tags_id = ?1&quot;, nativeQuery = true)</span></span><br><span class="line">Long <span class="title function_">articleCountByTid</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//tagService</span></span><br><span class="line"><span class="meta">@Cacheable</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Tag&gt; <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> mapper.findAll().stream().peek(tag -&gt; tag.setArticleCount(mapper.articleCountByTid(tag.getId()))).filter(tag -&gt; tag.getArticleCount()&gt;<span class="number">0</span>).collect(Collectors.toList());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//IndexController</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/tag.html&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">tag</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">  model.addAttribute(<span class="string">&quot;tagList&quot;</span>, tagService.show());</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;tags&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span> <span class="attr">th:replace</span>=<span class="string">&quot;common::header(~&#123;::title&#125;,~&#123;&#125;,~&#123;&#125;)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;&#x27;分类大全 - &#x27;+@webSite.title&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:include</span>=<span class="string">&quot;common::nav&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-container lw-main lw-posr&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-left-list&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">&quot;breadcrumb lw-crumb&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/static&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span>标签云<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-tag-list&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:each</span>=<span class="string">&quot;tag:$&#123;tagList&#125;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/tag/&#123;id&#125;.html(id=$&#123;tag.id&#125;)&#125;&quot;</span> <span class="attr">th:title</span>=<span class="string">&quot;$&#123;tag.name&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;tag.name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;tag.articleCount&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-right-list lw-md-show lw-posa&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:include</span>=<span class="string">&quot;common::right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:include</span>=<span class="string">&quot;common::footer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="搜索的入口"><a href="#搜索的入口" class="headerlink" title="搜索的入口"></a>搜索的入口</h2><p>我们需要展示推荐关键字，这里我想的是用一个LRU做缓存展示20个最近使用的关键字，如果最近使用的关键字少于20个时我们用标签做补充</p><p>LRU：LRU中<code>Least Recently Used </code>的缩写，这种算法认为最近使用过的数据是一个热门数据，下一次还有很大概率再次被使用，而最近很少被使用的数据，很大概率下次不会再使用了，当容器已经满了的时候把最近很少被使用的数据直接删除，这种算法最初是用于操作系统中的页面置换，现在也大多被使用于缓存过期策略</p><p>我们也认为最近被用户所搜索的关键字就是热门关键字，直接展示为推荐关键字</p><p>我们这里用<code>LinkedHashSet</code>做一个简单的LRU缓存</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kevinlu98.common;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author: Mr丶冷文</span></span><br><span class="line"><span class="comment"> * Date: 2022/10/12 18:06</span></span><br><span class="line"><span class="comment"> * Email: kevinlu98@qq.com</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LRUCache</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; cache = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> limit;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> limit)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.limit = limit;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> cache.size();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(cache);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(String keyword)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (cache.size() &gt;= limit) &#123;</span><br><span class="line">      cache.remove(cache.stream().findFirst().orElse(<span class="literal">null</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    cache.remove(keyword);</span><br><span class="line">    cache.add(keyword);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Controller的变动 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ModelAttribute</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">indexModel</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">  <span class="comment">// todo 可以在这里定义这个controller公用的model的属性</span></span><br><span class="line">  model.addAttribute(<span class="string">&quot;friendlies&quot;</span>, friendlyService.list());</span><br><span class="line">  model.addAttribute(<span class="string">&quot;tags&quot;</span>, tagService.list(<span class="number">30</span>));</span><br><span class="line">  model.addAttribute(<span class="string">&quot;navigations&quot;</span>, navigationService.show());</span><br><span class="line">  model.addAttribute(<span class="string">&quot;hots&quot;</span>, articleService.hotList(<span class="number">5</span>));</span><br><span class="line">  <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> lruCache.size();</span><br><span class="line">  List&lt;String&gt; keywords = lruCache.list();</span><br><span class="line">  Collections.reverse(keywords);</span><br><span class="line">  <span class="keyword">if</span> (size &lt; <span class="number">10</span>) &#123;</span><br><span class="line">    keywords.addAll(tagService.list(<span class="number">10</span> - size).stream().map(Tag::getName).collect(Collectors.toList()));</span><br><span class="line">  &#125;</span><br><span class="line">  model.addAttribute(<span class="string">&quot;keywords&quot;</span>, keywords);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/search.html&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">search</span><span class="params">(<span class="meta">@RequestParam(required = false, defaultValue = &quot;1&quot;)</span> Integer pn, String keyword, Model model)</span> &#123;</span><br><span class="line">  lruCache.add(keyword);</span><br><span class="line">  <span class="comment">//todo 如果这个分类不存在的时候我们要处理一下</span></span><br><span class="line">  model.addAttribute(<span class="string">&quot;keyword&quot;</span>, keyword);</span><br><span class="line">  <span class="type">ArticleSearch</span> <span class="variable">articleSearch</span> <span class="operator">=</span> ArticleSearch.indexShow(pn, <span class="number">8</span>);</span><br><span class="line">  articleSearch.setKeyword(keyword);</span><br><span class="line">  PageHelper&lt;Article&gt; articlePage = articleService.search(articleSearch);</span><br><span class="line">  model.addAttribute(<span class="string">&quot;articlePage&quot;</span>, articlePage);</span><br><span class="line">  model.addAttribute(<span class="string">&quot;pageType&quot;</span>, <span class="string">&quot;search&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;list&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-search-input lw-posr&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/search.html&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">required</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;keyword&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入搜索关键字...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;lw-posa&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-search lw-mr5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>推荐关键字：</span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;lw-mr5&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;keyword:$&#123;keywords&#125;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/search.html(keyword=$&#123;keyword&#125;)&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;keyword&#125;&quot;</span> <span class="attr">th:title</span>=<span class="string">&quot;$&#123;keyword&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h2&gt;&lt;p&gt;我们上节课处理了列表页，但我们还没有真正的入口页面到列表页面的跳转，比如分类列表、标签列表及搜索的入口，这节课我们就重点处理一下这里&lt;/p&gt;</summary>
      
    
    
    
    <category term="个人博客项目" scheme="https://study.kevinlu98.cn/categories/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="java" scheme="https://study.kevinlu98.cn/tags/java/"/>
    
    <category term="springboot" scheme="https://study.kevinlu98.cn/tags/springboot/"/>
    
    <category term="个人博客" scheme="https://study.kevinlu98.cn/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="博客系统" scheme="https://study.kevinlu98.cn/tags/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>(十五)文章列表页的展示</title>
    <link href="https://study.kevinlu98.cn/2022/10/07/wen-zhang-lie-biao-ye-de-zhan-shi.html"/>
    <id>https://study.kevinlu98.cn/2022/10/07/wen-zhang-lie-biao-ye-de-zhan-shi.html</id>
    <published>2022-10-06T20:21:00.000Z</published>
    <updated>2023-01-17T11:51:09.216Z</updated>
    
    <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>首页我们前面几节课已经全部做完成了，而我们某个标签、分类、关键字下的文章我们都是会放到列表页统一展示，这节课我们就把列表页也处理一下，我们列表页的模板用<code>list.html</code>就可以了</p><h2 id="分页展示进阶"><a href="#分页展示进阶" class="headerlink" title="分页展示进阶"></a>分页展示进阶</h2><p>数据量大导致分页太多的情况下我们如何处理分页</p><ul><li>可以只显示当前页最近的几页数据</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;articlePage.totalPage&gt;1&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;lw-pagenation&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;articlePage.current != 1&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/&#125;&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;num:$&#123;#numbers.sequence((articlePage.current &lt; 3?1: articlePage.current -2) ,(articlePage.current &lt; articlePage.totalPage -2?articlePage.current+2: articlePage.totalPage))&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;articlePage.current eq num&#125;?&#x27;lw-active&#x27;:&#x27;&#x27;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/(pn=$&#123;num&#125;)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">th:text</span>=<span class="string">&quot;$&#123;num&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;articlePage.current != articlePage.totalPage&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/(pn=$&#123;articlePage.totalPage&#125;)&#125;&quot;</span>&gt;</span>尾页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;&#x27;共 &#x27;+ articlePage.totalPage +&#x27; 页&#x27;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>加上页码框</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">上一页 1 / 9 下一页 跳转[]</span><br></pre></td></tr></table></figure><h2 id="步骤分析"><a href="#步骤分析" class="headerlink" title="步骤分析"></a>步骤分析</h2><ul><li><p>定义路由，我们希望的路由格式如下</p><ul><li>分类路由：<code>/category/&#123;分类ID&#125;.html</code></li><li>标签路由：<code>/tag/&#123;标签ID&#125;.html</code></li><li>搜索路由：<code>/search.html?keywords=&#123;关键定&#125;</code></li></ul></li><li><p>面包屑的构建</p><ul><li>分类面包屑：首页 &#x2F; 分类大全 &#x2F; 分类名称</li><li>标签面包屑：首页 &#x2F; 标签 &#x2F; 标签名称</li><li>搜索面包屑：首页 &#x2F; 包含关键字 XX 的文章</li></ul></li><li><p>标题的构建：XX - 站点名称</p></li><li><p>调用search接口进行查询</p></li><li><p>分页渲染</p></li></ul><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="文章列表的抽取"><a href="#文章列表的抽取" class="headerlink" title="文章列表的抽取"></a>文章列表的抽取</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:fragment</span>=<span class="string">&quot;article(articleList)&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">article</span> <span class="attr">th:each</span>=<span class="string">&quot;article:$&#123;articleList&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;lw-article-item lw-posr&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-article-cover lw-posa lw-xs-hidden&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;@defaultImage.cover(article.cover)&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-article-info&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;lw-xs-hidden&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;lw-category&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;article.category.name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/&#123;id&#125;.html(id=$&#123;article.id&#125;)&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;article.title&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-desc&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;article.summary()&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-text-hidden lw-article-more&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-clock-o lw-mr5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#dates.format(article.created,&#x27;yyyy-MM-dd HH:mm&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-eye lw-mr5 lw-ml10&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;article.views&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-comment lw-ml10 lw-mr5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;article.commentCount&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-tag lw-ml10 lw-mr5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:each</span>=<span class="string">&quot;tag:$&#123;article.tags&#125;&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;lw-mr5&quot;</span> <span class="attr">th:title</span>=<span class="string">&quot;$&#123;tag.name&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;tag.name +&#x27;,&#x27;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="分类列表"><a href="#分类列表" class="headerlink" title="分类列表"></a>分类列表</h3><ul><li>定义对应的路由</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/category/&#123;id&#125;.html&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">categoryList</span><span class="params">(<span class="meta">@PathVariable</span> Integer id, <span class="meta">@RequestParam(required = false, defaultValue = &quot;1&quot;)</span> Integer pn, Model model)</span> &#123;</span><br><span class="line">  <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.detail(id);</span><br><span class="line">  <span class="comment">//todo 如果这个分类不存在的时候我们要处理一下</span></span><br><span class="line">  model.addAttribute(<span class="string">&quot;category&quot;</span>, category);</span><br><span class="line">  <span class="type">ArticleSearch</span> <span class="variable">articleSearch</span> <span class="operator">=</span> ArticleSearch.indexShow(pn, <span class="number">1</span>);</span><br><span class="line">  articleSearch.setCid(id);</span><br><span class="line">  PageHelper&lt;Article&gt; articlePage = articleService.search(articleSearch);</span><br><span class="line">  model.addAttribute(<span class="string">&quot;articlePage&quot;</span>, articlePage);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;list&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>分类已经在search接口中支持过了，所以我们直接调用即可</p></li><li><p>分页渲染</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;articlePage.totalPage&gt;1 and pageType eq &#x27;category&#x27;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;lw-pagenation&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;articlePage.current != 1&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/category/&#123;id&#125;.html(id=$&#123;category.id&#125;)&#125;&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;num:$&#123;#numbers.sequence((articlePage.current &lt; 3?1: articlePage.current -2) ,(articlePage.current &lt; articlePage.totalPage -2?articlePage.current+2: articlePage.totalPage))&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;articlePage.current eq num&#125;?&#x27;lw-active&#x27;:&#x27;&#x27;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/category/&#123;id&#125;.html(id=$&#123;category.id&#125;,pn=$&#123;num&#125;)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">th:text</span>=<span class="string">&quot;$&#123;num&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;articlePage.current != articlePage.totalPage&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/category/&#123;id&#125;.html(id=$&#123;category.id&#125;,pn=$&#123;articlePage.totalPage&#125;)&#125;&quot;</span>&gt;</span>尾页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;&#x27;共 &#x27;+ articlePage.totalPage +&#x27; 页&#x27;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="标签列表"><a href="#标签列表" class="headerlink" title="标签列表"></a>标签列表</h3><ul><li>定义对应的路由</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/tag/&#123;id&#125;.html&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">tagList</span><span class="params">(<span class="meta">@PathVariable</span> Integer id, <span class="meta">@RequestParam(required = false, defaultValue = &quot;1&quot;)</span> Integer pn, Model model)</span> &#123;</span><br><span class="line">  <span class="type">Tag</span> <span class="variable">tag</span> <span class="operator">=</span> tagService.detail(id);</span><br><span class="line">  <span class="comment">//todo 如果这个分类不存在的时候我们要处理一下</span></span><br><span class="line">  model.addAttribute(<span class="string">&quot;tag&quot;</span>, tag);</span><br><span class="line">  <span class="type">ArticleSearch</span> <span class="variable">articleSearch</span> <span class="operator">=</span> ArticleSearch.indexShow(pn, );</span><br><span class="line">  articleSearch.setTid(id);</span><br><span class="line">  PageHelper&lt;Article&gt; articlePage = articleService.search(articleSearch);</span><br><span class="line">  model.addAttribute(<span class="string">&quot;articlePage&quot;</span>, articlePage);</span><br><span class="line">  model.addAttribute(<span class="string">&quot;pageType&quot;</span>, <span class="string">&quot;tag&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;list&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>利用JPA的<code>join</code>操作查询标签列表下的所有</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Objects.nonNull(search.getTid())) &#123;</span><br><span class="line">  ListJoin&lt;Article, Tag&gt; join = root.join(root.getModel().getList(<span class="string">&quot;tags&quot;</span>, Tag.class), JoinType.LEFT);</span><br><span class="line">  predicateList.add(builder.equal(join.get(<span class="string">&quot;id&quot;</span>), search.getTid()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>分页渲染</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;articlePage.totalPage&gt;1 and pageType eq &#x27;tag&#x27;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;lw-pagenation&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;articlePage.current != 1&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/tag/&#123;id&#125;.html(id=$&#123;tag.id&#125;)&#125;&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;num:$&#123;#numbers.sequence((articlePage.current &lt; 3?1: articlePage.current -2) ,(articlePage.current &lt; articlePage.totalPage -2?articlePage.current+2: articlePage.totalPage))&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;articlePage.current eq num&#125;?&#x27;lw-active&#x27;:&#x27;&#x27;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/tag/&#123;id&#125;.html(id=$&#123;tag.id&#125;,pn=$&#123;num&#125;)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">th:text</span>=<span class="string">&quot;$&#123;num&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;articlePage.current != articlePage.totalPage&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/tag/&#123;id&#125;.html(id=$&#123;tag.id&#125;,pn=$&#123;articlePage.totalPage&#125;)&#125;&quot;</span>&gt;</span>尾页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;&#x27;共 &#x27;+ articlePage.totalPage +&#x27; 页&#x27;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="搜索列表"><a href="#搜索列表" class="headerlink" title="搜索列表"></a>搜索列表</h3><ul><li>定义对应的路由</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/search.html&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">tagList</span><span class="params">(<span class="meta">@RequestParam(required = false, defaultValue = &quot;1&quot;)</span> Integer pn, String keyword, Model model)</span> &#123;</span><br><span class="line">  <span class="comment">//todo 如果这个分类不存在的时候我们要处理一下</span></span><br><span class="line">  model.addAttribute(<span class="string">&quot;keyword&quot;</span>, keyword);</span><br><span class="line">  <span class="type">ArticleSearch</span> <span class="variable">articleSearch</span> <span class="operator">=</span> ArticleSearch.indexShow(pn, <span class="number">8</span>);</span><br><span class="line">  articleSearch.setKeyword(keyword);</span><br><span class="line">  PageHelper&lt;Article&gt; articlePage = articleService.search(articleSearch);</span><br><span class="line">  model.addAttribute(<span class="string">&quot;articlePage&quot;</span>, articlePage);</span><br><span class="line">  model.addAttribute(<span class="string">&quot;pageType&quot;</span>, <span class="string">&quot;search&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;list&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>在搜索接口中加入模糊匹配</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Page&lt;Article&gt; articlePage = mapper.findAll((Specification&lt;Article&gt;) (root, query, builder) -&gt; &#123;</span><br><span class="line">  List&lt;Predicate&gt; predicateAnd = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">  <span class="keyword">if</span> (Objects.nonNull(search.getCid())) &#123;</span><br><span class="line">    predicateAnd.add(builder.equal(root.get(<span class="string">&quot;category&quot;</span>), Category.builder().id(search.getCid()).build()));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (Objects.nonNull(search.getStatus())) &#123;</span><br><span class="line">    predicateAnd.add(builder.equal(root.get(<span class="string">&quot;status&quot;</span>), search.getStatus()));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (Objects.nonNull(search.getType())) &#123;</span><br><span class="line">    predicateAnd.add(builder.equal(root.get(<span class="string">&quot;type&quot;</span>), search.getType()));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!StringUtils.isEmptyOrWhitespace(search.getTitle())) &#123;</span><br><span class="line">    predicateAnd.add(builder.like(root.get(<span class="string">&quot;title&quot;</span>), <span class="string">&quot;%&quot;</span> + search.getTitle() + <span class="string">&quot;%&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (Objects.nonNull(search.getTid())) &#123;</span><br><span class="line">    ListJoin&lt;Article, Tag&gt; join = root.join(root.getModel().getList(<span class="string">&quot;tags&quot;</span>, Tag.class), JoinType.LEFT);</span><br><span class="line">    predicateAnd.add(builder.equal(join.get(<span class="string">&quot;id&quot;</span>), search.getTid()));</span><br><span class="line">  &#125;</span><br><span class="line">  List&lt;Predicate&gt; predicateOr = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">  <span class="keyword">if</span> (!StringUtils.isEmptyOrWhitespace(search.getKeyword())) &#123;</span><br><span class="line">    <span class="comment">// todo 如果可以话后面给大家 出一期进阶课，把这里的搜索换顾EleasticSearch</span></span><br><span class="line">    predicateOr.add(builder.like(root.get(<span class="string">&quot;title&quot;</span>), <span class="string">&quot;%&quot;</span> + search.getKeyword() + <span class="string">&quot;%&quot;</span>));</span><br><span class="line">    predicateOr.add(builder.like(root.get(<span class="string">&quot;content&quot;</span>), <span class="string">&quot;%&quot;</span> + search.getKeyword() + <span class="string">&quot;%&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (CollectionUtils.isEmpty(predicateOr)) &#123;</span><br><span class="line">    <span class="keyword">return</span> builder.and(predicateAnd.toArray(<span class="keyword">new</span> <span class="title class_">Predicate</span>[predicateAnd.size()]));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> query.where(builder.and(predicateAnd.toArray(<span class="keyword">new</span> <span class="title class_">Predicate</span>[predicateAnd.size()])), builder.or(predicateOr.toArray(<span class="keyword">new</span> <span class="title class_">Predicate</span>[predicateOr.size()]))).getRestriction();</span><br><span class="line">&#125;, pageable);</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>分页渲染</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;articlePage.totalPage&gt;1 and pageType eq &#x27;search&#x27;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;lw-pagenation&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;articlePage.current != 1&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/search.html(keyword=$&#123;keyword&#125;)&#125;&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;num:$&#123;#numbers.sequence((articlePage.current &lt; 3?1: articlePage.current -2) ,(articlePage.current &lt; articlePage.totalPage -2?articlePage.current+2: articlePage.totalPage))&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;articlePage.current eq num&#125;?&#x27;lw-active&#x27;:&#x27;&#x27;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;search.html(keyword=$&#123;keyword&#125;,pn=$&#123;num&#125;)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">th:text</span>=<span class="string">&quot;$&#123;num&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;articlePage.current != articlePage.totalPage&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;search.html(keyword=$&#123;keyword&#125;,pn=$&#123;articlePage.totalPage&#125;)&#125;&quot;</span>&gt;</span>尾页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;&#x27;共 &#x27;+ articlePage.totalPage +&#x27; 页&#x27;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h2&gt;&lt;p&gt;首页我们前面几节课已经全部做完成了，而我们某个标签、分类、关键字下的文章我们都是会放到列表页统一展示，这节课我们就把列表页也处理一下，我们列</summary>
      
    
    
    
    <category term="个人博客项目" scheme="https://study.kevinlu98.cn/categories/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="java" scheme="https://study.kevinlu98.cn/tags/java/"/>
    
    <category term="springboot" scheme="https://study.kevinlu98.cn/tags/springboot/"/>
    
    <category term="个人博客" scheme="https://study.kevinlu98.cn/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="博客系统" scheme="https://study.kevinlu98.cn/tags/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>(十四)缓存处理及首页文章的列表展示</title>
    <link href="https://study.kevinlu98.cn/2022/10/07/huan-cun-chu-li-ji-shou-ye-wen-zhang-de-lie-biao-zhan-shi.html"/>
    <id>https://study.kevinlu98.cn/2022/10/07/huan-cun-chu-li-ji-shou-ye-wen-zhang-de-lie-biao-zhan-shi.html</id>
    <published>2022-10-06T19:21:00.000Z</published>
    <updated>2023-01-17T11:51:09.215Z</updated>
    
    <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>上节课我们已经将前台页面公共部分替换成了动态的，但这个时候就有问题了，因为我们每次访问其它页面的时候都会去查多次数据库，这样会加大数据库的压力，也会拖慢我们网站的速度，因为我们知道一个程序的性能瓶颈大部分情况下是由IO性能决定的，而内存的性能比磁盘快了不知多少倍，所以我们这节课会为我们的项目加上一个缓存</p><h2 id="缓存处理"><a href="#缓存处理" class="headerlink" title="缓存处理"></a>缓存处理</h2><p>我们项目使用的缓存是<code>ehcache</code>这个缓存中间件，可以看下百度词条对其的描述<a href="https://baike.baidu.com/item/ehcache/6036099?fr=aladdin">https://baike.baidu.com/item/ehcache/6036099?fr=aladdin</a></p><p>我们可以利用<code>springboot-cache</code>帮我们集成<code>ehcache</code>，这样我们只用简单的做几个配置就可以了</p><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ul><li>引入<code>springboot-cache</code>的依赖及<code>ehcache</code>的依赖</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.ehcache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>在<code>application.yml</code>中配置<code>springboot-cache</code>让其使用<code>ehcache</code>，并指定<code>ehcache</code>的配置文件路径</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ehcache</span></span><br><span class="line">  <span class="attr">ehcache:</span></span><br><span class="line">  <span class="attr">config:</span> <span class="string">classpath:/ehcache-spring.xml</span></span><br></pre></td></tr></table></figure><ul><li>创建<code>ehcache</code>的配置文件</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">&quot;http://ehcache.org/ehcache.xsd&quot;</span> <span class="attr">updateCheck</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 磁盘缓存位置 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">&quot;./cache&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- maxElementsInMemory： 在内存中缓存的element的最大数目。--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- eternal:elements是否永久有效，如果为true，timeouts将被忽略，element将永不过期 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- timeToIdleSeconds:发呆秒数，发呆期间未访问缓存立即过期，当eternal为false时，这个属性才有效，0为不限制 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- timeToLiveSeconds:总存活秒数，当eternal为false时，这个属性才有效，0为不限制 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- overflowToDisk： 如果内存中数据超过内存限制，是否要缓存到磁盘上 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- statistics：是否收集统计信息。如果需要监控缓存使用情况，应该打开这个选项。默认为关闭（统计会影响性能）。设置statistics=&quot;true&quot;开启统计 --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        默认缓存</span></span><br><span class="line"><span class="comment">        无过期时间，但 3600 秒内无人访问缓存立即过期</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cache</span> <span class="attr">name</span>=<span class="string">&quot;blog-cache&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">maxElementsInMemory</span>=<span class="string">&quot;1000&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;3600&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">overflowToDisk</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="自定义缓存Key的生成策略"><a href="#自定义缓存Key的生成策略" class="headerlink" title="自定义缓存Key的生成策略"></a>自定义缓存Key的生成策略</h3><p><code>spring cache</code>缓存的<code>key</code>默认是通过<code>KeyGenerator</code>生成的，其默认生成策略如下</p><ul><li>如果方法没有参数，则使用0作为<code>key</code></li><li>如果只有一个参数的话则使用该参数作为<code>key</code></li><li>如果参数多于一个的话则使用所有参数的<code>hashCode</code>作为<code>key</code></li></ul><p>可以看出默认的key生成策略中并没有涉及方法名称和类，这就意味着如果我们有两个参数列表相同的方法，我们用相同的参数分别调用两个方法，当调用第二个方法的时候，spring cache将会返回缓存中的第一个方法的缓存值，因为他们的key是一样的</p><ul><li><p>我们可以去自定一个<code>CacheConfig</code>的类用作缓存的配置，继承一下<code>CachingConfigurerSupport</code>类，覆写它的<code>keyGenerator</code>方法</p></li><li><p>然后我们去定义一个<code>BlogCacheKey</code>的内部类，把调用缓存的类名、方法名、参数列表传过来，在这个类里覆写一下它的<code>equals</code>方法，综合考虑上述参数完成key的定义</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kevinlu98.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CachingConfigurerSupport;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.interceptor.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author: Mr丶冷文</span></span><br><span class="line"><span class="comment"> * Date: 2022/10/11 16:37</span></span><br><span class="line"><span class="comment"> * Email: kevinlu98@qq.com</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheConfig</span> <span class="keyword">extends</span> <span class="title class_">CachingConfigurerSupport</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> KeyGenerator <span class="title function_">keyGenerator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (target, method, params) -&gt; <span class="keyword">new</span> <span class="title class_">BlogCacheKey</span>(target.getClass().getName(),method.getName(),params);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">BlogCacheKey</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String className;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String methodName;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Object[] params;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> hashCode;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">BlogCacheKey</span><span class="params">(String className, String methodName, Object[] params)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.className = className;</span><br><span class="line">            <span class="built_in">this</span>.methodName = methodName;</span><br><span class="line">            <span class="built_in">this</span>.params = params;</span><br><span class="line">            <span class="type">String</span> <span class="variable">sign</span> <span class="operator">=</span> className + <span class="string">&quot;_&quot;</span> + methodName + <span class="string">&quot;_&quot;</span> + Arrays.deepHashCode(params);</span><br><span class="line">            <span class="built_in">this</span>.hashCode = sign.hashCode();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.hashCode;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (obj == <span class="built_in">this</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (!(obj <span class="keyword">instanceof</span> BlogCacheKey)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="type">BlogCacheKey</span> <span class="variable">other</span> <span class="operator">=</span> (BlogCacheKey) obj;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.hashCode == other.hashCode) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">return</span> StringUtils.equals(<span class="built_in">this</span>.className, other.className)</span><br><span class="line">                    &amp;&amp; StringUtils.equals(<span class="built_in">this</span>.methodName, other.methodName)</span><br><span class="line">                    &amp;&amp; Arrays.deepEquals(<span class="built_in">this</span>.params, other.params);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="启用缓存"><a href="#启用缓存" class="headerlink" title="启用缓存"></a>启用缓存</h3><ul><li><p>在启动类上加上<code>EnableCaching</code>的注解开启缓存</p></li><li><p>给我们要缓存的对象对应类实现下<code>Serializable</code>接口</p></li><li><p>我们在查询友情链接及导航栏还有轮播图这里先加上缓存注解<code>CacheConfig</code>，然后在需要加缓存的方法上加上<code>Cacheabel</code></p></li><li><p>在更新及删除操作时清空缓存<code>CacheEvict</code></p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kevinlu98.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.kevinlu98.mapper.FriendlyMapper;</span><br><span class="line"><span class="keyword">import</span> cn.kevinlu98.pojo.Friendly;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CacheConfig;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CacheEvict;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author: Mr丶冷文</span></span><br><span class="line"><span class="comment"> * Date: 2022/10/6 22:20</span></span><br><span class="line"><span class="comment"> * Email: kevinlu98@qq.com</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@CacheConfig(cacheNames = &#123;&quot;blog-cache&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FriendlyService</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> FriendlyMapper mapper;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">FriendlyService</span><span class="params">(FriendlyMapper mapper)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.mapper = mapper;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有的友情链接</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 友情链接列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  <span class="meta">@Cacheable</span></span><br><span class="line">  <span class="keyword">public</span> List&lt;Friendly&gt; <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mapper.findAll();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CacheEvict(allEntries = true)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Friendly friendly)</span> &#123;</span><br><span class="line">    mapper.save(friendly);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id从数据库表中删除数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 主键</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  <span class="meta">@CacheEvict(allEntries = true)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    mapper.deleteById(id);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="首页文章列表的展示"><a href="#首页文章列表的展示" class="headerlink" title="首页文章列表的展示"></a>首页文章列表的展示</h2><ul><li><p>给<code>index</code>方法加上<code>pn</code>的参数用于标识是分页</p></li><li><p>我们可以直接调用之前我们写的<code>search</code>方法来进行搜索</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">(<span class="meta">@RequestParam(required = false, defaultValue = &quot;1&quot;)</span> Integer pn, Model model)</span> &#123;</span><br><span class="line">  pn = pn &lt; <span class="number">1</span> ? <span class="number">1</span> : pn;</span><br><span class="line">  model.addAttribute(<span class="string">&quot;articlePage&quot;</span>, articleService.search(ArticleSearch.builder().pageSize(<span class="number">2</span>).pageNum(pn).status(Article.STATUS_PUBLISH).type(Article.TYPE_ARTICLE).build()));</span><br><span class="line">  model.addAttribute(<span class="string">&quot;banners&quot;</span>, bannerService.list());</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>补充评论数</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// commentMapper</span></span><br><span class="line"><span class="type">long</span> <span class="title function_">countByArticle</span><span class="params">(Article article)</span>;</span><br><span class="line"><span class="comment">//search</span></span><br><span class="line"><span class="keyword">return</span> PageHelper.&lt;Article&gt;builder()</span><br><span class="line">  .rows(articlePage.getContent().stream().peek(x -&gt; x.setCommentCount(commentMapper.countByArticle(x))).collect(Collectors.toList()))</span><br><span class="line">  .total(articlePage.getTotalElements())</span><br><span class="line">  .current(search.getPageNum())</span><br><span class="line">  .totalPage(articlePage.getTotalPages())</span><br><span class="line">  .build();</span><br></pre></td></tr></table></figure><ul><li>首页文章列表展示</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">article</span> <span class="attr">th:each</span>=<span class="string">&quot;article:$&#123;articlePage.rows&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;lw-article-item lw-posr&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-article-cover lw-posa lw-xs-hidden&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;@defaultImage.cover(article.cover)&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-article-info&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;lw-xs-hidden&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;lw-category&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;article.category.name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/&#123;id&#125;.html(id=$&#123;article.id&#125;)&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;article.title&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-desc&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;article.summary()&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-text-hidden lw-article-more&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-clock-o lw-mr5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#dates.format(article.created,&#x27;yyyy-MM-dd HH:mm&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-eye lw-mr5 lw-ml10&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;article.views&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-comment lw-ml10 lw-mr5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;article.commentCount&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>分页部分处理</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;articlePage.totalPage&gt;1&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;lw-pagenation&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;articlePage.current != 1&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/&#125;&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;num:$&#123;#numbers.sequence(1,articlePage.totalPage)&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;articlePage.current eq num&#125;?&#x27;lw-active&#x27;:&#x27;&#x27;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/(pn=$&#123;num&#125;)&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;num&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;articlePage.current != articlePage.totalPage&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/(pn=$&#123;articlePage.totalPage&#125;)&#125;&quot;</span>&gt;</span>尾页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h2&gt;&lt;p&gt;上节课我们已经将前台页面公共部分替换成了动态的，但这个时候就有问题了，因为我们每次访问其它页面的时候都会去查多次数据库，这样会加大数据库的压</summary>
      
    
    
    
    <category term="个人博客项目" scheme="https://study.kevinlu98.cn/categories/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="java" scheme="https://study.kevinlu98.cn/tags/java/"/>
    
    <category term="springboot" scheme="https://study.kevinlu98.cn/tags/springboot/"/>
    
    <category term="个人博客" scheme="https://study.kevinlu98.cn/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    
  </entry>
  
  <entry>
    <title>(十三)首页展示及公共部分展示</title>
    <link href="https://study.kevinlu98.cn/2022/10/07/shou-ye-zhan-shi-ji-gong-gong-bu-fen-zhan-shi.html"/>
    <id>https://study.kevinlu98.cn/2022/10/07/shou-ye-zhan-shi-ji-gong-gong-bu-fen-zhan-shi.html</id>
    <published>2022-10-06T18:21:00.000Z</published>
    <updated>2023-01-17T11:51:09.215Z</updated>
    
    <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>上节课我们把页面还有公共部分做了抽取，这节课就把首页展示的东西以及公共区域展示的东西处理一下</p><h2 id="公共部分"><a href="#公共部分" class="headerlink" title="公共部分"></a>公共部分</h2><ul><li>定义<code>IndexController</code>公共返回<code>Model</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ModelAttribute</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">indexModel</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">  <span class="comment">// todo 可以在这里定义这个controller公用的model的属性</span></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>底部的友情链接</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.addAttribute(<span class="string">&quot;friendlies&quot;</span>, friendlyService.list());</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>友情链接<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--/*@thymesVar id=&quot;friendlies&quot; type=&quot;java.util.List&lt;cn.kevinlu98.pojo.Friendly&gt;&quot;*/--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:each</span>=<span class="string">&quot;friendly:$&#123;friendlies&#125;&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;$&#123;friendly.link&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;friendly.title&#125;&quot;</span>&gt;</span>冷文学习者<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>顶部导航条部分</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Mapper层 </span></span><br><span class="line">List&lt;Navigation&gt; <span class="title function_">findAllByEnableOrderByOrderedAsc</span><span class="params">(Boolean enable)</span>;</span><br><span class="line"><span class="comment">//Service层</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Navigation&gt; <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> mapper.findAllByEnableOrderByOrderedAsc(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//IndexModel</span></span><br><span class="line">model.addAttribute(<span class="string">&quot;navigations&quot;</span>, navigationService.show());</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-nav lw-posa&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-home&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--/*@thymesVar id=&quot;navigations&quot; type=&quot;java.util.List&lt;cn.kevinlu98.pojo.Navigation&gt;&quot;*/--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:each</span>=<span class="string">&quot;navigation:$&#123;navigations&#125;&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;$&#123;navigation.link&#125;&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">th:target</span>=<span class="string">&quot;$&#123;navigation.linkMode&#125;?&#x27;_blank&#x27;:&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;navigation.icon.length()&gt;0&#125;&quot;</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;&#x27;fa fa-&#x27;+navigation.icon&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;navigation.name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;lw-fr lw-search-btn&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding: 0;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-search&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>右侧标签部分：我们希望这里可以随机展示30个标签，所以这里可以利用数据库的<code>order by rand()</code> 来进行排序</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Mapper</span></span><br><span class="line"><span class="meta">@Query(value = &quot;select * from blog_tag order by rand() limit ?1&quot;, nativeQuery = true)</span></span><br><span class="line">List&lt;Tag&gt; <span class="title function_">findRandom</span><span class="params">(<span class="type">int</span> length)</span>;</span><br><span class="line"><span class="comment">//Service</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Tag&gt; <span class="title function_">list</span><span class="params">(<span class="type">int</span> length)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> mapper.findRandom(length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//IndexModel</span></span><br><span class="line">model.addAttribute(<span class="string">&quot;tags&quot;</span>, tagService.list(<span class="number">30</span>));</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-right-item lw-tag-cloud&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-tags lw-mr5&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>标签云<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--/*@thymesVar id=&quot;tags&quot; type=&quot;java.util.List&lt;cn.kevinlu98.pojo.Tag&gt;&quot;*/--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:each</span>=<span class="string">&quot;tag:$&#123;tags&#125;&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">th:title</span>=<span class="string">&quot;$&#123;tag.name&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;tag.name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>定义默认图片处理类：因为我们的文章有可能是没有封面的，所以我们来定义一个处理类处理一下封面为空的文章封面，给其一个默认图片，当然，默认图片我们也是要做成可配置的，我们可以自定义默认图片列表</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kevinlu98.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author: Mr丶冷文</span></span><br><span class="line"><span class="comment"> * Date: 2022/10/11 11:54</span></span><br><span class="line"><span class="comment"> * Email: kevinlu98@qq.com</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;default-image&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultImage</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; images;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">cover</span><span class="params">(String imgUrl)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmptyOrWhitespace(imgUrl)) &#123;</span><br><span class="line">            <span class="keyword">return</span> images.get((<span class="type">int</span>) (Math.random() * images.size()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> imgUrl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">default-image:</span></span><br><span class="line">  <span class="attr">images:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/static/image/1.jpg</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/static/image/2.jpg</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/static/image/3.jpg</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/static/image/4.jpg</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/static/image/5.jpg</span></span><br></pre></td></tr></table></figure><ul><li>右侧的热门文章</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Mapper</span></span><br><span class="line"><span class="meta">@Query(value = &quot;select * from blog_article where type = 1 and status = 1 order by views limit ?1&quot;, nativeQuery = true)</span></span><br><span class="line">List&lt;Article&gt; <span class="title function_">hotList</span><span class="params">(<span class="type">int</span> length)</span>;</span><br><span class="line"><span class="comment">//Service</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Article&gt; <span class="title function_">hotList</span><span class="params">(<span class="type">int</span> length)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> mapper.hotList(length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//IndexModel</span></span><br><span class="line">model.addAttribute(<span class="string">&quot;hots&quot;</span>, articleService.hotList(<span class="number">5</span>));</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;hot,it:$&#123;hots&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/&#123;id&#125;.html(id=$&#123;hot.id&#125;)&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-img&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;label label-danger lw-posa&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;it.index eq 0&#125;&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;label label-warning lw-posa&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;it.index eq 1&#125;&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;label label-info lw-posa&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;it.index eq 2&#125;&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;label label-default lw-posa&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;it.index &gt; 2&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;it.index+1&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;@defaultImage.cover(hot.cover)&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-title&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;hot.title&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-info&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-eye lw-mr5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;hot.views&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>轮播图的展示</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">  model.addAttribute(<span class="string">&quot;banners&quot;</span>,bannerService.list());</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">&quot;banner:$&#123;banners&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;swiper-slide lw-posr&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;banner.cover&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">srcset</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-banner-info lw-posa&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;$&#123;banner.link&#125;&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;lw-text-hidden&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;label label-danger lw-mr5&quot;</span>&gt;</span>站长推荐<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;banner.title&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;banner.summary&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h2&gt;&lt;p&gt;上节课我们把页面还有公共部分做了抽取，这节课就把首页展示的东西以及公共区域展示的东西处理一下&lt;/p&gt;
&lt;h2 id=&quot;公共部分&quot;&gt;&lt;a hr</summary>
      
    
    
    
    <category term="个人博客项目" scheme="https://study.kevinlu98.cn/categories/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="java" scheme="https://study.kevinlu98.cn/tags/java/"/>
    
    <category term="springboot" scheme="https://study.kevinlu98.cn/tags/springboot/"/>
    
    <category term="个人博客" scheme="https://study.kevinlu98.cn/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    
  </entry>
  
  <entry>
    <title>(十二)前台页面的导入及公共数据的配置</title>
    <link href="https://study.kevinlu98.cn/2022/10/06/qian-tai-ye-mian-de-dao-ru-ji-gong-gong-shu-ju-de-pei-zhi.html"/>
    <id>https://study.kevinlu98.cn/2022/10/06/qian-tai-ye-mian-de-dao-ru-ji-gong-gong-shu-ju-de-pei-zhi.html</id>
    <published>2022-10-06T12:21:00.000Z</published>
    <updated>2023-01-17T11:51:09.214Z</updated>
    
    <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>管理后台我们几乎已经完成了，只差评论管理还有控制台的信息展示了，那里等我们把前台做完再做，因为那两个功能中有些功能依赖了前台的交互</p><h2 id="文章编辑页的处理"><a href="#文章编辑页的处理" class="headerlink" title="文章编辑页的处理"></a>文章编辑页的处理</h2><p>上节课忘了说，这节课补充一下</p><ul><li>当页面为新增时返回新增文章</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.addAttribute(<span class="string">&quot;title&quot;</span>, Objects.isNull(article.getId()) ? <span class="string">&quot;创建新文章&quot;</span> : <span class="string">&quot;编辑 &quot;</span> + article.getTitle());</span><br></pre></td></tr></table></figure><ul><li>当页面为编辑页面时返回编辑+文章标题</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">title</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;title&#125;&quot;</span>&gt;</span>新增文章<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">style</span>=<span class="string">&quot;margin-bottom: 30px;text-align: center&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;title&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="页面素材"><a href="#页面素材" class="headerlink" title="页面素材"></a>页面素材</h2><h3 id="素材介绍"><a href="#素材介绍" class="headerlink" title="素材介绍"></a>素材介绍</h3><ul><li><code>error.html</code>：错误页面</li><li><code>category.html</code>：分类大全页面</li><li><code>detail.html</code>：文章详情页面</li><li><code>index.html</code>：首页</li><li><code>list.html</code>：列表页</li><li><code>tags.html</code>：标签页</li><li><code>/static/</code>：静态资源</li></ul><h3 id="素材导入"><a href="#素材导入" class="headerlink" title="素材导入"></a>素材导入</h3><ul><li>将静态资源<code>/static/</code>目录复制到项目的<code>static/</code>目录中</li><li>将页面直接复制到<code>templates</code>文件夹下</li></ul><h2 id="站点配置"><a href="#站点配置" class="headerlink" title="站点配置"></a>站点配置</h2><p>我们创建一个站点配置类，因为我们这是一个个人博客，我们就没有必要去把用户信息保存到数据库里了，因为只有我们一个用户，所以我这里采用配置文件的方式配置</p><p>站点配置类的类名为<code>WebSite</code>，属性列表如下(只写这节课我们用到的，后面用到的我们慢慢来补充)：</p><table><thead><tr><th>属性</th><th>备注</th><th>类型</th></tr></thead><tbody><tr><td>title</td><td>站点名称</td><td>String</td></tr><tr><td>keywords</td><td>SEO的关键字</td><td>List<String></td></tr><tr><td>description</td><td>SEO的站点描述</td><td>String</td></tr><tr><td>nickname</td><td>站长昵称</td><td>String</td></tr><tr><td>address</td><td>站长坐标</td><td>String</td></tr><tr><td>tags</td><td>站长标签</td><td>List<String></td></tr><tr><td>navdesc</td><td>标题栏的一句话</td><td>String</td></tr><tr><td>qq</td><td>qq</td><td>String</td></tr><tr><td>github</td><td>github</td><td>String</td></tr><tr><td>sina</td><td>新浪微博</td><td>String</td></tr><tr><td>mail</td><td>邮箱</td><td>String</td></tr><tr><td>footer</td><td>footer部分</td><td>String</td></tr><tr><td>logo</td><td>主页的大logo</td><td>String</td></tr></tbody></table><p>在<code>yml</code>文件做补充相应的配置并使用<code>@ConfigurationProperties</code>注解初始化配置类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kevinlu98.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author: Mr丶冷文</span></span><br><span class="line"><span class="comment"> * Date: 2022/10/10 15:40</span></span><br><span class="line"><span class="comment"> * Email: kevinlu98@qq.com</span></span><br><span class="line"><span class="comment"> * Description: 站点配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;website&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSite</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; keywords;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; tags;</span><br><span class="line">    <span class="keyword">private</span> String navdesc;</span><br><span class="line">    <span class="keyword">private</span> String qq;</span><br><span class="line">    <span class="keyword">private</span> String github;</span><br><span class="line">    <span class="keyword">private</span> String sina;</span><br><span class="line">    <span class="keyword">private</span> String mail;</span><br><span class="line">    <span class="keyword">private</span> String footer;</span><br><span class="line">    <span class="keyword">private</span> String logo;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">website:</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">冷文学习者</span></span><br><span class="line">  <span class="attr">keywords:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">typecho</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">freewind</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">java</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">程序员</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">springboot</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">学习</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">自学</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">冷文学习者</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">冷文图床</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">冷文学习者(KEVINLU98.COM)，记录一个北漂小码农的日常业余生活</span></span><br><span class="line">  <span class="attr">avatar:</span> <span class="string">https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2042/ad0278954bd84793b809913c3ded4592.jpg</span></span><br><span class="line">  <span class="attr">nickname:</span> <span class="string">Mr丶冷文</span></span><br><span class="line">  <span class="attr">address:</span> <span class="string">北京</span> <span class="string">昌平</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">java</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">springboot</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">大数据</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">网页设计</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">php爱好者</span></span><br><span class="line">  <span class="attr">navdesc:</span> <span class="string">让崇拜从这里开始，用代码做点好玩的事件，让每一天都变的充实起来</span></span><br><span class="line">  <span class="attr">qq:</span> <span class="number">1628048198</span></span><br><span class="line">  <span class="attr">github:</span> <span class="string">https://github.com/kevinlu98?tab=repositories</span></span><br><span class="line">  <span class="attr">sina:</span> <span class="string">https://weibo.com/lengwenboke</span></span><br><span class="line">  <span class="attr">mail:</span> <span class="string">kevinlu98@qq.com</span></span><br><span class="line">  <span class="attr">logo:</span> <span class="string">/static/image/logo.png</span></span><br><span class="line">  <span class="attr">footer:</span> <span class="string">&#x27;© 2019-2020 &lt;a href=&quot;/&quot;&gt;冷文学习者&lt;/a&gt; &lt;a target=&quot;_blank&quot; href=&quot;https://beian.miit.gov.cn&quot;&gt;陕ICP备19024566-1号&lt;/a&gt;</span></span><br><span class="line"><span class="string">&lt;a style=&quot;margin-left: 10px&quot; target=&quot;_blank&quot; href=&quot;http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11011402012109&quot;&gt;&lt;img style=&quot;vertical-align: top;&quot; src=&quot;https://imagebed-1252410096.cos.ap-nanjing.myqcloud.com/2046/d4ab98835b8842c88eededac6e7c9e35.png&quot;&gt;京公网安备</span></span><br><span class="line"><span class="string">    11011402012109号&lt;/a&gt;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="定义页面路由"><a href="#定义页面路由" class="headerlink" title="定义页面路由"></a>定义页面路由</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kevinlu98.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.kevinlu98.common.WebSite;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author: Mr丶冷文</span></span><br><span class="line"><span class="comment"> * Date: 2022/10/10 15:56</span></span><br><span class="line"><span class="comment"> * Email: kevinlu98@qq.com</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexController</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;list&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/category&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">category</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;category&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@GetMapping(&quot;/tags&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">tags</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;tags&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@GetMapping(&quot;/error&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">error</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@GetMapping(&quot;/&#123;id&#125;.html&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">detail</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;detail&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="完成公共页面的抽取"><a href="#完成公共页面的抽取" class="headerlink" title="完成公共页面的抽取"></a>完成公共页面的抽取</h2><h3 id="header"><a href="#header" class="headerlink" title="header"></a>header</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">th:fragment</span>=<span class="string">&quot;header(title,link,style)&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span> <span class="attr">th:replace</span>=<span class="string">&quot;$&#123;title&#125;&quot;</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">th:content</span>=<span class="string">&quot;$&#123;@webSite.description&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;keywords&quot;</span> <span class="attr">th:content</span>=<span class="string">&quot;$&#123;T(java.lang.String).join(&#x27;,&#x27;,@webSite.keywords)&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 最新版本的 Bootstrap 核心 CSS 文件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/plugin/bootstrap/css/bootstrap.min.css&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/plugin/font-awesome/css/font-awesome.min.css&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:replace</span>=<span class="string">&quot;$&#123;link&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 自定义css文件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/css/style.css&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:replace</span>=<span class="string">&quot;$&#123;style&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="nav"><a href="#nav" class="headerlink" title="nav"></a>nav</h3><ul><li><p>qq打开聊天窗口</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tencent://message/?uin=1628048198&amp;amp;Site=&amp;amp;menu=yes</span><br></pre></td></tr></table></figure></li><li><p>打开邮我</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=kevinlu98@qq.com</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:fragment</span>=<span class="string">&quot;nav&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;lw-md-show&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-container lw-header lw-posr &quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-logo lw-fl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;@webSite.logo eq null or @webSite.logo.length() &lt;= 0&#125;?&#x27;/static/image/logo.png&#x27;:$&#123;@webSite.logo&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;冷文的个人博客&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;@webSite.navdesc&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-fr lw-linkme&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;$&#123;T(java.lang.String).format(&#x27;tencent://message/?uin=%s<span class="symbol">&amp;amp;</span>Site=<span class="symbol">&amp;amp;</span>menu=yes&#x27;,@webSite.qq)&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-qq&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;$&#123;@webSite.github&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-github&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;$&#123;@webSite.sina&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-weibo&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;$&#123;&#x27;http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=&#x27;+@webSite.mail&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-envelope&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-nav lw-posa&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-home&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>技术分享<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>闲言碎语<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>个人随笔<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-users&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>友情链接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-user&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>关于我<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-edit&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>留言板<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;lw-fr lw-search-btn&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding: 0;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-search&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-md-hidden lw-phone-header&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;lw-posa lw-phone-topbtn lw-search-show lw-search-btn&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span></span></span><br><span class="line"><span class="tag">                                                                                                 <span class="attr">class</span>=<span class="string">&quot;fa fa-search&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;lw-index&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>冷文学习者<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-md-hidden&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 100px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="footer"><a href="#footer" class="headerlink" title="footer"></a>footer</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:fragment</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-friend-link&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-container&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>友情链接<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>冷文学习者<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>冷文博客<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>冷文聊编程<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>GetHub<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>CSDN<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>百度一下<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>新浪微博<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>谷歌搜索<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>知乎<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>掘金<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span> <span class="attr">th:utext</span>=<span class="string">&quot;$&#123;@webSite.footer&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-mask&quot;</span> <span class="attr">id</span>=<span class="string">&quot;lw-search-box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-search-conetnt&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;lw-search-close lw-posa&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-close&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-search-input lw-posr&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入搜索关键字...&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;lw-posa&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-search lw-mr5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>推荐关键字：</span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void (0)&quot;</span>&gt;</span>独立下载<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void (0)&quot;</span>&gt;</span>评论通知<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void (0)&quot;</span>&gt;</span>点赞<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void (0)&quot;</span>&gt;</span>非插件<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void (0)&quot;</span>&gt;</span>tp5<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void (0)&quot;</span>&gt;</span>ajax<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void (0)&quot;</span>&gt;</span>json<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void (0)&quot;</span>&gt;</span>IO模型<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void (0)&quot;</span>&gt;</span>跨域<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void (0)&quot;</span>&gt;</span>javascript<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void (0)&quot;</span>&gt;</span>springboot<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void (0)&quot;</span>&gt;</span>视频剪辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void (0)&quot;</span>&gt;</span>后期<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void (0)&quot;</span>&gt;</span>个人随笔<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/plugin/jquery/jquery-3.5.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 最新的 Bootstrap 核心 JavaScript 文件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/plugin/bootstrap/js/bootstrap.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/plugin/swiper-bundle/swiper-bundle.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/js/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Right"><a href="#Right" class="headerlink" title="Right"></a>Right</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:fragment</span>=<span class="string">&quot;right&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-right-item lw-profile&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-avatar-content lw-posr&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">style</span>=<span class="string">&quot;background-image:url(/static/image/5-120601094K3-50.gif);&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-avatar lw-posa&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;@webSite.avatar&#125;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/static/image/avatar.jpeg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;lw-info&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>博主<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;@webSite.nickname&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>坐标<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;@webSite.address&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>标签<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;T(java.lang.String).join(&#x27;、&#x27;,@webSite.tags)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-right-item lw-right-hot&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-fire lw-mr5&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>热门文章<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-list&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-img&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;label label-danger lw-posa&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/static/image/1.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-title&quot;</span>&gt;</span>Freewind主题编辑器展示<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-info&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa-solid fa-fire-flame-curved&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 65580 <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-img&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;label label-warning lw-posa&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/static/image/2.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-title&quot;</span>&gt;</span>Conda虚拟环境使用<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-info&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa-solid fa-fire-flame-curved&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 56283 <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-img&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;label label-info lw-posa&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/static/image/3.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-title&quot;</span>&gt;</span>纯 CSS 图片碎裂动画教程<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-info&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa-solid fa-fire-flame-curved&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 52213 <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-img&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;label label-default lw-posa&quot;</span>&gt;</span>4<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/static/image/4.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-title&quot;</span>&gt;</span>Spring Boot 3.0 M1 发布<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-info&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa-solid fa-fire-flame-curved&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 23132 <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-img&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;label label-default lw-posa&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/static/image/5.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-title&quot;</span>&gt;</span>异步上传文件显示进度条<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lw-hot-info&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa-solid fa-fire-flame-curved&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 12322 <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;lw-right-item lw-tag-cloud&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-tags lw-mr5&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>标签云<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/freewind/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;freewind&quot;</span>&gt;</span></span><br><span class="line">      freewind<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/typecho/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;typecho&quot;</span>&gt;</span></span><br><span class="line">      typecho<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/%E6%8F%92%E4%BB%B6/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;插件&quot;</span>&gt;</span></span><br><span class="line">      插件<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/emlog/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;emlog&quot;</span>&gt;</span></span><br><span class="line">      emlog<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/java/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;java&quot;</span>&gt;</span></span><br><span class="line">      java<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/%E4%B8%BB%E9%A2%98/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;主题&quot;</span>&gt;</span></span><br><span class="line">      主题<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/%E8%87%AA%E7%94%B1%E4%B9%8B%E9%A3%8E/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;自由之风&quot;</span>&gt;</span></span><br><span class="line">      自由之风<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/%E5%9B%BE%E5%BA%8A/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;图床&quot;</span>&gt;</span></span><br><span class="line">      图床<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/%E5%86%B7%E6%96%87%E5%9B%BE%E5%BA%8A/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;冷文图床&quot;</span>&gt;</span></span><br><span class="line">      冷文图床<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/markdown/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;markdown&quot;</span>&gt;</span></span><br><span class="line">      markdown<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/gitee/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;gitee&quot;</span>&gt;</span></span><br><span class="line">      gitee<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/springboot/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;springboot&quot;</span>&gt;</span></span><br><span class="line">      springboot<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/linux/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;linux&quot;</span>&gt;</span></span><br><span class="line">      linux<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/mac/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;mac&quot;</span>&gt;</span></span><br><span class="line">      mac<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/%E5%AD%A6%E4%B9%A0/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;学习&quot;</span>&gt;</span></span><br><span class="line">      学习<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/python/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;python&quot;</span>&gt;</span></span><br><span class="line">      python<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/conda/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;conda&quot;</span>&gt;</span></span><br><span class="line">      conda<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/%E7%9B%B8%E5%86%8C/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;相册&quot;</span>&gt;</span></span><br><span class="line">      相册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/jsDelivr/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;jsDelivr&quot;</span>&gt;</span></span><br><span class="line">      jsDelivr<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/cdn/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;cdn&quot;</span>&gt;</span></span><br><span class="line">      cdn<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/codemirror/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;codemirror&quot;</span>&gt;</span></span><br><span class="line">      codemirror<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/freedom/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;freedom&quot;</span>&gt;</span></span><br><span class="line">      freedom<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/%E8%85%BE%E8%AE%AFcos/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;腾讯cos&quot;</span>&gt;</span></span><br><span class="line">      腾讯cos<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/cos/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;cos&quot;</span>&gt;</span></span><br><span class="line">      cos<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/%E7%A7%81%E4%BA%BA%E5%9B%BE%E5%BA%8A/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;私人图床&quot;</span>&gt;</span></span><br><span class="line">      私人图床<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/%E6%AC%A2%E8%BF%8E%E9%A1%B5/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;欢迎页&quot;</span>&gt;</span></span><br><span class="line">      欢迎页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/%E7%99%BB%E5%BD%95%E6%B3%A8%E5%86%8C/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;登录注册&quot;</span>&gt;</span></span><br><span class="line">      登录注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/%E6%95%99%E7%A8%8B%E4%B8%8B%E8%BD%BD/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;教程下载&quot;</span>&gt;</span></span><br><span class="line">      教程下载<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/itjc8/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;itjc8&quot;</span>&gt;</span></span><br><span class="line">      itjc8<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.kevinlu98.cn/tag/%E8%99%9A%E6%8B%9F%E6%9C%BA/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;虚拟机&quot;</span>&gt;</span></span><br><span class="line">      虚拟机<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h2&gt;&lt;p&gt;管理后台我们几乎已经完成了，只差评论管理还有控制台的信息展示了，那里等我们把前台做完再做，因为那两个功能中有些功能依赖了前台的交互&lt;/p&gt;
</summary>
      
    
    
    
    <category term="个人博客项目" scheme="https://study.kevinlu98.cn/categories/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="java" scheme="https://study.kevinlu98.cn/tags/java/"/>
    
    <category term="springboot" scheme="https://study.kevinlu98.cn/tags/springboot/"/>
    
    <category term="个人博客" scheme="https://study.kevinlu98.cn/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="博客系统" scheme="https://study.kevinlu98.cn/tags/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>(十一)完成导航管理及统一异常处理</title>
    <link href="https://study.kevinlu98.cn/2022/10/06/wan-cheng-dao-hang-guan-li-ji-tong-yi-yi-chang-chu-li.html"/>
    <id>https://study.kevinlu98.cn/2022/10/06/wan-cheng-dao-hang-guan-li-ji-tong-yi-yi-chang-chu-li.html</id>
    <published>2022-10-06T10:21:00.000Z</published>
    <updated>2023-01-17T11:51:09.214Z</updated>
    
    <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>导航管理这里也没有任何业务逻辑，所以我们用代码生成器生成一下然后展示稍微做个修改就可以啦，完成导航管理后我们就可以管理后台的功能就先告一段落，后面几节课就主要做前台的开发</p><h2 id="新增编辑文章标题处理"><a href="#新增编辑文章标题处理" class="headerlink" title="新增编辑文章标题处理"></a>新增编辑文章标题处理</h2><p>我突然发现我们编辑文章及新增文章时标题都是新增文章，这里我们处理一下，直接让后端返回页面标题</p><ul><li>当页面为新增时返回新增文章</li><li>当页面为编辑页面时返回编辑+文章标题</li></ul><h2 id="导航实体及数据库"><a href="#导航实体及数据库" class="headerlink" title="导航实体及数据库"></a>导航实体及数据库</h2><ul><li>实体类名：Navigation</li><li>数据库名：blog_navigation</li></ul><table><thead><tr><th>属性</th><th>类型</th><th>备注</th></tr></thead><tbody><tr><td>id</td><td>整数</td><td>主键</td></tr><tr><td>name</td><td>字符串</td><td>名称</td></tr><tr><td>icon</td><td>字符串</td><td>图标: fontawesome4.7</td></tr><tr><td>link</td><td>字符串</td><td>跳转链接</td></tr><tr><td>linkMode</td><td>布尔</td><td>跳转方式：false.当前页跳转；true.新标签页跳转</td></tr><tr><td>enable</td><td>布尔</td><td>是否启用</td></tr><tr><td>ordered</td><td>整数</td><td>顺序</td></tr></tbody></table><h2 id="导航管理"><a href="#导航管理" class="headerlink" title="导航管理"></a>导航管理</h2><ul><li><p>生成代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">name----名称</span><br><span class="line">icon----图标</span><br><span class="line">link----跳转链接</span><br><span class="line">ordered---顺序</span><br><span class="line">linkMode----跳转方式</span><br><span class="line">enable----是否启用</span><br></pre></td></tr></table></figure></li><li><p>修改表单样式</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal fade&quot;</span> <span class="attr">id</span>=<span class="string">&quot;save-window&quot;</span> <span class="attr">tabindex</span>=<span class="string">&quot;-1&quot;</span> <span class="attr">role</span>=<span class="string">&quot;dialog&quot;</span> <span class="attr">aria-labelledby</span>=<span class="string">&quot;myModalLabel&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-dialog&quot;</span> <span class="attr">role</span>=<span class="string">&quot;document&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-content&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;data-form&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-header&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;close&quot;</span> <span class="attr">data-dismiss</span>=<span class="string">&quot;modal&quot;</span> <span class="attr">aria-label</span>=<span class="string">&quot;Close&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">                                                                                            <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="symbol">&amp;times;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">&quot;modal-title&quot;</span> <span class="attr">id</span>=<span class="string">&quot;window-title&quot;</span>&gt;</span>Modal title<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-body&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">required</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入名称...&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span>&gt;</span>图标<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入图标...&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span>&gt;</span>跳转链接<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;url&quot;</span> <span class="attr">name</span>=<span class="string">&quot;link&quot;</span> <span class="attr">required</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入跳转链接...&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span>&gt;</span>顺序<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;ordered&quot;</span> <span class="attr">required</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入顺序...&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span>&gt;</span>打开方式<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">select</span> <span class="attr">required</span> <span class="attr">name</span>=<span class="string">&quot;linkMode&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>&gt;</span>在新页面打开<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>&gt;</span>在当前页打开<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span>&gt;</span>是否启用<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">select</span> <span class="attr">required</span> <span class="attr">name</span>=<span class="string">&quot;enable&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>&gt;</span>启用<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>&gt;</span>禁止<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-footer&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span> <span class="attr">data-dismiss</span>=<span class="string">&quot;modal&quot;</span>&gt;</span>关闭<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span>保存<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>修改表格展示</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#data-table&#x27;</span>).<span class="title function_">bootstrapTable</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/admin/navigation/&#x27;</span>,</span><br><span class="line">  <span class="attr">responseHandler</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="property">data</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">columns</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;序号&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">50</span>,</span><br><span class="line">      <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">      <span class="attr">formatter</span>: <span class="keyword">function</span> (<span class="params">value, row, index</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> index + <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;名称&#x27;</span>,</span><br><span class="line">      <span class="attr">field</span>: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">      <span class="attr">formatter</span>: <span class="keyword">function</span> (<span class="params">value, row</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`&lt;a href=&quot;<span class="subst">$&#123;row.link&#125;</span>&quot; target=&quot;_blank&quot;&gt;<span class="subst">$&#123;value&#125;</span>&lt;/a&gt;`</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;图标&#x27;</span>,</span><br><span class="line">      <span class="attr">field</span>: <span class="string">&#x27;icon&#x27;</span>,</span><br><span class="line">      <span class="attr">formatter</span>: <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`&lt;i class=&quot;fa fa-<span class="subst">$&#123;value&#125;</span>&quot;&gt;&lt;/i&gt;`</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;顺序&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">60</span>,</span><br><span class="line">      <span class="attr">field</span>: <span class="string">&#x27;ordered&#x27;</span>,</span><br><span class="line">      <span class="attr">formatter</span>: <span class="keyword">function</span> (<span class="params">value, row</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`&lt;input data-id=&quot;<span class="subst">$&#123;row.id&#125;</span>&quot; class=&quot;form-control lw-order-input&quot; style=&quot;width: 60px;&quot; type=&quot;number&quot; value=&quot;<span class="subst">$&#123;value&#125;</span>&quot;&gt;`</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;跳转方式&#x27;</span>,</span><br><span class="line">      <span class="attr">field</span>: <span class="string">&#x27;linkMode&#x27;</span>,</span><br><span class="line">      <span class="attr">formatter</span>: <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value ? <span class="string">&#x27;新页面打开&#x27;</span> : <span class="string">&#x27;当前页面打开&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;是否启用&#x27;</span>,</span><br><span class="line">      <span class="attr">field</span>: <span class="string">&#x27;enable&#x27;</span>,</span><br><span class="line">      <span class="attr">formatter</span>:<span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value?<span class="string">`&lt;i class=&quot;fa fa-check&quot;&gt;&lt;/i&gt;`</span> :<span class="string">`&lt;i class=&quot;fa fa-close&quot;&gt;&lt;/i&gt;`</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">field</span>: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">200</span>,</span><br><span class="line">      <span class="attr">formatter</span>: <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`&lt;button type=&quot;button&quot; data-id=&quot;<span class="subst">$&#123;value&#125;</span>&quot; class=&quot;btn btn-info btn-sm lw-update-btn&quot;&gt;&lt;i class=&quot;fa fa-edit&quot;&gt;&lt;/i&gt; 编辑&lt;/button&gt; &lt;button type=&quot;button&quot; data-id=&quot;<span class="subst">$&#123;value&#125;</span>&quot; class=&quot;btn btn-danger btn-sm lw-del-btn&quot;&gt;&lt;i class=&quot;fa fa-trash&quot;&gt;&lt;/i&gt; 删除&lt;/button&gt;`</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>保存顺序</p><ul><li><p>html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;lw-order-btn&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-refresh&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 保存顺序<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#lw-order-btn&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> ids = <span class="string">&quot;&quot;</span></span><br><span class="line">  $(<span class="string">&#x27;#data-table .lw-order-input&#x27;</span>).<span class="title function_">each</span>(<span class="function">(<span class="params">index, ele</span>) =&gt;</span> ids += $(ele).<span class="title function_">data</span>(<span class="string">&#x27;id&#x27;</span>) + <span class="string">&quot;----&quot;</span> + $(ele).<span class="title function_">val</span>() + <span class="string">&quot;;&quot;</span>)</span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/admin/navigation/order&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;<span class="attr">ids</span>: ids&#125;,</span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (res.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">        layer.<span class="title function_">msg</span>(<span class="string">&quot;保存成功&quot;</span>, &#123;<span class="attr">icon</span>: <span class="number">1</span>&#125;)</span><br><span class="line">        $(<span class="string">&#x27;#data-table&#x27;</span>).<span class="title function_">bootstrapTable</span>(<span class="string">&#x27;refresh&#x27;</span>, &#123;<span class="attr">silent</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        layer.<span class="title function_">msg</span>(res.<span class="property">message</span>, &#123;<span class="attr">icon</span>: <span class="number">2</span>&#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">ordered</span><span class="params">(String ids)</span> &#123;</span><br><span class="line">  Arrays.stream(ids.split(<span class="string">&quot;;&quot;</span>)).map(x -&gt; x.split(<span class="string">&quot;----&quot;</span>)).forEach(x -&gt; service.order(Integer.parseInt(x[<span class="number">0</span>]), Integer.parseInt(x[<span class="number">1</span>])));</span><br><span class="line">  <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>service</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Navigation&gt; <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> mapper.findAll(Sort.by(Sort.Direction.ASC, <span class="string">&quot;ordered&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">order</span><span class="params">(Integer id, Integer order)</span> &#123;</span><br><span class="line">  mapper.ordered(id, order);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>mapper</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Modifying</span></span><br><span class="line"><span class="meta">@Query(&quot;update Navigation set ordered = ?2 where  id = ?1&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">ordered</span><span class="params">(Integer id, Integer order)</span>;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="统一异常处理"><a href="#统一异常处理" class="headerlink" title="统一异常处理"></a>统一异常处理</h2><ul><li>创建统一全局异常处理类</li><li>创建统一异常处理方法</li><li>返回<code>json</code>格式的默认错误</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kevinlu98.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.kevinlu98.common.Result;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author: Mr丶冷文</span></span><br><span class="line"><span class="comment"> * Date: 2022/10/10 13:33</span></span><br><span class="line"><span class="comment"> * Email: kevinlu98@qq.com</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ResponseBody</span></span><br><span class="line">  <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">  <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">defaultException</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Result.error();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h2&gt;&lt;p&gt;导航管理这里也没有任何业务逻辑，所以我们用代码生成器生成一下然后展示稍微做个修改就可以啦，完成导航管理后我们就可以管理后台的功能就先告一段落</summary>
      
    
    
    
    <category term="个人博客项目" scheme="https://study.kevinlu98.cn/categories/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="java" scheme="https://study.kevinlu98.cn/tags/java/"/>
    
    <category term="springboot" scheme="https://study.kevinlu98.cn/tags/springboot/"/>
    
    <category term="个人博客" scheme="https://study.kevinlu98.cn/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="博客系统" scheme="https://study.kevinlu98.cn/tags/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>(十)文章管理的多条件分页查询</title>
    <link href="https://study.kevinlu98.cn/2022/10/06/wen-zhang-guan-li-de-duo-tiao-jian-fen-ye-cha-xun.html"/>
    <id>https://study.kevinlu98.cn/2022/10/06/wen-zhang-guan-li-de-duo-tiao-jian-fen-ye-cha-xun.html</id>
    <published>2022-10-06T07:21:00.000Z</published>
    <updated>2023-01-17T11:51:09.213Z</updated>
    
    <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>至此，我们已经将文章的新增及修改功能完成了，删除功能也由代码生成器给我们生成了，所以我们只剩下多条件分页查询功能了</p><h2 id="上节遗留问题"><a href="#上节遗留问题" class="headerlink" title="上节遗留问题"></a>上节遗留问题</h2><ul><li>我们上节课保存文章的时候有个问题就是我们查询对象使用了<code>getOne</code>方法，这个<code>getOne</code>方法是一个延迟查询，它不会立即查询数据库，只有当我们用到属性时才会进行查询， 查数据库看到我们的<code>created</code>及<code>views</code>字段还是<code>null</code>，所以我们应该用<code>findById</code>的方法查询对象再进行非空拷贝</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Article</span> <span class="variable">one</span> <span class="operator">=</span> detail(article.getId());</span><br><span class="line">UpdateUtil.copyNullProperties(article, one);</span><br><span class="line">mapper.save(one);</span><br></pre></td></tr></table></figure><ul><li>还有就是一个小细节我们忘了设置图片在<code>input</code>中的回显</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;article.cover&#125;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;cover&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="服务端分页查询"><a href="#服务端分页查询" class="headerlink" title="服务端分页查询"></a>服务端分页查询</h2><h3 id="定义条件查询参数"><a href="#定义条件查询参数" class="headerlink" title="定义条件查询参数"></a>定义条件查询参数</h3><ul><li>类名：ArticleSearch</li></ul><table><thead><tr><th>属性</th><th>类型</th><th>备注</th></tr></thead><tbody><tr><td>cid</td><td>整数</td><td>分类id</td></tr><tr><td>status</td><td>整数</td><td>状态</td></tr><tr><td>title</td><td>字符串</td><td>标题关键字</td></tr><tr><td>type</td><td>整数</td><td>文章类型</td></tr><tr><td>pageNum</td><td>整数</td><td>页码</td></tr><tr><td>pageSize</td><td>整数</td><td>页大小</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kevinlu98.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author: Mr丶冷文</span></span><br><span class="line"><span class="comment"> * Date: 2022/10/9 21:13</span></span><br><span class="line"><span class="comment"> * Email: kevinlu98@qq.com</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleSearch</span> &#123;</span><br><span class="line">    <span class="comment">//分类id</span></span><br><span class="line">    <span class="keyword">private</span> Integer cid;</span><br><span class="line">    <span class="comment">//状态</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="comment">//标题</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">//文章类型</span></span><br><span class="line">    <span class="keyword">private</span> Integer type;</span><br><span class="line">    <span class="comment">//页码</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageNum;</span><br><span class="line">    <span class="comment">//页大小</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageSize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="定义分页返回对象"><a href="#定义分页返回对象" class="headerlink" title="定义分页返回对象"></a>定义分页返回对象</h3><ul><li>类名：PageHelper</li></ul><table><thead><tr><th>属性</th><th>类型</th><th>备注</th></tr></thead><tbody><tr><td>rows</td><td>数组</td><td>数据列表</td></tr><tr><td>total</td><td>整数</td><td>总记录数</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kevinlu98.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author: Mr丶冷文</span></span><br><span class="line"><span class="comment"> * Date: 2022/10/9 21:15</span></span><br><span class="line"><span class="comment"> * Email: kevinlu98@qq.com</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageHelper</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">// 数据列表</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; rows;</span><br><span class="line">    <span class="comment">// 总记录数</span></span><br><span class="line">    <span class="keyword">private</span> Long total;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Controller层逻辑"><a href="#Controller层逻辑" class="headerlink" title="Controller层逻辑"></a>Controller层逻辑</h3><ul><li>定义<code>search</code>接口</li><li>修改错误或未填写的<code>pageNum</code>及<code>pageSize</code></li><li>调用<code>service</code>层的搜索接口</li><li>返回数据</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/search&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;PageHelper&lt;Article&gt;&gt; <span class="title function_">search</span><span class="params">(ArticleSearch search)</span> &#123;</span><br><span class="line">  search.setPageNum(Objects.isNull(search.getPageNum()) || search.getPageNum() &lt; <span class="number">1</span> ? <span class="number">1</span> : search.getPageNum());</span><br><span class="line">  search.setPageSize(Objects.isNull(search.getPageSize()) || search.getPageSize() &lt; <span class="number">1</span> ? <span class="number">1</span> : search.getPageSize());</span><br><span class="line">  PageHelper&lt;Article&gt; pageHelper = service.search(search);</span><br><span class="line">  <span class="keyword">return</span> Result.success(pageHelper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Service及Mapper的逻辑"><a href="#Service及Mapper的逻辑" class="headerlink" title="Service及Mapper的逻辑"></a>Service及Mapper的逻辑</h3><ul><li>构建<code>Pageable</code>对象添加分页信息及排序信息</li><li>让<code>Mapper</code>去继承<code>JpaSpecificationExecutor</code>复杂查询的查询使其具有复杂查询的功能</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ArticleMapper</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Article, Integer&gt;, JpaSpecificationExecutor&lt;Article&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>调用<code>findAll</code>方法传一个匿名内部类<code>Specification</code>的子类并重载<code>toPredicate</code>方法</li><li>在<code>toPredicate</code>方法中创建<code>predicateList</code>条件数组来保存所有条件</li><li>构建条件对象并加到<code>predicateList</code>数组中</li><li>用<code>and</code>的方法拼接条件并返回</li><li>构建出<code>PageHelper</code>对象</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PageHelper&lt;Article&gt; <span class="title function_">search</span><span class="params">(ArticleSearch search)</span> &#123;</span><br><span class="line">  <span class="comment">//构建分页参数</span></span><br><span class="line">  <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(search.getPageNum() - <span class="number">1</span>, search.getPageSize(), Sort.by(Sort.Direction.DESC, <span class="string">&quot;created&quot;</span>));</span><br><span class="line">  Page&lt;Article&gt; articlePage = mapper.findAll((Specification&lt;Article&gt;) (root, query, builder) -&gt; &#123;</span><br><span class="line">    List&lt;Predicate&gt; predicateList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (Objects.nonNull(search.getCid())) &#123;</span><br><span class="line">      predicateList.add(builder.equal(root.get(<span class="string">&quot;category&quot;</span>), Category.builder().id(search.getCid()).build()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (Objects.nonNull(search.getStatus())) &#123;</span><br><span class="line">      predicateList.add(builder.equal(root.get(<span class="string">&quot;status&quot;</span>), search.getStatus()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (Objects.nonNull(search.getType())) &#123;</span><br><span class="line">      predicateList.add(builder.equal(root.get(<span class="string">&quot;type&quot;</span>), search.getType()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmptyOrWhitespace(search.getTitle())) &#123;</span><br><span class="line">      predicateList.add(builder.like(root.get(<span class="string">&quot;title&quot;</span>), <span class="string">&quot;%&quot;</span> + search.getTitle() + <span class="string">&quot;%&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> builder.and(predicateList.toArray(<span class="keyword">new</span> <span class="title class_">Predicate</span>[predicateList.size()]));</span><br><span class="line">  &#125;, pageable);</span><br><span class="line">  <span class="keyword">return</span> PageHelper.&lt;Article&gt;builder().rows(articlePage.getContent()).total(articlePage.getTotalElements()).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="BSTable的分页"><a href="#BSTable的分页" class="headerlink" title="BSTable的分页"></a>BSTable的分页</h2><p>我们可以通过设置如下属性来实现分页功能 <a href="https://bootstrap-table.com/docs/api/table-options/#sidepagination">https://bootstrap-table.com/docs/api/table-options/#sidepagination</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#table&#x27;</span>).<span class="title function_">bootstrapTable</span>(&#123;</span><br><span class="line">  <span class="attr">pageNumber</span>: <span class="number">1</span>, <span class="comment">//指定默认页码</span></span><br><span class="line">  <span class="attr">pagination</span>: <span class="literal">true</span>, <span class="comment">//开启分页</span></span><br><span class="line">  <span class="attr">sidePagination</span>: <span class="string">&#x27;server&#x27;</span>, <span class="comment">//使用服务端分页</span></span><br><span class="line">  <span class="attr">pageSize</span>: <span class="number">10</span>,<span class="comment">//默认页大小</span></span><br><span class="line">  <span class="attr">pageList</span>: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>], <span class="comment">//可选页大小</span></span><br><span class="line">  <span class="comment">//bootstrap-table的分页数据是一个json，rows保存数据列表，total保存数据总数</span></span><br><span class="line">  <span class="attr">responseHandler</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">rows</span>: res.<span class="property">data</span>.<span class="property">rows</span>,</span><br><span class="line">      <span class="attr">total</span>: res.<span class="property">data</span>.<span class="property">total</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//这个是查询参数，就是bootstrap-table请求后端时携带的参数</span></span><br><span class="line">  <span class="attr">queryParams</span>: <span class="keyword">function</span> (<span class="params">params</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">pageNum</span>: (params.<span class="property">offset</span> / params.<span class="property">limit</span>) + <span class="number">1</span>,</span><br><span class="line">      <span class="attr">pageSize</span>: params.<span class="property">limit</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>为搜索栏加上id</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;lw-search-form&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-inline&quot;</span> <span class="attr">style</span>=<span class="string">&quot;float:right;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>分类<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;lw-article-category&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100px;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">th:each</span>=<span class="string">&quot;category:$&#123;categories&#125;&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;category.id&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;category.name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>状态<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;lw-article-status&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100px;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>发布<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>草稿<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>类型<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;lw-article-type&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100px;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>文章<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>页面<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>关键字<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;lw-keywords&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入关键字...&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-search&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 搜索<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>修改bootstraptable的配置使其可以分页</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#data-table&#x27;</span>).bootstrapTable(&#123;</span><br><span class="line">  url: <span class="string">&#x27;/admin/article/search&#x27;</span>,</span><br><span class="line">  pagination: <span class="literal">true</span>,</span><br><span class="line">  pageNumber: <span class="number">1</span>,</span><br><span class="line">  sidePagination: <span class="string">&#x27;server&#x27;</span>,</span><br><span class="line">  pageSize: <span class="number">10</span>,</span><br><span class="line">  pageList: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">40</span>],</span><br><span class="line">  responseHandler: function (res) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.data</span><br><span class="line">  &#125;,</span><br><span class="line">  queryParams: function (params) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      pageNum: (params.offset / params.limit) + <span class="number">1</span>,</span><br><span class="line">      pageSize: params.limit,</span><br><span class="line">      title: $(<span class="string">&#x27;#lw-keywords&#x27;</span>).val(),</span><br><span class="line">      type: $(<span class="string">&#x27;#lw-article-type&#x27;</span>).val(),</span><br><span class="line">      status: $(<span class="string">&#x27;#lw-article-status&#x27;</span>).val(),</span><br><span class="line">      cid: $(<span class="string">&#x27;#lw-article-category&#x27;</span>).val()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  columns: [</span><br><span class="line">    &#123;</span><br><span class="line">      title: <span class="string">&#x27;序号&#x27;</span>,</span><br><span class="line">      width: <span class="number">50</span>,</span><br><span class="line">      align: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">      formatter: function (value, row, index) &#123;</span><br><span class="line">        <span class="keyword">return</span> index + <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: <span class="string">&#x27;标题&#x27;</span>,</span><br><span class="line">      field: <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">      formatter: function (value, row) &#123;</span><br><span class="line">        <span class="keyword">return</span> `&lt;a href=<span class="string">&quot;/admin/write.html?id=$&#123;row.id&#125;&quot;</span>&gt;$&#123;value&#125;&lt;/a&gt;`</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: <span class="string">&#x27;状态&#x27;</span>,</span><br><span class="line">      field: <span class="string">&#x27;status&#x27;</span>,</span><br><span class="line">      formatter: function (value) &#123;</span><br><span class="line">        <span class="keyword">return</span> value === <span class="number">1</span> ? <span class="string">&#x27;发布&#x27;</span> : <span class="string">&#x27;草稿&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: <span class="string">&#x27;分类&#x27;</span>,</span><br><span class="line">      field: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">      formatter: function (value) &#123;</span><br><span class="line">        <span class="keyword">return</span> value.name</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: <span class="string">&#x27;浏览量&#x27;</span>,</span><br><span class="line">      field: <span class="string">&#x27;views&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">      field: <span class="string">&#x27;created&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      field: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">      title: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">      width: <span class="number">100</span>,</span><br><span class="line">      formatter: function (value) &#123;</span><br><span class="line">        <span class="keyword">return</span> `&lt;button type=<span class="string">&quot;button&quot;</span> data-id=<span class="string">&quot;$&#123;value&#125;&quot;</span> class=<span class="string">&quot;btn btn-danger btn-sm lw-del-btn&quot;</span>&gt;&lt;i class=<span class="string">&quot;fa fa-trash&quot;</span>&gt;&lt;/i&gt; 删除&lt;/button&gt;`</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>阻止搜索表单提交，在其提交时重载表格</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#lw-search-form&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;submit&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  $(<span class="string">&#x27;#data-table&#x27;</span>).<span class="title function_">bootstrapTable</span>(<span class="string">&#x27;refresh&#x27;</span>, &#123;<span class="attr">silent</span>: <span class="literal">true</span>, <span class="attr">pageNumber</span>: <span class="number">1</span>&#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="点击文章列表的分类实现展示该分类下的文章"><a href="#点击文章列表的分类实现展示该分类下的文章" class="headerlink" title="点击文章列表的分类实现展示该分类下的文章"></a>点击文章列表的分类实现展示该分类下的文章</h2><ul><li>修改分类的展示样式</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;分类&#x27;</span>,</span><br><span class="line">    <span class="attr">field</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">      <span class="attr">formatter</span>: <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`&lt;a class=&quot;lw-category-table&quot; href=&quot;javascript:void(0)&quot; data-id=&quot;<span class="subst">$&#123;value.id&#125;</span>&quot;&gt;<span class="subst">$&#123;value.name&#125;</span>&lt;/a&gt;`</span></span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>点击文章分类时将表单的值置为空</li><li>将分类的选择框的值置为点击的值</li><li>重载表格</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#data-table&quot;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;.lw-category-table&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> cid = $(<span class="variable language_">this</span>).<span class="title function_">data</span>(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">  $(<span class="string">&#x27;#lw-reset&#x27;</span>).<span class="title function_">click</span>()</span><br><span class="line">  $(<span class="string">&#x27;#lw-article-category&#x27;</span>).<span class="title function_">val</span>(cid)</span><br><span class="line">  $(<span class="string">&#x27;#data-table&#x27;</span>).<span class="title function_">bootstrapTable</span>(<span class="string">&#x27;refresh&#x27;</span>, &#123;<span class="attr">silent</span>: <span class="literal">true</span>, <span class="attr">pageNumber</span>: <span class="number">1</span>&#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h2&gt;&lt;p&gt;至此，我们已经将文章的新增及修改功能完成了，删除功能也由代码生成器给我们生成了，所以我们只剩下多条件分页查询功能了&lt;/p&gt;
&lt;h2 id=&quot;</summary>
      
    
    
    
    <category term="个人博客项目" scheme="https://study.kevinlu98.cn/categories/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="java" scheme="https://study.kevinlu98.cn/tags/java/"/>
    
    <category term="springboot" scheme="https://study.kevinlu98.cn/tags/springboot/"/>
    
    <category term="个人博客" scheme="https://study.kevinlu98.cn/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    
  </entry>
  
  <entry>
    <title>(九)完成新增及编辑文章功能</title>
    <link href="https://study.kevinlu98.cn/2022/10/06/wan-cheng-xin-zeng-ji-bian-ji-wen-zhang-gong-neng.html"/>
    <id>https://study.kevinlu98.cn/2022/10/06/wan-cheng-xin-zeng-ji-bian-ji-wen-zhang-gong-neng.html</id>
    <published>2022-10-06T06:21:00.000Z</published>
    <updated>2023-01-17T11:51:09.212Z</updated>
    
    <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>经过前面几节课的学习及实战，我们已经完善了文章编辑页面，这节课我们就可以完成新增文章的功能了</p><h2 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h2><h3 id="前端部分"><a href="#前端部分" class="headerlink" title="前端部分"></a>前端部分</h3><ul><li><p>补充表单的<code>name</code>属性与文章的实体对应</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;data-form&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-horizontal&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-9&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-1 control-label&quot;</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-11&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">required</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入标题...&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-1 control-label&quot;</span>&gt;</span>内容<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-11&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;lw-markdown-content&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">&quot;content&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-1 control-label&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-info&quot;</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span>&gt;</span>返回列表<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-success&quot;</span>&gt;</span>保存文章<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-3&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color:#eeeeee;padding: 20px;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin: 0;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>缩略图<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;lw-upload-show&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%;border: 1px solid #cccccc;&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">src</span>=<span class="string">&quot;/static/admin/image/default.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: right;margin-top: 10px;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-warning&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;lw-upload-btn&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-image&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">          上传图片</span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;cover&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/jpg,image/jpeg,image/png,image/gif,image/bmp&quot;</span> <span class="attr">id</span>=<span class="string">&quot;lw-upload-file&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin: 0;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>分类<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;category:$&#123;categories&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">required</span> <span class="attr">name</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;category.id&#125;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;category.name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin: 10px 0 0;position:relative;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>标签<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;lw-select-tags&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;lw-tag-input&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;lw-unselect-tags&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin: 10px 0 0;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>其它设置<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;has-error&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;allowComment&quot;</span> <span class="attr">checked</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">            允许评论</span><br><span class="line">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;has-error&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;status&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">            保存草稿</span><br><span class="line">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;has-error&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">            保存为页面</span><br><span class="line">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>标签搜索的遗留问题</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">selectTags.<span class="property">add</span> = <span class="keyword">function</span> (<span class="params">key</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (key) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!selectTags[key]) &#123;</span><br><span class="line">      <span class="keyword">if</span> (unSelectTags[key]) &#123;</span><br><span class="line">        selectTags[key] = unSelectTags[key]</span><br><span class="line">        <span class="keyword">delete</span> unSelectTags[key]</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        selectTags[key] = &#123;<span class="attr">name</span>: key&#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(key);</span><br><span class="line">      $(<span class="string">&#x27;#lw-select-tags&#x27;</span>).<span class="title function_">append</span>(<span class="string">`&lt;li data-value=&quot;<span class="subst">$&#123;key&#125;</span>&quot;&gt;<span class="subst">$&#123;key&#125;</span> &lt;a href=&quot;javascript:void(0)&quot;&gt;x&lt;/a&gt;&lt;/li&gt;`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    $(<span class="string">&#x27;#lw-tag-input&#x27;</span>).<span class="title function_">val</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    $(<span class="string">&#x27;#lw-unselect-tags&#x27;</span>).<span class="title function_">html</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">$(<span class="string">&#x27;#lw-tag-input&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;keydown&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (e.<span class="property">keyCode</span> === <span class="number">13</span>) &#123;</span><br><span class="line">    selectTags.<span class="title function_">add</span>($(<span class="variable language_">this</span>).<span class="title function_">val</span>())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">$(<span class="string">&#x27;#lw-unselect-tags&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;li&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  selectTags.<span class="title function_">add</span>($(<span class="variable language_">this</span>).<span class="title function_">text</span>())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>拦截表单提交事件，构建我欲提交的数据</p></li><li><p>发送<code>ajax</code>到后端进行表单的提交</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#data-form&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;submit&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// a=1&amp;b=2 表单</span></span><br><span class="line">  <span class="comment">//a=1&amp;b=2&amp;category.id=1&amp;tags[]=a&amp;tags[]=2</span></span><br><span class="line">  <span class="comment">// &#123;a:1,b:2&#125; json</span></span><br><span class="line">  <span class="keyword">let</span> data = $(<span class="variable language_">this</span>).<span class="title function_">serializeJson</span>()</span><br><span class="line">  data[<span class="string">&#x27;category&#x27;</span>] = &#123;<span class="attr">id</span>: data[<span class="string">&#x27;cid&#x27;</span>]&#125;</span><br><span class="line">  data[<span class="string">&#x27;tags&#x27;</span>] = selectTags.<span class="title function_">toList</span>()</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/admin/article/&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data),</span><br><span class="line">    <span class="attr">contentType</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (res.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">        layer.<span class="title function_">msg</span>(<span class="string">&#x27;保存成功&#x27;</span>, &#123;<span class="attr">icon</span>: <span class="number">1</span>, <span class="attr">time</span>: <span class="number">500</span>&#125;, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          location.<span class="property">href</span> = <span class="string">&#x27;/admin/article.html&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        layer.<span class="title function_">msg</span>(res.<span class="property">message</span>, &#123;<span class="attr">icon</span>: <span class="number">2</span>&#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><h3 id="后端部分"><a href="#后端部分" class="headerlink" title="后端部分"></a>后端部分</h3><ul><li><p>补充前端没有传过来的属性</p></li><li><p>将数据库中没有的标签进行新增操作</p></li><li><p>执行保存操作</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Article article)</span> &#123;</span><br><span class="line">  article.setUpdated(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">  <span class="keyword">if</span> (Objects.isNull(article.getType())) &#123;</span><br><span class="line">    article.setType(Article.TYPE_ARTICLE);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (Objects.isNull(article.getStatus())) &#123;</span><br><span class="line">    article.setStatus(Article.STATUS_PUBLISH);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (Objects.isNull(article.getAllowComment())) &#123;</span><br><span class="line">    article.setAllowComment(Article.COMMENT_DISABLE);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (Objects.isNull(article.getId())) &#123;</span><br><span class="line">    article.setCreated(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    article.setViews(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 将数据库中不存在的标签先执行插入操作</span></span><br><span class="line">  article.setTags(article.getTags().stream().peek(x -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (Objects.isNull(x.getId())) &#123;</span><br><span class="line">      x.setId(tagMapper.save(x).getId());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).collect(Collectors.toList()));</span><br><span class="line">  mapper.save(article);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="编辑"><a href="#编辑" class="headerlink" title="编辑"></a>编辑</h2><ul><li><p>修改列表页面的为点击标题跳转到文章的编辑页面</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">columns</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;序号&#x27;</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="number">50</span>,</span><br><span class="line">    <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">    <span class="attr">formatter</span>: <span class="keyword">function</span> (<span class="params">value, row, index</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> index + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;标题&#x27;</span>,</span><br><span class="line">    <span class="attr">field</span>: <span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">    <span class="attr">formatter</span>: <span class="keyword">function</span> (<span class="params">value, row</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`&lt;a href=&quot;/admin/write.html?id=<span class="subst">$&#123;row.id&#125;</span>&quot;&gt;<span class="subst">$&#123;value&#125;</span>&lt;/a&gt;`</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;状态&#x27;</span>,</span><br><span class="line">    <span class="attr">field</span>: <span class="string">&#x27;status&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;分类&#x27;</span>,</span><br><span class="line">    <span class="attr">field</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">    <span class="attr">formatter</span>:<span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> value.<span class="property">name</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;浏览量&#x27;</span>,</span><br><span class="line">    <span class="attr">field</span>: <span class="string">&#x27;views&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    <span class="attr">field</span>: <span class="string">&#x27;created&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">field</span>: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;操作&#x27;</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="attr">formatter</span>: <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`&lt;button type=&quot;button&quot; data-id=&quot;<span class="subst">$&#123;value&#125;</span>&quot; class=&quot;btn btn-danger btn-sm lw-del-btn&quot;&gt;&lt;i class=&quot;fa fa-trash&quot;&gt;&lt;/i&gt; 删除&lt;/button&gt;`</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li><p>修改<code>wirte</code>路由，当参数id不为空时查询文章详情</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ArticleService articleService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">AdminController</span><span class="params">(CategoryService categoryService, ArticleService articleService)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.categoryService = categoryService;</span><br><span class="line">  <span class="built_in">this</span>.articleService = articleService;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/write.html&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">write</span><span class="params">(<span class="meta">@RequestParam(required = false)</span> Integer id, Model model)</span> &#123;</span><br><span class="line">  List&lt;Category&gt; categories = categoryService.list();</span><br><span class="line">  <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> Objects.isNull(id) ? Article.builder().allowComment(<span class="number">1</span>).build() : articleService.detail(id);</span><br><span class="line">  model.addAttribute(<span class="string">&quot;categories&quot;</span>, categories);</span><br><span class="line">  model.addAttribute(<span class="string">&quot;article&quot;</span>, article);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;admin/write&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>为write页面设置初始值</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;form-inline&quot;</span> <span class="attr">style</span>=<span class="string">&quot;float:right;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>分类<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100px;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">th:each</span>=<span class="string">&quot;category:$&#123;categories&#125;&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;category.id&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;category.name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>状态<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100px;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>发布<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>草稿<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>类型<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100px;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>文章<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>页面<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>关键字<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入关键字...&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-search&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 搜索<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/admin/tag/&#x27;</span>,</span><br><span class="line">  <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">  <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    res.<span class="property">data</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">x</span> =&gt;</span> unSelectTags[x.<span class="property">name</span>] = x)</span><br><span class="line">    $(<span class="string">&#x27;#lw-select-tags li&#x27;</span>).<span class="title function_">each</span>(<span class="function">(<span class="params">index, ele</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> key = $(ele).<span class="title function_">data</span>(<span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(key);</span><br><span class="line">      selectTags[key] = unSelectTags[key]</span><br><span class="line">      <span class="keyword">delete</span> unSelectTags[key]</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(unSelectTags);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>修改service层的save方法，当id不为空时执行非空拷贝操作且更新文章的更新时间</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Article article)</span> &#123;</span><br><span class="line">  article.setUpdated(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">  <span class="keyword">if</span> (Objects.isNull(article.getType())) &#123;</span><br><span class="line">    article.setType(Article.TYPE_ARTICLE);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (Objects.isNull(article.getStatus())) &#123;</span><br><span class="line">    article.setStatus(Article.STATUS_PUBLISH);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (Objects.isNull(article.getAllowComment())) &#123;</span><br><span class="line">    article.setAllowComment(Article.COMMENT_DISABLE);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 将数据库中不存在的标签先执行插入操作</span></span><br><span class="line">  article.setTags(article.getTags().stream().peek(x -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (Objects.isNull(x.getId())) &#123;</span><br><span class="line">      x.setId(tagMapper.save(x).getId());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).collect(Collectors.toList()));</span><br><span class="line">  <span class="keyword">if</span> (Objects.isNull(article.getId())) &#123;</span><br><span class="line">    article.setCreated(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    article.setViews(<span class="number">0</span>);</span><br><span class="line">    mapper.save(article);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="type">Article</span> <span class="variable">one</span> <span class="operator">=</span> mapper.getOne(article.getId());</span><br><span class="line">    UpdateUtil.copyNullProperties(article, one);</span><br><span class="line">    mapper.save(one);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kevinlu98.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanWrapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanWrapperImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.beans.PropertyDescriptor;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新工具类(忽略为null的字段)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpdateUtil</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 所有为空值的属性都不copy</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> source</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> target</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyNullProperties</span><span class="params">(Object source, Object target)</span> &#123;</span><br><span class="line">    BeanUtils.copyProperties(source, target, getNullField(source));</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取属性中为空的字段</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> target</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> String[] getNullField(Object target) &#123;</span><br><span class="line">    <span class="type">BeanWrapper</span> <span class="variable">beanWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanWrapperImpl</span>(target);</span><br><span class="line">    PropertyDescriptor[] propertyDescriptors = beanWrapper.getPropertyDescriptors();</span><br><span class="line">    Set&lt;String&gt; notNullFieldSet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (propertyDescriptors.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (PropertyDescriptor p : propertyDescriptors) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> p.getName();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> beanWrapper.getPropertyValue(name);</span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(value)) &#123;</span><br><span class="line">          notNullFieldSet.add(name);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    String[] notNullField = <span class="keyword">new</span> <span class="title class_">String</span>[notNullFieldSet.size()];</span><br><span class="line">    <span class="keyword">return</span> notNullFieldSet.toArray(notNullField);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h2&gt;&lt;p&gt;经过前面几节课的学习及实战，我们已经完善了文章编辑页面，这节课我们就可以完成新增文章的功能了&lt;/p&gt;
&lt;h2 id=&quot;新增&quot;&gt;&lt;a href</summary>
      
    
    
    
    <category term="个人博客项目" scheme="https://study.kevinlu98.cn/categories/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="java" scheme="https://study.kevinlu98.cn/tags/java/"/>
    
    <category term="springboot" scheme="https://study.kevinlu98.cn/tags/springboot/"/>
    
    <category term="个人博客" scheme="https://study.kevinlu98.cn/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="博客系统" scheme="https://study.kevinlu98.cn/tags/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>(八)为文章加入Markdown支持</title>
    <link href="https://study.kevinlu98.cn/2022/10/06/wei-wen-zhang-jia-ru-zhi-chi.html"/>
    <id>https://study.kevinlu98.cn/2022/10/06/wei-wen-zhang-jia-ru-zhi-chi.html</id>
    <published>2022-10-05T20:21:00.000Z</published>
    <updated>2023-01-17T11:51:09.212Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Markdown说明"><a href="#Markdown说明" class="headerlink" title="Markdown说明"></a>Markdown说明</h2><p>都这个年代了，正经人写文章谁还用富文本编辑器呀，现在都是<code>makrdown</code>了，所以我们的博客也要采用<code>markdown</code>来排版文章</p><p>支持库：<a href="http://editor.md.ipandao.com/">editor.md</a> (这应该是目前最好用的js版<code>markdown</code>编辑器了)</p><h2 id="集成editor-md"><a href="#集成editor-md" class="headerlink" title="集成editor.md"></a>集成editor.md</h2><ul><li><p>删减下载的文件将其考到我们的项目中(这点官方不太友好，给了那了大的一个包，里面大部分东西都是没用的)</p></li><li><p>引用css和js文件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/plugin/editormd/css/editormd.min.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/plugin/editormd/editormd.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>按照<code>editor.md</code>的说明我们来创建存在编辑器的容器</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;lw-markdown-content&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>初始化编辑器</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">editormd</span>(<span class="string">&#x27;lw-markdown-content&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">height</span>: <span class="number">800</span>,</span><br><span class="line">  <span class="attr">path</span>:<span class="string">&#x27;/static/plugin/editormd/lib/&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>配置工具栏的图标</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">toolbarIcons: [<span class="string">&quot;undo&quot;</span>, <span class="string">&quot;redo&quot;</span>, <span class="string">&quot;|&quot;</span>, <span class="string">&quot;bold&quot;</span>, <span class="string">&quot;del&quot;</span>, <span class="string">&quot;italic&quot;</span>, <span class="string">&quot;quote&quot;</span>, <span class="string">&quot;|&quot;</span>, <span class="string">&quot;h1&quot;</span>, <span class="string">&quot;h2&quot;</span>, <span class="string">&quot;h3&quot;</span>, <span class="string">&quot;h4&quot;</span>, <span class="string">&quot;h5&quot;</span>, <span class="string">&quot;h6&quot;</span>, <span class="string">&quot;|&quot;</span>,</span><br><span class="line">               <span class="string">&quot;list-ul&quot;</span>, <span class="string">&quot;list-ol&quot;</span>, <span class="string">&quot;hr&quot;</span>, <span class="string">&quot;|&quot;</span>, <span class="string">&quot;link&quot;</span>, <span class="string">&quot;image&quot;</span>, <span class="string">&quot;code&quot;</span>, <span class="string">&quot;code-block&quot;</span>,</span><br><span class="line">               <span class="string">&quot;table&quot;</span>, <span class="string">&quot;emoji&quot;</span>, <span class="string">&quot;search&quot;</span>, <span class="string">&quot;|&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;preview&quot;</span>, <span class="string">&quot;fullscreen&quot;</span>]</span><br></pre></td></tr></table></figure></li><li><p>取消工具栏滚动浮动</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">toolbarAutoFixed</span>: <span class="literal">false</span>,</span><br></pre></td></tr></table></figure></li><li><p>设置编辑窗口的<code>z-index</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">onfullscreen</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="title function_">css</span>(<span class="string">&#x27;z-index&#x27;</span>, <span class="number">120</span>)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">onfullscreenExit</span>:<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"> <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="title function_">css</span>(<span class="string">&#x27;z-index&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>文件上传功能改造</p><ul><li>java部分</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kevinlu98.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.kevinlu98.common.Result;</span><br><span class="line"><span class="keyword">import</span> cn.kevinlu98.enums.ResultEnum;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.DateFormat;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author: Mr丶冷文</span></span><br><span class="line"><span class="comment"> * Date: 2022/10/8 11:24</span></span><br><span class="line"><span class="comment"> * Email: kevinlu98@qq.com</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;upload.base-dir&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String baseDir;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">DateFormat</span> <span class="variable">DATA_FORMAT</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyyMMdd/&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * editor.md的规定的返回格式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MDResult</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> Integer success;</span><br><span class="line">        <span class="keyword">private</span> String message;</span><br><span class="line">        <span class="keyword">private</span> String url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/md/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> MDResult <span class="title function_">mdUpload</span><span class="params">(<span class="meta">@RequestParam(value = &quot;editormd-image-file&quot;)</span> MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> uploadFile(file);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MDResult</span>(<span class="number">1</span>, <span class="string">&quot;上传成功&quot;</span>, url);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(e.getMessage(), e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MDResult</span>(<span class="number">0</span>, ResultEnum.RESULT_UPLOAD_FAIL.getMessage(), <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam</span> MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> uploadFile(file);</span><br><span class="line">            <span class="keyword">return</span> Result.success(url);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(e.getMessage(), e);</span><br><span class="line">            <span class="keyword">return</span> Result.error(ResultEnum.RESULT_UPLOAD_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">uploadFile</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!baseDir.endsWith(<span class="string">&quot;/&quot;</span>)) &#123;</span><br><span class="line">            baseDir += <span class="string">&quot;/&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 生成时间分区的目录</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">dateName</span> <span class="operator">=</span> DATA_FORMAT.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">String</span> <span class="variable">folderPath</span> <span class="operator">=</span> baseDir + dateName;</span><br><span class="line">        <span class="type">File</span> <span class="variable">folder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(folderPath);</span><br><span class="line">        <span class="keyword">if</span> (!folder.isDirectory()) &#123;</span><br><span class="line">            folder.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//取上传目录的绝对路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">absPath</span> <span class="operator">=</span> folder.getAbsolutePath().replace(<span class="string">&quot;./&quot;</span>, <span class="string">&quot;&quot;</span>) + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">        <span class="comment">//取文件后缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> Objects.requireNonNull(file.getOriginalFilename()).substring(file.getOriginalFilename().lastIndexOf(<span class="string">&quot;.&quot;</span>), file.getOriginalFilename().length());</span><br><span class="line">        <span class="comment">//生成文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>) + suffix;</span><br><span class="line">        <span class="comment">//上传到服务器</span></span><br><span class="line">        file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(absPath + <span class="string">&quot;/&quot;</span> + filename));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/upload/&quot;</span> + dateName + <span class="string">&quot;/&quot;</span> + filename;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>js部分</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">imageUpload    : <span class="literal">true</span>,</span><br><span class="line">imageFormats   : [<span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;jpeg&quot;</span>, <span class="string">&quot;gif&quot;</span>, <span class="string">&quot;png&quot;</span>, <span class="string">&quot;bmp&quot;</span>, <span class="string">&quot;webp&quot;</span>],</span><br><span class="line">imageUploadURL : <span class="string">&quot;/admin/md/upload&quot;</span>,</span><br></pre></td></tr></table></figure></li><li><p><code>Emoji</code>表情处理</p><ul><li>emoji下载：<a href="https://github.com/SemiWarm/SemiWarmAdminPhotos/blob/master/emoji.zip">https://github.com/SemiWarm/SemiWarmAdminPhotos/blob/master/emoji.zip</a> </li><li>将下载好的文件解压到项目的<code>/static/plugin/editormd/images/</code>下</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">emoji</span>:<span class="literal">true</span>,</span><br></pre></td></tr></table></figure><ul><li>修改<code>editormd.js</code>中emoji的路径为本地路径</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">editormd.<span class="property">emoji</span>     = &#123;</span><br><span class="line">  path  : <span class="string">&quot;/static/plugin/editormd/images/emoji/&quot;</span>,</span><br><span class="line">  ext   : <span class="string">&quot;.png&quot;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul><h2 id="文章页的缩略图上传"><a href="#文章页的缩略图上传" class="headerlink" title="文章页的缩略图上传"></a>文章页的缩略图上传</h2><ul><li><p>HTML部分</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;lw-upload-show&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%;border: 1px solid #cccccc;&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">src</span>=<span class="string">&quot;/static/admin/image/default.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: right;margin-top: 10px;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-warning&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;lw-upload-btn&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-image&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    上传图片</span><br><span class="line">  <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;cover&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;lw-upload-file&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>JS部分</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$(<span class="string">&#x27;#lw-upload-btn&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  $(<span class="string">&#x27;#lw-upload-file&#x27;</span>).<span class="title function_">click</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">$(<span class="string">&#x27;#lw-upload-file&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;change&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> file = <span class="variable language_">this</span>.<span class="property">files</span>[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">let</span> fd = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">  fd.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, file);</span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/admin/upload&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: fd,</span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">    <span class="attr">processData</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">contentType</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (res.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">        $(<span class="string">&#x27;#lw-upload-show&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&#x27;src&#x27;</span>, res.<span class="property">data</span>);</span><br><span class="line">        $(<span class="string">&#x27;#data-form [name=cover]&#x27;</span>).<span class="title function_">val</span>(res.<span class="property">data</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        layer.<span class="title function_">msg</span>(res.<span class="property">message</span>, &#123;<span class="attr">icon</span>: <span class="number">2</span>&#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Markdown说明&quot;&gt;&lt;a href=&quot;#Markdown说明&quot; class=&quot;headerlink&quot; title=&quot;Markdown说明&quot;&gt;&lt;/a&gt;Markdown说明&lt;/h2&gt;&lt;p&gt;都这个年代了，正经人写文章谁还用富文本编辑器呀，现在都是&lt;code&gt;makr</summary>
      
    
    
    
    <category term="个人博客项目" scheme="https://study.kevinlu98.cn/categories/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="java" scheme="https://study.kevinlu98.cn/tags/java/"/>
    
    <category term="springboot" scheme="https://study.kevinlu98.cn/tags/springboot/"/>
    
    <category term="个人博客" scheme="https://study.kevinlu98.cn/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="博客系统" scheme="https://study.kevinlu98.cn/tags/%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
</feed>
